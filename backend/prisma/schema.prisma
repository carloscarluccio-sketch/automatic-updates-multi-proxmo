generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model activity_logs {
  id            Int                   @id @default(autoincrement())
  user_id       Int?
  company_id    Int?
  activity_type String                @db.VarChar(50)
  entity_type   String                @db.VarChar(50)
  entity_id     Int?
  action        String                @db.VarChar(50)
  description   String                @db.Text
  status        activity_logs_status? @default(success)
  metadata      String?               @db.LongText
  ip_address    String?               @db.VarChar(45)
  user_agent    String?               @db.Text
  created_at    DateTime?             @default(now()) @db.Timestamp(0)
  users         users?                @relation(fields: [user_id], references: [id], onUpdate: NoAction, map: "activity_logs_ibfk_1")
  companies     companies?            @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "activity_logs_ibfk_2")

  @@index([company_id, activity_type], map: "idx_activity_company_type")
  @@index([created_at], map: "idx_activity_created")
  @@index([entity_type, entity_id], map: "idx_activity_entity")
  @@index([activity_type], map: "idx_activity_type")
  @@index([user_id], map: "idx_activity_user")
  @@index([company_id], map: "idx_company_id")
  @@index([created_at], map: "idx_created_at")
  @@index([entity_id], map: "idx_entity_id")
  @@index([entity_type], map: "idx_entity_type")
  @@index([status], map: "idx_status")
  @@index([user_id], map: "idx_user_id")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model alert_history {
  id                                         BigInt                    @id @default(autoincrement())
  alert_rule_id                              Int
  company_id                                 Int?
  target_type                                alert_history_target_type
  target_id                                  Int?
  target_name                                String?                   @db.VarChar(200)
  severity                                   alert_history_severity
  metric_type                                String                    @db.VarChar(50)
  current_value                              Decimal                   @db.Decimal(15, 4)
  threshold_value                            Decimal                   @db.Decimal(15, 4)
  message                                    String                    @db.Text
  status                                     alert_history_status?     @default(triggered)
  triggered_at                               DateTime?                 @default(now()) @db.Timestamp(0)
  acknowledged_at                            DateTime?                 @db.Timestamp(0)
  acknowledged_by                            Int?
  resolved_at                                DateTime?                 @db.Timestamp(0)
  resolved_by                                Int?
  resolution_note                            String?                   @db.Text
  notifications_sent                         String?                   @db.LongText
  alert_rules                                alert_rules               @relation(fields: [alert_rule_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "alert_history_ibfk_1")
  companies                                  companies?                @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "alert_history_ibfk_2")
  users_alert_history_acknowledged_byTousers users?                    @relation("alert_history_acknowledged_byTousers", fields: [acknowledged_by], references: [id], onUpdate: NoAction, map: "alert_history_ibfk_3")
  users_alert_history_resolved_byTousers     users?                    @relation("alert_history_resolved_byTousers", fields: [resolved_by], references: [id], onUpdate: NoAction, map: "alert_history_ibfk_4")

  @@index([acknowledged_by], map: "acknowledged_by")
  @@index([alert_rule_id], map: "alert_rule_id")
  @@index([company_id, status, triggered_at], map: "idx_company_status_time")
  @@index([target_type, target_id], map: "idx_target")
  @@index([triggered_at], map: "idx_triggered_at")
  @@index([resolved_by], map: "resolved_by")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model alert_rules {
  id                    Int                            @id @default(autoincrement())
  name                  String                         @db.VarChar(200)
  description           String?                        @db.Text
  company_id            Int?
  rule_type             alert_rules_rule_type?         @default(threshold)
  metric_type           alert_rules_metric_type
  condition_operator    alert_rules_condition_operator
  threshold_value       Decimal                        @db.Decimal(15, 4)
  duration_minutes      Int?                           @default(5)
  severity              alert_rules_severity?          @default(warning)
  target_type           alert_rules_target_type
  target_id             Int?
  enabled               Boolean?                       @default(true)
  notify_email          Boolean?                       @default(true)
  notify_slack          Boolean?                       @default(false)
  notify_webhook        Boolean?                       @default(false)
  notify_sms            Boolean?                       @default(false)
  notification_channels String?                        @db.LongText
  cooldown_minutes      Int?                           @default(60)
  created_by            Int?
  created_at            DateTime?                      @default(now()) @db.Timestamp(0)
  updated_at            DateTime?                      @default(now()) @db.Timestamp(0)
  alert_history         alert_history[]
  companies             companies?                     @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "alert_rules_ibfk_1")
  users                 users?                         @relation(fields: [created_by], references: [id], onUpdate: NoAction, map: "alert_rules_ibfk_2")

  @@index([created_by], map: "created_by")
  @@index([company_id, enabled], map: "idx_company_enabled")
  @@index([target_type, target_id], map: "idx_target")
  @@fulltext([name, description], map: "ft_alert_rules_search")
}

model api_rate_limits {
  id            Int        @id @default(autoincrement())
  token_id      Int
  window_start  DateTime   @db.Timestamp(0)
  request_count Int?       @default(1)
  api_tokens    api_tokens @relation(fields: [token_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "api_rate_limits_ibfk_1")

  @@unique([token_id, window_start], map: "idx_token_window")
}

model api_scopes {
  id          Int                  @id @default(autoincrement())
  scope       String               @unique(map: "scope") @db.VarChar(50)
  description String               @db.VarChar(255)
  category    String               @db.VarChar(50)
  min_role    api_scopes_min_role? @default(user)
  created_at  DateTime?            @default(now()) @db.Timestamp(0)
}

model api_token_usage {
  id               BigInt     @id @default(autoincrement())
  token_id         Int
  endpoint         String     @db.VarChar(255)
  method           String     @db.VarChar(10)
  status_code      Int
  response_time_ms Int?
  ip_address       String?    @db.VarChar(45)
  user_agent       String?    @db.VarChar(500)
  created_at       DateTime?  @default(now()) @db.Timestamp(0)
  api_tokens       api_tokens @relation(fields: [token_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "api_token_usage_ibfk_1")

  @@index([created_at], map: "idx_created")
  @@index([token_id, created_at], map: "idx_token_time")
}

model api_token_usage_logs {
  id               Int        @id @default(autoincrement())
  token_id         Int
  endpoint         String     @db.VarChar(255)
  method           String     @db.VarChar(10)
  status_code      Int
  ip_address       String?    @db.VarChar(45)
  user_agent       String?    @db.Text
  request_body     Json?
  response_time_ms Int?
  created_at       DateTime?  @default(now()) @db.Timestamp(0)
  api_tokens       api_tokens @relation(fields: [token_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "api_token_usage_logs_ibfk_1")

  @@index([created_at], map: "idx_created_at")
  @@index([endpoint], map: "idx_endpoint")
  @@index([token_id], map: "idx_token_id")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model api_tokens {
  id                       Int                        @id @default(autoincrement())
  user_id                  Int
  company_id               Int
  name                     String                     @db.VarChar(100)
  token_hash               String                     @db.VarChar(255)
  token_prefix             String                     @db.VarChar(12)
  scopes                   String                     @db.LongText
  ip_whitelist             String?                    @db.LongText
  rate_limit               Int?                       @default(100)
  expires_at               DateTime?                  @db.Timestamp(0)
  last_used_at             DateTime?                  @db.Timestamp(0)
  last_used_ip             String?                    @db.VarChar(45)
  request_count            BigInt?                    @default(0)
  is_active                Boolean?                   @default(true)
  created_at               DateTime?                  @default(now()) @db.Timestamp(0)
  revoked_at               DateTime?                  @db.Timestamp(0)
  revoked_by               Int?
  api_rate_limits          api_rate_limits[]
  api_token_usage          api_token_usage[]
  api_token_usage_logs     api_token_usage_logs[]
  users                    users                      @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "api_tokens_ibfk_1")
  companies                companies                  @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "api_tokens_ibfk_2")
  onboarding_registrations onboarding_registrations[]

  @@index([company_id], map: "idx_api_tokens_company")
  @@index([expires_at], map: "idx_api_tokens_expires")
  @@index([token_prefix], map: "idx_api_tokens_prefix")
  @@index([user_id], map: "idx_api_tokens_user")
  @@index([company_id, is_active], map: "idx_company_tokens")
  @@index([token_hash], map: "idx_token_hash")
  @@index([token_prefix], map: "idx_token_prefix")
  @@index([user_id, is_active], map: "idx_user_tokens")
}

model articles {
  id               Int                      @id @default(autoincrement())
  title            String                   @db.VarChar(255)
  content          String                   @db.Text
  author_id        Int
  company_id       Int?
  cluster_id       Int?
  target_audience  articles_target_audience @default(everyone)
  target_role      articles_target_role?
  is_active        Boolean                  @default(true)
  created_at       DateTime?                @default(now()) @db.Timestamp(0)
  updated_at       DateTime?                @default(now()) @db.Timestamp(0)
  users            users                    @relation(fields: [author_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "articles_ibfk_1")
  companies        companies?               @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "articles_ibfk_2")
  proxmox_clusters proxmox_clusters?        @relation(fields: [cluster_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "articles_ibfk_3")

  @@index([author_id], map: "author_id")
  @@index([cluster_id], map: "idx_cluster_id")
  @@index([company_id], map: "idx_company_id")
  @@index([created_at], map: "idx_created_at")
  @@index([is_active], map: "idx_is_active")
  @@index([target_audience], map: "idx_target_audience")
}

model audit_export_jobs {
  id                   Int                              @id @default(autoincrement())
  user_id              Int
  company_id           Int?
  export_format        audit_export_jobs_export_format? @default(csv)
  filter_start_date    DateTime?                        @db.Timestamp(0)
  filter_end_date      DateTime?                        @db.Timestamp(0)
  filter_activity_type String?                          @db.VarChar(50)
  filter_user_id       Int?
  status               audit_export_jobs_status?        @default(pending)
  file_path            String?                          @db.VarChar(500)
  file_size            BigInt?
  error_message        String?                          @db.Text
  created_at           DateTime?                        @default(now()) @db.Timestamp(0)
  completed_at         DateTime?                        @db.Timestamp(0)
  expires_at           DateTime?                        @db.Timestamp(0)
  users                users                            @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "audit_export_jobs_ibfk_1")
  companies            companies?                       @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "audit_export_jobs_ibfk_2")

  @@index([company_id], map: "company_id")
  @@index([user_id, status], map: "idx_user_jobs")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model audit_logs {
  id            BigInt     @id @default(autoincrement())
  user_id       Int?
  company_id    Int?
  action        String     @db.VarChar(100)
  resource_type String?    @db.VarChar(50)
  resource_id   Int?
  ip_address    String?    @db.VarChar(45)
  user_agent    String?    @db.Text
  details       String?    @db.LongText
  created_at    DateTime?  @default(now()) @db.Timestamp(0)
  users         users?     @relation(fields: [user_id], references: [id], onUpdate: NoAction, map: "audit_logs_ibfk_1")
  companies     companies? @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "audit_logs_ibfk_2")

  @@index([action], map: "idx_action")
  @@index([company_id], map: "idx_company")
  @@index([created_at], map: "idx_created")
  @@index([user_id], map: "idx_user")
}

model backup_history {
  id                  BigInt                              @id @default(autoincrement())
  schedule_id         Int?
  company_id          Int
  vm_id               Int
  vm_name             String                              @db.VarChar(200)
  cluster_id          Int
  node_name           String                              @db.VarChar(100)
  backup_type         backup_history_backup_type?         @default(scheduled)
  backup_mode         backup_history_backup_mode
  backup_file         String?                             @db.VarChar(500)
  backup_size_bytes   BigInt?
  compression         backup_history_compression?
  status              backup_history_status?              @default(running)
  error_message       String?                             @db.Text
  started_at          DateTime?                           @default(now()) @db.Timestamp(0)
  completed_at        DateTime?                           @db.Timestamp(0)
  duration_seconds    Int?
  verified_at         DateTime?                           @db.Timestamp(0)
  verification_status backup_history_verification_status? @default(pending)
  expires_at          DateTime?                           @db.Timestamp(0)
  deleted_at          DateTime?                           @db.Timestamp(0)
  initiated_by        Int?
  notes               String?                             @db.Text
  backup_schedules    backup_schedules?                   @relation(fields: [schedule_id], references: [id], onUpdate: NoAction, map: "backup_history_ibfk_1")
  companies           companies                           @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "backup_history_ibfk_2")
  virtual_machines    virtual_machines                    @relation(fields: [vm_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "backup_history_ibfk_3")
  proxmox_clusters    proxmox_clusters                    @relation(fields: [cluster_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "backup_history_ibfk_4")
  users               users?                              @relation(fields: [initiated_by], references: [id], onUpdate: NoAction, map: "backup_history_ibfk_5")
  backup_restore_jobs backup_restore_jobs[]

  @@index([cluster_id, node_name], map: "idx_cluster_node")
  @@index([company_id, vm_id, started_at], map: "idx_company_vm_time")
  @@index([status, expires_at], map: "idx_status_expires")
  @@index([initiated_by], map: "initiated_by")
  @@index([schedule_id], map: "schedule_id")
  @@index([vm_id], map: "vm_id")
}

model backup_policies {
  id                    Int                          @id @default(autoincrement())
  company_id            Int
  cluster_id            Int
  name                  String                       @db.VarChar(255)
  schedule_cron         String?                      @db.VarChar(100)
  retention_days        Int?                         @default(7)
  compression           backup_policies_compression? @default(zstd)
  mode                  backup_policies_mode?        @default(snapshot)
  storage_location      String?                      @db.VarChar(255)
  enabled               Boolean?                     @default(true)
  created_at            DateTime?                    @default(now()) @db.Timestamp(0)
  updated_at            DateTime?                    @default(now()) @db.Timestamp(0)
  companies             companies                    @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "backup_policies_ibfk_1")
  proxmox_clusters      proxmox_clusters             @relation(fields: [cluster_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "backup_policies_ibfk_2")
  vm_backup_assignments vm_backup_assignments[]

  @@index([cluster_id], map: "cluster_id")
  @@index([company_id], map: "idx_company")
  @@index([enabled], map: "idx_enabled")
}

model backup_restore_jobs {
  id                Int                         @id @default(autoincrement())
  backup_history_id BigInt
  company_id        Int
  target_vm_id      Int?
  target_cluster_id Int
  target_node       String                      @db.VarChar(100)
  new_vm_name       String?                     @db.VarChar(200)
  new_vmid          Int?
  status            backup_restore_jobs_status? @default(pending)
  progress_percent  Int?                        @default(0)
  error_message     String?                     @db.Text
  started_at        DateTime?                   @default(now()) @db.Timestamp(0)
  completed_at      DateTime?                   @db.Timestamp(0)
  duration_seconds  Int?
  initiated_by      Int?
  backup_history    backup_history              @relation(fields: [backup_history_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "backup_restore_jobs_ibfk_1")
  companies         companies                   @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "backup_restore_jobs_ibfk_2")
  virtual_machines  virtual_machines?           @relation(fields: [target_vm_id], references: [id], onUpdate: NoAction, map: "backup_restore_jobs_ibfk_3")
  proxmox_clusters  proxmox_clusters            @relation(fields: [target_cluster_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "backup_restore_jobs_ibfk_4")
  users             users?                      @relation(fields: [initiated_by], references: [id], onUpdate: NoAction, map: "backup_restore_jobs_ibfk_5")

  @@index([backup_history_id], map: "backup_history_id")
  @@index([company_id], map: "company_id")
  @@index([status, started_at], map: "idx_status_started")
  @@index([initiated_by], map: "initiated_by")
  @@index([target_cluster_id], map: "target_cluster_id")
  @@index([target_vm_id], map: "target_vm_id")
}

model backup_schedules {
  id                 Int                            @id @default(autoincrement())
  name               String                         @db.VarChar(200)
  description        String?                        @db.Text
  company_id         Int
  vm_id              Int?
  cluster_id         Int?
  schedule_type      backup_schedules_schedule_type
  schedule_time      String?                        @db.VarChar(50)
  schedule_cron      String?                        @db.VarChar(100)
  enabled            Boolean?                       @default(true)
  retention_days     Int?                           @default(7)
  retention_count    Int?
  compression        backup_schedules_compression?  @default(zstd)
  mode               backup_schedules_mode?         @default(snapshot)
  storage_location   String?                        @db.VarChar(200)
  include_ram        Boolean?                       @default(false)
  notification_email String?                        @db.VarChar(255)
  notify_on_success  Boolean?                       @default(false)
  notify_on_failure  Boolean?                       @default(true)
  next_run           DateTime?                      @db.Timestamp(0)
  last_run           DateTime?                      @db.Timestamp(0)
  last_status        backup_schedules_last_status?  @default(pending)
  last_error         String?                        @db.Text
  created_by         Int?
  created_at         DateTime?                      @default(now()) @db.Timestamp(0)
  updated_at         DateTime?                      @default(now()) @db.Timestamp(0)
  backup_history     backup_history[]
  companies          companies                      @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "backup_schedules_ibfk_1")
  virtual_machines   virtual_machines?              @relation(fields: [vm_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "backup_schedules_ibfk_2")
  proxmox_clusters   proxmox_clusters?              @relation(fields: [cluster_id], references: [id], onUpdate: NoAction, map: "backup_schedules_ibfk_3")
  users              users?                         @relation(fields: [created_by], references: [id], onUpdate: NoAction, map: "backup_schedules_ibfk_4")

  @@index([cluster_id], map: "cluster_id")
  @@index([created_by], map: "created_by")
  @@index([company_id, enabled], map: "idx_company_enabled")
  @@index([next_run, enabled], map: "idx_next_run_enabled")
  @@index([vm_id], map: "vm_id")
}

model backup_servers {
  id                         Int                          @id @default(autoincrement())
  name                       String                       @db.VarChar(100)
  host                       String                       @db.VarChar(255)
  port                       Int?                         @default(8007)
  username                   String                       @db.VarChar(100)
  api_token_id               String?                      @db.VarChar(100)
  api_token_secret           String?                      @db.Text
  fingerprint                String?                      @db.VarChar(255)
  description                String?                      @db.Text
  status                     backup_servers_status?       @default(active)
  last_check                 DateTime?                    @db.Timestamp(0)
  last_check_status          String?                      @db.VarChar(50)
  created_at                 DateTime?                    @default(now()) @db.Timestamp(0)
  updated_at                 DateTime?                    @default(now()) @db.Timestamp(0)
  cluster_backup_servers     cluster_backup_servers[]
  company_backup_assignments company_backup_assignments[]

  @@unique([host, port], map: "unique_host_port")
}

model billing_audit_log {
  id           Int                      @id @default(autoincrement())
  company_id   Int
  invoice_id   Int?
  action       billing_audit_log_action
  description  String                   @db.Text
  old_values   Json?
  new_values   Json?
  performed_by Int?
  ip_address   String?                  @db.VarChar(45)
  created_at   DateTime?                @default(now()) @db.Timestamp(0)
  companies    companies                @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "billing_audit_log_ibfk_1")
  invoices     invoices?                @relation(fields: [invoice_id], references: [id], onUpdate: NoAction, map: "billing_audit_log_ibfk_2")
  users        users?                   @relation(fields: [performed_by], references: [id], onUpdate: NoAction, map: "billing_audit_log_ibfk_3")

  @@index([action], map: "idx_action")
  @@index([company_id], map: "idx_company")
  @@index([invoice_id], map: "invoice_id")
  @@index([performed_by], map: "performed_by")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model billing_records {
  id                     BigInt                  @id @default(autoincrement())
  company_id             Int
  project_id             Int?
  period_start           DateTime                @db.Date
  period_end             DateTime                @db.Date
  total_cpu_hours        Decimal?                @default(0.00) @db.Decimal(15, 2)
  total_memory_gb_hours  Decimal?                @default(0.00) @db.Decimal(15, 2)
  total_storage_gb_hours Decimal?                @default(0.00) @db.Decimal(15, 2)
  total_network_gb       Decimal?                @default(0.00) @db.Decimal(15, 2)
  additional_charges     String?                 @db.LongText
  status                 billing_records_status? @default(pending)
  created_at             DateTime?               @default(now()) @db.Timestamp(0)
  updated_at             DateTime?               @default(now()) @db.Timestamp(0)
  companies              companies               @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "billing_records_ibfk_1")
  vm_projects            vm_projects?            @relation(fields: [project_id], references: [id], onUpdate: NoAction, map: "fk_billing_project")

  @@index([project_id], map: "fk_billing_project")
  @@index([company_id], map: "idx_company")
  @@index([period_start, period_end], map: "idx_period")
  @@index([status], map: "idx_status")
}

model bookmarks {
  id          Int       @id @default(autoincrement())
  user_id     Int
  page_name   String    @db.VarChar(100)
  page_url    String    @db.VarChar(255)
  icon        String?   @db.VarChar(50)
  order_index Int?      @default(0)
  created_at  DateTime? @default(now()) @db.Timestamp(0)
  users       users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "bookmarks_ibfk_1")

  @@index([user_id], map: "idx_user_id")
}

model bulk_cluster_operations {
  id               Int                                    @id @default(autoincrement())
  operation_type   bulk_cluster_operations_operation_type
  cluster_ids      Json
  total_clusters   Int
  success_count    Int?                                   @default(0)
  failure_count    Int?                                   @default(0)
  results          Json?
  started_at       DateTime?                              @default(now()) @db.Timestamp(0)
  completed_at     DateTime?                              @db.Timestamp(0)
  duration_seconds Int?
  initiated_by     Int
  status           bulk_cluster_operations_status?        @default(pending)

  @@index([initiated_by], map: "idx_initiated_by")
  @@index([status], map: "idx_status")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model bulk_operations_log {
  id             Int                                @id @default(autoincrement())
  operation_type bulk_operations_log_operation_type
  entity_type    bulk_operations_log_entity_type?   @default(vm)
  entity_ids     String                             @db.LongText
  total_count    Int
  success_count  Int?                               @default(0)
  failed_count   Int?                               @default(0)
  status         bulk_operations_log_status?        @default(pending)
  error_details  String?                            @db.LongText
  executed_by    Int?
  company_id     Int?
  started_at     DateTime?                          @default(now()) @db.Timestamp(0)
  completed_at   DateTime?                          @db.Timestamp(0)
  users          users?                             @relation(fields: [executed_by], references: [id], onUpdate: NoAction, map: "bulk_operations_log_ibfk_1")
  companies      companies?                         @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "bulk_operations_log_ibfk_2")

  @@index([company_id], map: "company_id")
  @@index([executed_by], map: "idx_executed_by")
  @@index([started_at], map: "idx_started_at")
  @@index([status], map: "idx_status")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model cluster_backup_servers {
  id               Int              @id @default(autoincrement())
  cluster_id       Int
  backup_server_id Int
  datastore_name   String?          @default("datastore1") @db.VarChar(100)
  is_primary       Boolean?         @default(false)
  retention_days   Int?             @default(30)
  backup_schedule  String?          @default("0 2 * * *") @db.VarChar(100)
  enabled          Boolean?         @default(true)
  created_at       DateTime?        @default(now()) @db.Timestamp(0)
  updated_at       DateTime?        @default(now()) @db.Timestamp(0)
  proxmox_clusters proxmox_clusters @relation(fields: [cluster_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "cluster_backup_servers_ibfk_1")
  backup_servers   backup_servers   @relation(fields: [backup_server_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "cluster_backup_servers_ibfk_2")

  @@unique([cluster_id, backup_server_id], map: "unique_cluster_backup")
  @@index([cluster_id], map: "idx_cluster_backup_cluster")
  @@index([backup_server_id], map: "idx_cluster_backup_server")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model companies {
  id                         Int                          @id @default(autoincrement())
  name                       String                       @unique(map: "name") @db.VarChar(255)
  company_type               String?                      @default("standard") @db.VarChar(50)
  billing_model              companies_billing_model?     @default(hybrid)
  owner_name                 String                       @db.VarChar(255)
  contact_name               String?                      @db.VarChar(255)
  primary_email              String                       @unique(map: "primary_email") @db.VarChar(255)
  contact_email              String?                      @db.VarChar(255)
  contact_phone              String?                      @db.VarChar(50)
  address                    String?                      @db.Text
  status                     companies_status?            @default(active)
  require_2fa                Boolean?                     @default(false)
  logo_filename              String?                      @db.VarChar(255)
  favicon_filename           String?                      @db.VarChar(255)
  panel_name                 String?                      @db.VarChar(100)
  header_color               String?                      @db.VarChar(7)
  menu_color                 String?                      @db.VarChar(7)
  created_at                 DateTime?                    @default(now()) @db.Timestamp(0)
  updated_at                 DateTime?                    @default(now()) @db.Timestamp(0)
  login_bg_color             String?                      @default("#1a1a2e") @db.VarChar(7)
  sso_enabled                Boolean?                     @default(false)
  sso_provider               String?                      @db.VarChar(50)
  sso_tenant_id              String?                      @db.VarChar(255)
  sso_client_id              String?                      @db.VarChar(255)
  sso_client_secret          String?                      @db.VarChar(255)
  sso_authority_url          String?                      @db.VarChar(500)
  sso_redirect_uri           String?                      @db.VarChar(500)
  sso_scope                  String?                      @db.Text
  sso_auto_create_users      Boolean?                     @default(true)
  sso_default_role           companies_sso_default_role?  @default(user)
  default_nat_type           companies_default_nat_type?  @default(port_forward)
  allow_nat_methods          String?                      @db.LongText
  nat_enabled                Boolean?                     @default(true)
  primary_color              String?                      @default("#1976d2") @db.VarChar(7)
  secondary_color            String?                      @default("#dc004e") @db.VarChar(7)
  background_color           String?                      @default("#f5f5f5") @db.VarChar(7)
  text_color                 String?                      @default("#212121") @db.VarChar(7)
  font_family                String?                      @default("Roboto, sans-serif") @db.VarChar(100)
  sidebar_text_color         String?                      @default("#ffffff") @db.VarChar(7)
  billing_day_of_month       Int?                         @default(1)
  billing_active             Boolean?                     @default(true)
  next_billing_date          DateTime?                    @db.Date
  tax_rate                   Decimal?                     @default(0.0000) @db.Decimal(5, 4)
  tax_id                     String?                      @db.VarChar(100)
  company_address            String?                      @db.Text
  budget_threshold           Decimal?                     @default(1000.00) @db.Decimal(10, 2)
  last_budget_alert_sent     DateTime?                    @db.DateTime(0)
  support_email              String?                      @db.VarChar(255)
  alert_webhook_url          String?                      @db.VarChar(500)
  activity_logs              activity_logs[]
  alert_history              alert_history[]
  alert_rules                alert_rules[]
  api_tokens                 api_tokens[]
  articles                   articles[]
  audit_export_jobs          audit_export_jobs[]
  audit_logs                 audit_logs[]
  backup_history             backup_history[]
  backup_policies            backup_policies[]
  backup_restore_jobs        backup_restore_jobs[]
  backup_schedules           backup_schedules[]
  billing_audit_log          billing_audit_log[]
  billing_records            billing_records[]
  billing_transactions       billing_transactions[]
  bulk_operations_log        bulk_operations_log[]
  company_backup_assignments company_backup_assignments[]
  company_billing            company_billing?
  company_clusters           company_clusters[]
  company_payment_methods    company_payment_methods[]
  company_pricing_plans      company_pricing_plans[]
  company_quotas             company_quotas[]
  company_sso_config         company_sso_config[]
  company_storage_quotas     company_storage_quotas[]
  company_subscriptions      company_subscriptions[]
  company_url_mappings       company_url_mappings[]
  customer_portal_sessions   customer_portal_sessions[]
  daily_vm_usage             daily_vm_usage[]
  dr_cluster_pairs           dr_cluster_pairs[]
  dr_company_quotas          dr_company_quotas?
  dr_vm_policies             dr_vm_policies[]
  email_queue                email_queue[]
  email_templates            email_templates[]
  esxi_hosts                 esxi_hosts[]
  export_history             export_history[]
  feedback_submissions       feedback_submissions[]
  help_article_changelog     help_article_changelog[]
  help_article_drafts        help_article_drafts[]
  help_articles              help_articles[]
  help_faqs                  help_faqs[]
  invoices                   invoices[]
  ip_ranges                  ip_ranges[]
  ip_reservations            ip_reservations[]
  iso_company_assignments    iso_company_assignments[]
  monitoring_metrics         monitoring_metrics[]
  nat_rules                  nat_rules[]
  network_edges              network_edges[]
  onboarding_registrations   onboarding_registrations[]
  opnsense_instances         opnsense_instances[]
  payment_method_audit       payment_method_audit[]
  payments                   payments[]
  pricing_plans              pricing_plans[]
  pricing_tiers              pricing_tiers[]
  profiles                   profiles[]
  proxmox_clusters           proxmox_clusters[]
  quota_approval_requests    quota_approval_requests[]
  quota_usage_history        quota_usage_history[]
  quota_violations           quota_violations[]
  resource_alert_history     resource_alert_history[]
  resource_alerts            resource_alerts[]
  resource_quotas            resource_quotas[]
  saved_filters              saved_filters[]
  sso_login_audit            sso_login_audit[]
  support_tickets            support_tickets[]
  ui_customizations          ui_customizations[]
  usage_metrics              usage_metrics[]
  usage_tracking             usage_tracking[]
  user_profiles              user_profiles[]
  users                      users[]
  virtual_machines           virtual_machines[]
  vm_billing_snapshots       vm_billing_snapshots[]
  vm_daily_summaries         vm_daily_summaries[]
  vm_import_jobs             vm_import_jobs[]
  vm_projects                vm_projects[]
  vm_resource_metrics        vm_resource_metrics[]
  vm_tags                    vm_tags[]
  vm_templates               vm_templates[]
  webhooks                   webhooks[]
  whitelabel_assets          whitelabel_assets[]
  whitelabel_settings        whitelabel_settings?

  @@index([status], map: "idx_companies_status")
  @@index([contact_email], map: "idx_contact_email")
  @@index([primary_email], map: "idx_email")
  @@index([panel_name], map: "idx_panel_name")
  @@index([sso_enabled], map: "idx_sso_enabled")
  @@index([status], map: "idx_status")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model company_backup_assignments {
  id               Int                                     @id @default(autoincrement())
  company_id       Int
  backup_server_id Int
  datastore_name   String?                                 @default("datastore1") @db.VarChar(100)
  retention_policy String?                                 @default("keep-last=3,keep-daily=7,keep-weekly=4,keep-monthly=3") @db.VarChar(255)
  compression      String?                                 @default("zstd") @db.VarChar(50)
  is_active        Boolean?                                @default(true)
  schedule         String?                                 @db.VarChar(100)
  retention_days   Int?                                    @default(30)
  backup_schedule  String?                                 @default("0 2 * * *") @db.VarChar(100)
  backup_type      company_backup_assignments_backup_type? @default(full)
  enabled          Boolean?                                @default(true)
  created_at       DateTime?                               @default(now()) @db.Timestamp(0)
  updated_at       DateTime?                               @default(now()) @db.Timestamp(0)
  companies        companies                               @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "company_backup_assignments_ibfk_1")
  backup_servers   backup_servers                          @relation(fields: [backup_server_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "company_backup_assignments_ibfk_2")

  @@unique([company_id, backup_server_id], map: "unique_company_backup")
  @@index([company_id], map: "idx_company_backup_company")
  @@index([backup_server_id], map: "idx_company_backup_server")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model company_billing {
  id                                                                  Int                                     @id @default(autoincrement())
  company_id                                                          Int                                     @unique(map: "company_id")
  pricing_tier_vm                                                     Int?
  pricing_tier_storage                                                Int?
  pricing_tier_bandwidth                                              Int?
  billing_email                                                       String                                  @db.VarChar(255)
  billing_contact_name                                                String?                                 @db.VarChar(100)
  billing_address                                                     String?                                 @db.Text
  tax_id                                                              String?                                 @db.VarChar(50)
  tax_rate                                                            Decimal?                                @default(0.00) @db.Decimal(5, 2)
  payment_method                                                      company_billing_payment_method?         @default(manual)
  payment_terms_days                                                  Int?                                    @default(30)
  auto_suspend_on_overdue                                             Boolean?                                @default(false)
  suspend_grace_period_days                                           Int?                                    @default(7)
  created_at                                                          DateTime?                               @default(now()) @db.Timestamp(0)
  updated_at                                                          DateTime?                               @default(now()) @db.Timestamp(0)
  stripe_customer_id                                                  String?                                 @db.VarChar(255)
  stripe_payment_method_id                                            String?                                 @db.VarChar(255)
  paypal_email                                                        String?                                 @db.VarChar(255)
  paypal_subscription_id                                              String?                                 @db.VarChar(255)
  bank_account_name                                                   String?                                 @db.VarChar(255)
  bank_account_number_encrypted                                       String?                                 @db.Text
  bank_routing_number                                                 String?                                 @db.VarChar(50)
  bank_name                                                           String?                                 @db.VarChar(255)
  preferred_currency                                                  String?                                 @default("USD") @db.VarChar(3)
  auto_charge_enabled                                                 Boolean?                                @default(false)
  billing_cycle_override                                              company_billing_billing_cycle_override?
  payment_gateway_metadata                                            Json?
  current_pricing_plan_id                                             Int?
  invoice_prefix                                                      String?                                 @default("INV") @db.VarChar(10)
  invoice_counter                                                     Int?                                    @default(1)
  send_invoice_email                                                  Boolean?                                @default(true)
  overdue_notification_days                                           String?                                 @default("7,14,30") @db.VarChar(50)
  last_invoice_date                                                   DateTime?                               @db.Date
  next_invoice_date                                                   DateTime?                               @db.Date
  companies                                                           companies                               @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "company_billing_ibfk_1")
  pricing_tiers_company_billing_pricing_tier_vmTopricing_tiers        pricing_tiers?                          @relation("company_billing_pricing_tier_vmTopricing_tiers", fields: [pricing_tier_vm], references: [id], onUpdate: NoAction, map: "company_billing_ibfk_2")
  pricing_tiers_company_billing_pricing_tier_storageTopricing_tiers   pricing_tiers?                          @relation("company_billing_pricing_tier_storageTopricing_tiers", fields: [pricing_tier_storage], references: [id], onUpdate: NoAction, map: "company_billing_ibfk_3")
  pricing_tiers_company_billing_pricing_tier_bandwidthTopricing_tiers pricing_tiers?                          @relation("company_billing_pricing_tier_bandwidthTopricing_tiers", fields: [pricing_tier_bandwidth], references: [id], onUpdate: NoAction, map: "company_billing_ibfk_4")
  pricing_plans                                                       pricing_plans?                          @relation(fields: [current_pricing_plan_id], references: [id], onUpdate: NoAction, map: "company_billing_ibfk_5")

  @@index([current_pricing_plan_id], map: "current_pricing_plan_id")
  @@index([payment_method], map: "idx_payment_method")
  @@index([stripe_customer_id], map: "idx_stripe_customer")
  @@index([pricing_tier_bandwidth], map: "pricing_tier_bandwidth")
  @@index([pricing_tier_storage], map: "pricing_tier_storage")
  @@index([pricing_tier_vm], map: "pricing_tier_vm")
}

model company_clusters {
  id               Int              @id @default(autoincrement())
  company_id       Int
  cluster_id       Int
  assigned_at      DateTime?        @default(now()) @db.Timestamp(0)
  companies        companies        @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "company_clusters_ibfk_1")
  proxmox_clusters proxmox_clusters @relation(fields: [cluster_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "company_clusters_ibfk_2")

  @@unique([company_id, cluster_id], map: "unique_assignment")
  @@index([cluster_id], map: "idx_cluster")
  @@index([company_id], map: "idx_company")
  @@index([cluster_id], map: "idx_company_clusters_cluster")
  @@index([company_id], map: "idx_company_clusters_company")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model company_payment_methods {
  id                            Int                                          @id @default(autoincrement())
  company_id                    Int
  payment_type                  company_payment_methods_payment_type
  is_primary                    Boolean?                                     @default(false)
  is_active                     Boolean?                                     @default(true)
  stripe_customer_id            String?                                      @db.VarChar(255)
  stripe_payment_method_id      String?                                      @db.VarChar(255)
  stripe_card_last4             String?                                      @db.VarChar(4)
  stripe_card_brand             String?                                      @db.VarChar(50)
  stripe_card_exp_month         Int?
  stripe_card_exp_year          Int?
  paypal_email                  String?                                      @db.VarChar(255)
  paypal_payer_id               String?                                      @db.VarChar(255)
  paypal_subscription_id        String?                                      @db.VarChar(255)
  bank_account_name             String?                                      @db.VarChar(255)
  bank_account_number_encrypted String?                                      @db.Text
  bank_routing_number           String?                                      @db.VarChar(50)
  bank_name                     String?                                      @db.VarChar(255)
  bank_account_type             company_payment_methods_bank_account_type?
  bank_country                  String?                                      @db.VarChar(2)
  cc_name_on_card               String?                                      @db.VarChar(255)
  cc_number_encrypted           String?                                      @db.Text
  cc_last4                      String?                                      @db.VarChar(4)
  cc_brand                      String?                                      @db.VarChar(50)
  cc_exp_month                  Int?
  cc_exp_year                   Int?
  cc_cvv_hash                   String?                                      @db.VarChar(255)
  wire_swift_code               String?                                      @db.VarChar(50)
  wire_iban                     String?                                      @db.VarChar(50)
  wire_beneficiary_name         String?                                      @db.VarChar(255)
  wire_beneficiary_address      String?                                      @db.Text
  wire_bank_address             String?                                      @db.Text
  wire_reference                String?                                      @db.VarChar(100)
  payment_gateway               String?                                      @db.VarChar(50)
  gateway_customer_id           String?                                      @db.VarChar(255)
  gateway_token                 String?                                      @db.VarChar(255)
  gateway_metadata              Json?
  auto_charge_enabled           Boolean?                                     @default(false)
  preferred_currency            String?                                      @default("USD") @db.VarChar(3)
  billing_day_preference        Int?
  nickname                      String?                                      @db.VarChar(100)
  notes                         String?                                      @db.Text
  last_used_at                  DateTime?                                    @db.Timestamp(0)
  verified_at                   DateTime?                                    @db.Timestamp(0)
  verification_status           company_payment_methods_verification_status? @default(pending)
  created_at                    DateTime?                                    @default(now()) @db.Timestamp(0)
  updated_at                    DateTime?                                    @default(now()) @db.Timestamp(0)
  created_by                    Int?
  companies                     companies                                    @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "company_payment_methods_ibfk_1")
  users                         users?                                       @relation(fields: [created_by], references: [id], onUpdate: NoAction, map: "company_payment_methods_ibfk_2")
  payment_method_audit          payment_method_audit[]

  @@index([created_by], map: "created_by")
  @@index([company_id], map: "idx_company")
  @@index([is_primary], map: "idx_is_primary")
  @@index([payment_type], map: "idx_payment_type")
  @@index([stripe_customer_id], map: "idx_stripe_customer")
}

model company_pricing_plans {
  id              Int           @id @default(autoincrement())
  company_id      Int
  pricing_plan_id Int
  effective_date  DateTime      @db.Date
  expiry_date     DateTime?     @db.Date
  is_active       Boolean?      @default(true)
  assigned_by     Int?
  created_at      DateTime?     @default(now()) @db.Timestamp(0)
  companies       companies     @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "company_pricing_plans_ibfk_1")
  pricing_plans   pricing_plans @relation(fields: [pricing_plan_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "company_pricing_plans_ibfk_2")
  users           users?        @relation(fields: [assigned_by], references: [id], onUpdate: NoAction, map: "company_pricing_plans_ibfk_3")

  @@index([assigned_by], map: "assigned_by")
  @@index([is_active], map: "idx_active")
  @@index([company_id], map: "idx_company")
  @@index([pricing_plan_id], map: "pricing_plan_id")
}

model company_quotas {
  id                              Int                       @id @default(autoincrement())
  company_id                      Int
  cluster_id                      Int?
  quota_type                      company_quotas_quota_type
  quota_limit                     Decimal                   @db.Decimal(15, 2)
  current_usage                   Decimal?                  @default(0.00) @db.Decimal(15, 2)
  warn_threshold_percent          Int?                      @default(80)
  enforce                         Boolean?                  @default(true)
  allow_temporary_exceed          Boolean?                  @default(false)
  temporary_exceed_duration_hours Int?                      @default(24)
  notification_email              String?                   @db.VarChar(255)
  last_warning_sent               DateTime?                 @db.Timestamp(0)
  last_exceeded_at                DateTime?                 @db.Timestamp(0)
  created_by                      Int?
  created_at                      DateTime?                 @default(now()) @db.Timestamp(0)
  updated_at                      DateTime?                 @default(now()) @db.Timestamp(0)
  companies                       companies                 @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "company_quotas_ibfk_1")
  proxmox_clusters                proxmox_clusters?         @relation(fields: [cluster_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "company_quotas_ibfk_2")
  users                           users?                    @relation(fields: [created_by], references: [id], onUpdate: NoAction, map: "company_quotas_ibfk_3")
  quota_approval_requests         quota_approval_requests[]
  quota_usage_history             quota_usage_history[]
  quota_violations                quota_violations[]

  @@unique([company_id, cluster_id, quota_type], map: "unique_company_cluster_quota")
  @@index([cluster_id], map: "cluster_id")
  @@index([created_by], map: "created_by")
  @@index([company_id, enforce], map: "idx_company_enforce")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model company_sso_config {
  id                   Int                                  @id @default(autoincrement())
  company_id           Int
  provider             company_sso_config_provider?         @default(microsoft)
  client_id            String                               @db.VarChar(255)
  client_secret        String                               @db.VarChar(500)
  tenant_id            String?                              @db.VarChar(255)
  authority_url        String?                              @db.VarChar(500)
  redirect_uri         String                               @db.VarChar(500)
  scopes               String?                              @default("openid profile email User.Read") @db.VarChar(500)
  enabled              Boolean?                             @default(true)
  auto_provision       Boolean?                             @default(true)
  default_role         company_sso_config_default_role?     @default(user)
  require_domain_match Boolean?                             @default(true)
  allowed_domains      String?                              @db.Text
  attribute_mapping    String?                              @db.LongText
  settings             String?                              @db.LongText
  created_at           DateTime?                            @default(now()) @db.Timestamp(0)
  updated_at           DateTime?                            @default(now()) @db.Timestamp(0)
  created_by           Int?
  last_tested_at       DateTime?                            @db.Timestamp(0)
  last_test_status     company_sso_config_last_test_status?
  last_test_message    String?                              @db.Text
  companies            companies                            @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "company_sso_config_ibfk_1")
  users                users?                               @relation(fields: [created_by], references: [id], onUpdate: NoAction, map: "company_sso_config_ibfk_2")
  sso_login_audit      sso_login_audit[]

  @@unique([company_id, provider], map: "unique_company_provider")
  @@index([created_by], map: "created_by")
}

model company_storage_quotas {
  id                     Int           @id @default(autoincrement())
  company_id             Int
  storage_pool_id        Int
  quota_gb               Decimal       @db.Decimal(12, 2)
  used_gb                Decimal?      @default(0.00) @db.Decimal(12, 2)
  warn_threshold_percent Int?          @default(80)
  enforce                Boolean?      @default(true)
  created_at             DateTime?     @default(now()) @db.Timestamp(0)
  updated_at             DateTime?     @default(now()) @db.Timestamp(0)
  companies              companies     @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "company_storage_quotas_ibfk_1")
  storage_pools          storage_pools @relation(fields: [storage_pool_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "company_storage_quotas_ibfk_2")

  @@unique([company_id, storage_pool_id], map: "unique_company_storage")
  @@index([storage_pool_id], map: "storage_pool_id")
}

model company_subscriptions {
  id                     Int                           @id @default(autoincrement())
  company_id             Int
  plan_id                Int
  status                 company_subscriptions_status? @default(trial)
  trial_ends_at          DateTime?                     @db.Timestamp(0)
  current_period_start   DateTime                      @db.Timestamp(0)
  current_period_end     DateTime                      @db.Timestamp(0)
  cancel_at_period_end   Boolean?                      @default(false)
  cancelled_at           DateTime?                     @db.Timestamp(0)
  stripe_subscription_id String?                       @db.VarChar(255)
  stripe_customer_id     String?                       @db.VarChar(255)
  created_at             DateTime?                     @default(now()) @db.Timestamp(0)
  updated_at             DateTime?                     @default(now()) @db.Timestamp(0)
  companies              companies                     @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "company_subscriptions_ibfk_1")
  subscription_plans     subscription_plans            @relation(fields: [plan_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "company_subscriptions_ibfk_2")

  @@index([company_id], map: "idx_company")
  @@index([current_period_end], map: "idx_current_period_end")
  @@index([status], map: "idx_status")
  @@index([plan_id], map: "plan_id")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model company_url_mappings {
  id                       Int                                     @id @default(autoincrement())
  company_id               Int
  url_pattern              String                                  @unique(map: "unique_url") @db.VarChar(255)
  branding_name            String?                                 @db.VarChar(255)
  is_active                Boolean?                                @default(true)
  created_at               DateTime?                               @default(now()) @db.Timestamp(0)
  updated_at               DateTime?                               @default(now()) @db.Timestamp(0)
  ssl_enabled              Boolean?                                @default(false)
  ssl_certificate          String?                                 @db.Text
  ssl_private_key          String?                                 @db.Text
  ssl_chain                String?                                 @db.Text
  use_letsencrypt          Boolean?                                @default(false)
  letsencrypt_email        String?                                 @db.VarChar(255)
  letsencrypt_last_renewed DateTime?                               @db.Timestamp(0)
  ssl_status               company_url_mappings_ssl_status?        @default(pending)
  ssl_last_checked         DateTime?                               @db.Timestamp(0)
  ssl_error_message        String?                                 @db.Text
  logo_url                 String?                                 @db.VarChar(500)
  favicon_url              String?                                 @db.VarChar(500)
  primary_color            String?                                 @default("#0066cc") @db.VarChar(7)
  secondary_color          String?                                 @default("#004499") @db.VarChar(7)
  accent_color             String?                                 @default("#ff6600") @db.VarChar(7)
  font_family              String?                                 @default("Inter, Arial, sans-serif") @db.VarChar(255)
  custom_css               String?                                 @db.Text
  custom_header_html       String?                                 @db.Text
  custom_footer_html       String?                                 @db.Text
  meta_title               String?                                 @db.VarChar(255)
  meta_description         String?                                 @db.Text
  meta_keywords            String?                                 @db.VarChar(500)
  og_image_url             String?                                 @db.VarChar(500)
  terms_url                String?                                 @db.VarChar(500)
  privacy_url              String?                                 @db.VarChar(500)
  support_email            String?                                 @db.VarChar(255)
  support_phone            String?                                 @db.VarChar(50)
  language                 String?                                 @default("en") @db.VarChar(10)
  timezone                 String?                                 @default("UTC") @db.VarChar(50)
  currency                 String?                                 @default("USD") @db.VarChar(3)
  ga_tracking_id           String?                                 @db.VarChar(50)
  gtm_container_id         String?                                 @db.VarChar(50)
  fb_pixel_id              String?                                 @db.VarChar(50)
  custom_scripts           String?                                 @db.Text
  login_background_url     String?                                 @db.VarChar(500)
  login_logo_url           String?                                 @db.VarChar(500)
  welcome_message          String?                                 @db.Text
  hide_powered_by          Boolean?                                @default(false)
  white_label_level        company_url_mappings_white_label_level? @default(basic)
  branding_settings        Json?
  companies                companies                               @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "company_url_mappings_ibfk_1")
  email_templates          email_templates[]
  ui_customizations        ui_customizations[]
  whitelabel_assets        whitelabel_assets[]

  @@index([company_id, is_active], map: "idx_company_active")
  @@index([use_letsencrypt], map: "idx_company_url_mappings_letsencrypt")
  @@index([ssl_enabled], map: "idx_company_url_mappings_ssl_enabled")
  @@index([ssl_status], map: "idx_company_url_mappings_ssl_status")
  @@index([url_pattern], map: "idx_url_pattern")
  @@index([white_label_level], map: "idx_white_label_level")
}

model csrf_tokens {
  id         Int       @id @default(autoincrement())
  token_hash String    @db.VarChar(64)
  user_id    Int?
  session_id String?   @db.VarChar(64)
  expires_at DateTime  @db.Timestamp(0)
  used       Boolean?  @default(false)
  used_at    DateTime? @db.Timestamp(0)
  created_at DateTime? @default(now()) @db.Timestamp(0)

  @@index([expires_at], map: "idx_expires_at")
  @@index([token_hash], map: "idx_token_hash")
  @@index([user_id], map: "idx_user_id")
}

model customer_portal_sessions {
  id            Int       @id @default(autoincrement())
  user_id       Int
  company_id    Int
  session_token String    @unique(map: "session_token") @db.VarChar(255)
  ip_address    String?   @db.VarChar(45)
  user_agent    String?   @db.Text
  expires_at    DateTime  @db.Timestamp(0)
  created_at    DateTime? @default(now()) @db.Timestamp(0)
  users         users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "customer_portal_sessions_ibfk_1")
  companies     companies @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "customer_portal_sessions_ibfk_2")

  @@index([company_id], map: "company_id")
  @@index([expires_at], map: "idx_expires")
  @@index([session_token], map: "idx_token")
  @@index([user_id], map: "user_id")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model daily_vm_usage {
  id                       BigInt               @id @default(autoincrement()) @db.UnsignedBigInt
  vm_id                    Int
  company_id               Int
  cluster_id               Int
  project_id               Int?
  usage_date               DateTime             @db.Date
  avg_cpu_cores            Decimal              @db.Decimal(5, 2)
  avg_cpu_usage_percent    Decimal?             @default(0.00) @db.Decimal(5, 2)
  avg_memory_mb            Decimal              @db.Decimal(10, 2)
  avg_memory_usage_percent Decimal?             @default(0.00) @db.Decimal(5, 2)
  avg_disk_gb              Decimal              @db.Decimal(10, 2)
  total_cpu_hours          Decimal              @db.Decimal(15, 4)
  total_memory_gb_hours    Decimal              @db.Decimal(15, 4)
  total_disk_gb_hours      Decimal              @db.Decimal(15, 4)
  total_network_gb         Decimal?             @default(0.0000) @db.Decimal(15, 4)
  hours_running            Decimal              @default(0.0000) @db.Decimal(10, 4)
  hours_stopped            Decimal              @default(0.0000) @db.Decimal(10, 4)
  cost_cpu                 Decimal?             @default(0.0000) @db.Decimal(12, 4)
  cost_memory              Decimal?             @default(0.0000) @db.Decimal(12, 4)
  cost_storage             Decimal?             @default(0.0000) @db.Decimal(12, 4)
  cost_network             Decimal?             @default(0.0000) @db.Decimal(12, 4)
  total_cost               Decimal?             @default(0.0000) @db.Decimal(12, 4)
  pricing_tier_id          Int?
  metrics_collected        Int?                 @default(0)
  created_at               DateTime?            @default(now()) @db.Timestamp(0)
  updated_at               DateTime?            @default(now()) @db.Timestamp(0)
  proxmox_clusters         proxmox_clusters     @relation(fields: [cluster_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_daily_usage_cluster")
  companies                companies            @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_daily_usage_company")
  pricing_tiers            pricing_tiers?       @relation(fields: [pricing_tier_id], references: [id], onUpdate: NoAction, map: "fk_daily_usage_pricing")
  vm_projects              vm_projects?         @relation(fields: [project_id], references: [id], onUpdate: NoAction, map: "fk_daily_usage_project")
  virtual_machines         virtual_machines     @relation(fields: [vm_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_daily_usage_vm")
  invoice_line_items       invoice_line_items[]

  @@unique([vm_id, usage_date], map: "uk_vm_date")
  @@index([pricing_tier_id], map: "fk_daily_usage_pricing")
  @@index([cluster_id, usage_date], map: "idx_cluster_date")
  @@index([company_id, usage_date], map: "idx_company_date")
  @@index([project_id, usage_date], map: "idx_project_date")
  @@index([usage_date], map: "idx_usage_date")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model dr_automation_logs {
  id               Int                              @id @default(autoincrement())
  cluster_pair_id  Int?
  job_type         dr_automation_logs_job_type
  started_at       DateTime?                        @default(now()) @db.Timestamp(0)
  completed_at     DateTime?                        @db.Timestamp(0)
  duration_seconds Int?
  status           dr_automation_logs_status
  message          String?                          @db.Text
  error_details    String?                          @db.Text
  script_output    String?                          @db.LongText
  triggered_by     dr_automation_logs_triggered_by? @default(cron)
  user_id          Int?

  @@index([cluster_pair_id], map: "idx_cluster_pair")
  @@index([job_type], map: "idx_job_type")
  @@index([started_at], map: "idx_started_at")
  @@index([status], map: "idx_status")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model dr_cluster_pairs {
  id                                                                     Int                                  @id @default(autoincrement())
  primary_cluster_id                                                     Int
  dr_cluster_id                                                          Int
  pair_name                                                              String?                              @db.VarChar(255)
  replication_enabled                                                    Boolean?                             @default(true)
  replication_schedule                                                   String?                              @default("*/15 * * * *") @db.VarChar(100)
  replication_method                                                     dr_cluster_pairs_replication_method? @default(storage_replication)
  dr_network_mapping                                                     String?                              @db.LongText
  dr_ip_translation                                                      Boolean?                             @default(true)
  auto_failover_enabled                                                  Boolean?                             @default(false)
  failover_priority                                                      Int?                                 @default(100)
  max_failover_time                                                      Int?                                 @default(300)
  require_manual_approval                                                Boolean?                             @default(true)
  health_check_enabled                                                   Boolean?                             @default(true)
  health_check_interval                                                  Int?                                 @default(60)
  failure_threshold                                                      Int?                                 @default(3)
  status                                                                 dr_cluster_pairs_status?             @default(active)
  last_health_check                                                      DateTime?                            @db.Timestamp(0)
  last_sync                                                              DateTime?                            @db.Timestamp(0)
  last_failover                                                          DateTime?                            @db.Timestamp(0)
  created_by                                                             Int?
  created_at                                                             DateTime?                            @default(now()) @db.Timestamp(0)
  updated_at                                                             DateTime?                            @default(now()) @db.Timestamp(0)
  company_id                                                             Int?
  managed_by                                                             dr_cluster_pairs_managed_by?         @default(super_admin)
  proxmox_clusters_dr_cluster_pairs_primary_cluster_idToproxmox_clusters proxmox_clusters                     @relation("dr_cluster_pairs_primary_cluster_idToproxmox_clusters", fields: [primary_cluster_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "dr_cluster_pairs_ibfk_1")
  proxmox_clusters_dr_cluster_pairs_dr_cluster_idToproxmox_clusters      proxmox_clusters                     @relation("dr_cluster_pairs_dr_cluster_idToproxmox_clusters", fields: [dr_cluster_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "dr_cluster_pairs_ibfk_2")
  users                                                                  users?                               @relation(fields: [created_by], references: [id], onUpdate: NoAction, map: "dr_cluster_pairs_ibfk_3")
  companies                                                              companies?                           @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "dr_cluster_pairs_ibfk_4")
  dr_failover_events                                                     dr_failover_events[]
  dr_test_results                                                        dr_test_results[]
  dr_test_schedules                                                      dr_test_schedules[]
  dr_vm_policies                                                         dr_vm_policies[]
  dr_zfs_replication_jobs                                                dr_zfs_replication_jobs[]

  @@unique([primary_cluster_id, dr_cluster_id], map: "unique_cluster_pair")
  @@index([created_by], map: "created_by")
  @@index([dr_cluster_id], map: "dr_cluster_id")
  @@index([company_id], map: "idx_company")
  @@index([replication_enabled], map: "idx_replication_enabled")
  @@index([status], map: "idx_status")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model dr_company_quotas {
  id                           Int       @id @default(autoincrement())
  company_id                   Int       @unique(map: "unique_company")
  max_cluster_pairs            Int?      @default(1)
  max_replicated_vms           Int?      @default(10)
  max_dr_storage_gb            Int?      @default(500)
  current_dr_storage_gb        Int?      @default(0)
  min_rpo_minutes              Int?      @default(15)
  max_snapshot_retention_hours Int?      @default(168)
  auto_failover_allowed        Boolean?  @default(false)
  zfs_replication_allowed      Boolean?  @default(true)
  test_failover_allowed        Boolean?  @default(true)
  active_cluster_pairs         Int?      @default(0)
  active_replicated_vms        Int?      @default(0)
  dr_enabled                   Boolean?  @default(false)
  monthly_cost_usd             Decimal?  @default(0.00) @db.Decimal(10, 2)
  created_at                   DateTime? @default(now()) @db.Timestamp(0)
  updated_at                   DateTime? @default(now()) @db.Timestamp(0)
  companies                    companies @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "dr_company_quotas_ibfk_1")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model dr_config_templates {
  id                               Int                                @id @default(autoincrement())
  name                             String                             @db.VarChar(255)
  description                      String?                            @db.Text
  template_type                    dr_config_templates_template_type? @default(basic)
  default_rpo_minutes              Int?                               @default(15)
  default_rto_minutes              Int?                               @default(30)
  default_replication_schedule     String?                            @default("*/15 * * * *") @db.VarChar(100)
  default_auto_failover            Boolean?                           @default(false)
  default_snapshot_retention_hours Int?                               @default(72)
  network_mapping_template         String?                            @db.LongText
  is_default                       Boolean?                           @default(false)
  created_by                       Int?
  created_at                       DateTime?                          @default(now()) @db.Timestamp(0)
  updated_at                       DateTime?                          @default(now()) @db.Timestamp(0)
  users                            users?                             @relation(fields: [created_by], references: [id], onUpdate: NoAction, map: "dr_config_templates_ibfk_1")

  @@index([created_by], map: "created_by")
  @@index([is_default], map: "idx_is_default")
  @@index([template_type], map: "idx_template_type")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model dr_failover_events {
  id                    Int                             @id @default(autoincrement())
  cluster_pair_id       Int
  event_type            dr_failover_events_event_type
  trigger_type          dr_failover_events_trigger_type
  full_cluster_failover Boolean?                        @default(false)
  affected_vms          String?                         @db.LongText
  vm_count              Int?                            @default(0)
  initiated_by          Int?
  initiated_at          DateTime?                       @default(now()) @db.Timestamp(0)
  started_at            DateTime?                       @db.Timestamp(0)
  completed_at          DateTime?                       @db.Timestamp(0)
  duration_seconds      Int?
  status                dr_failover_events_status
  current_step          String?                         @db.VarChar(255)
  progress              Int?                            @default(0)
  vms_failed_over       Int?                            @default(0)
  vms_failed            Int?                            @default(0)
  success_rate          Decimal?                        @db.Decimal(5, 2)
  failure_reason        String?                         @db.Text
  failure_vms           String?                         @db.LongText
  rollback_required     Boolean?                        @default(false)
  rollback_completed    Boolean?                        @default(false)
  rollback_at           DateTime?                       @db.Timestamp(0)
  notes                 String?                         @db.Text
  created_at            DateTime?                       @default(now()) @db.Timestamp(0)
  updated_at            DateTime?                       @default(now()) @db.Timestamp(0)
  dr_cluster_pairs      dr_cluster_pairs                @relation(fields: [cluster_pair_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "dr_failover_events_ibfk_1")
  users                 users?                          @relation(fields: [initiated_by], references: [id], onUpdate: NoAction, map: "dr_failover_events_ibfk_2")

  @@index([cluster_pair_id], map: "idx_cluster_pair")
  @@index([cluster_pair_id, status, initiated_at], map: "idx_cluster_status_time")
  @@index([event_type], map: "idx_event_type")
  @@index([initiated_at], map: "idx_initiated_at")
  @@index([status], map: "idx_status")
  @@index([initiated_by], map: "initiated_by")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model dr_health_checks {
  id                      Int                         @id @default(autoincrement())
  cluster_pair_id         Int
  check_type              dr_health_checks_check_type
  check_time              DateTime?                   @default(now()) @db.Timestamp(0)
  check_duration_ms       Int?
  status                  dr_health_checks_status
  message                 String?                     @db.Text
  details                 String?                     @db.LongText
  primary_cluster_status  String?                     @db.VarChar(50)
  dr_cluster_status       String?                     @db.VarChar(50)
  replication_lag_seconds Int?
  alert_sent              Boolean?                    @default(false)
  alert_sent_at           DateTime?                   @db.Timestamp(0)

  @@index([check_time], map: "idx_check_time")
  @@index([check_type], map: "idx_check_type")
  @@index([cluster_pair_id], map: "idx_cluster_pair")
  @@index([cluster_pair_id, status, check_time], map: "idx_cluster_status")
  @@index([status], map: "idx_status")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model dr_replicated_vms {
  id                 Int                            @id @default(autoincrement())
  policy_id          Int
  primary_vm_id      Int
  primary_vmid       Int
  primary_node       String                         @db.VarChar(100)
  dr_vm_id           Int?
  dr_vmid            Int
  dr_node            String                         @db.VarChar(100)
  replication_job_id String?                        @db.VarChar(255)
  last_sync_start    DateTime?                      @db.Timestamp(0)
  last_sync_complete DateTime?                      @db.Timestamp(0)
  last_sync_duration Int?
  last_sync_size_mb  Decimal?                       @db.Decimal(10, 2)
  sync_progress      Int?                           @default(0)
  sync_status        dr_replicated_vms_sync_status? @default(idle)
  sync_error         String?                        @db.Text
  last_snapshot_id   String?                        @db.VarChar(255)
  last_snapshot_time DateTime?                      @db.Timestamp(0)
  snapshot_count     Int?                           @default(0)
  is_failed_over     Boolean?                       @default(false)
  failover_time      DateTime?                      @db.Timestamp(0)
  failback_ready     Boolean?                       @default(false)
  total_syncs        Int?                           @default(0)
  total_failures     Int?                           @default(0)
  total_bytes_synced BigInt?                        @default(0)
  average_sync_time  Int?
  created_at         DateTime?                      @default(now()) @db.Timestamp(0)
  updated_at         DateTime?                      @default(now()) @db.Timestamp(0)
  dr_vm_policies     dr_vm_policies                 @relation(fields: [policy_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "dr_replicated_vms_ibfk_1")

  @@unique([policy_id, primary_vmid], map: "unique_primary_vm")
  @@index([dr_vm_id], map: "idx_dr_vm")
  @@index([is_failed_over], map: "idx_failed_over")
  @@index([last_sync_complete], map: "idx_last_sync")
  @@index([policy_id], map: "idx_policy_id")
  @@index([policy_id, sync_status], map: "idx_policy_sync_status")
  @@index([primary_vm_id], map: "idx_primary_vm")
  @@index([sync_status], map: "idx_sync_status")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model dr_test_results {
  id                Int                    @id @default(autoincrement())
  test_schedule_id  Int?
  cluster_pair_id   Int
  test_type         String                 @db.VarChar(50)
  started_at        DateTime?              @default(now()) @db.Timestamp(0)
  completed_at      DateTime?              @db.Timestamp(0)
  duration_seconds  Int?
  triggered_by      Int?
  status            dr_test_results_status
  vms_tested        Int?                   @default(0)
  vms_passed        Int?                   @default(0)
  vms_failed        Int?                   @default(0)
  success_rate      Decimal?               @db.Decimal(5, 2)
  test_report       String?                @db.LongText
  failure_summary   String?                @db.Text
  cleanup_completed Boolean?               @default(false)
  cleanup_at        DateTime?              @db.Timestamp(0)
  dr_test_schedules dr_test_schedules?     @relation(fields: [test_schedule_id], references: [id], onUpdate: NoAction, map: "dr_test_results_ibfk_1")
  dr_cluster_pairs  dr_cluster_pairs       @relation(fields: [cluster_pair_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "dr_test_results_ibfk_2")
  users             users?                 @relation(fields: [triggered_by], references: [id], onUpdate: NoAction, map: "dr_test_results_ibfk_3")

  @@index([cluster_pair_id], map: "idx_cluster_pair")
  @@index([started_at], map: "idx_started_at")
  @@index([status], map: "idx_status")
  @@index([test_schedule_id], map: "idx_test_schedule")
  @@index([triggered_by], map: "triggered_by")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model dr_test_schedules {
  id                        Int                                @id @default(autoincrement())
  cluster_pair_id           Int
  test_name                 String                             @db.VarChar(255)
  description               String?                            @db.Text
  schedule_enabled          Boolean?                           @default(true)
  cron_schedule             String?                            @default("0 2 1 * *") @db.VarChar(100)
  test_type                 dr_test_schedules_test_type?       @default(boot_test)
  test_vms                  String?                            @db.LongText
  isolated_network          Boolean?                           @default(true)
  cleanup_after_test        Boolean?                           @default(true)
  max_test_duration_minutes Int?                               @default(60)
  notify_on_success         Boolean?                           @default(false)
  notify_on_failure         Boolean?                           @default(true)
  notification_emails       String?                            @db.Text
  last_run_at               DateTime?                          @db.Timestamp(0)
  last_run_status           dr_test_schedules_last_run_status?
  last_run_duration         Int?
  next_run_at               DateTime?                          @db.Timestamp(0)
  created_by                Int?
  created_at                DateTime?                          @default(now()) @db.Timestamp(0)
  updated_at                DateTime?                          @default(now()) @db.Timestamp(0)
  dr_test_results           dr_test_results[]
  dr_cluster_pairs          dr_cluster_pairs                   @relation(fields: [cluster_pair_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "dr_test_schedules_ibfk_1")
  users                     users?                             @relation(fields: [created_by], references: [id], onUpdate: NoAction, map: "dr_test_schedules_ibfk_2")

  @@index([created_by], map: "created_by")
  @@index([cluster_pair_id], map: "idx_cluster_pair")
  @@index([next_run_at], map: "idx_next_run")
  @@index([schedule_enabled], map: "idx_schedule_enabled")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model dr_vm_policies {
  id                       Int                                  @id @default(autoincrement())
  company_id               Int?
  project_id               Int?
  vm_id                    Int?
  cluster_pair_id          Int
  replication_enabled      Boolean?                             @default(true)
  replication_priority     dr_vm_policies_replication_priority? @default(medium)
  rpo_minutes              Int?                                 @default(15)
  rto_minutes              Int?                                 @default(30)
  snapshot_enabled         Boolean?                             @default(true)
  snapshot_retention_hours Int?                                 @default(72)
  snapshot_before_sync     Boolean?                             @default(true)
  dr_vmid_offset           Int?                                 @default(10000)
  dr_start_on_failover     Boolean?                             @default(true)
  dr_start_order           Int?                                 @default(100)
  verify_after_sync        Boolean?                             @default(true)
  test_boot_monthly        Boolean?                             @default(false)
  policy_enabled           Boolean?                             @default(true)
  last_replication         DateTime?                            @db.Timestamp(0)
  last_verification        DateTime?                            @db.Timestamp(0)
  replication_status       dr_vm_policies_replication_status?   @default(never_synced)
  created_by               Int?
  created_at               DateTime?                            @default(now()) @db.Timestamp(0)
  updated_at               DateTime?                            @default(now()) @db.Timestamp(0)
  dr_replicated_vms        dr_replicated_vms[]
  companies                companies?                           @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "dr_vm_policies_ibfk_1")
  vm_projects              vm_projects?                         @relation(fields: [project_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "dr_vm_policies_ibfk_2")
  dr_cluster_pairs         dr_cluster_pairs                     @relation(fields: [cluster_pair_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "dr_vm_policies_ibfk_3")
  users                    users?                               @relation(fields: [created_by], references: [id], onUpdate: NoAction, map: "dr_vm_policies_ibfk_4")

  @@index([created_by], map: "created_by")
  @@index([cluster_pair_id], map: "idx_cluster_pair")
  @@index([company_id], map: "idx_company")
  @@index([company_id, vm_id], map: "idx_company_vm")
  @@index([replication_priority], map: "idx_priority")
  @@index([project_id], map: "idx_project")
  @@index([replication_status], map: "idx_status")
  @@index([vm_id], map: "idx_vm")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model dr_zfs_replication_jobs {
  id                         Int                                       @id @default(autoincrement())
  cluster_pair_id            Int
  source_node                String                                    @db.VarChar(100)
  source_pool                String                                    @db.VarChar(100)
  source_dataset             String                                    @db.VarChar(255)
  dest_node                  String                                    @db.VarChar(100)
  dest_pool                  String                                    @db.VarChar(100)
  dest_dataset               String                                    @db.VarChar(255)
  replication_type           dr_zfs_replication_jobs_replication_type? @default(incremental)
  compression                dr_zfs_replication_jobs_compression?      @default(lz4)
  encryption_enabled         Boolean?                                  @default(false)
  schedule                   String?                                   @default("*/15 * * * *") @db.VarChar(100)
  enabled                    Boolean?                                  @default(true)
  ssh_user                   String?                                   @default("root") @db.VarChar(100)
  ssh_key_path               String?                                   @db.VarChar(255)
  last_sync_start            DateTime?                                 @db.Timestamp(0)
  last_sync_complete         DateTime?                                 @db.Timestamp(0)
  last_sync_bytes            BigInt?                                   @default(0)
  last_sync_duration_seconds Int?                                      @default(0)
  sync_status                dr_zfs_replication_jobs_sync_status?      @default(idle)
  sync_error                 String?                                   @db.Text
  total_syncs                Int?                                      @default(0)
  total_bytes_transferred    BigInt?                                   @default(0)
  created_at                 DateTime?                                 @default(now()) @db.Timestamp(0)
  updated_at                 DateTime?                                 @default(now()) @db.Timestamp(0)
  dr_cluster_pairs           dr_cluster_pairs                          @relation(fields: [cluster_pair_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "dr_zfs_replication_jobs_ibfk_1")

  @@index([cluster_pair_id], map: "idx_cluster_pair")
  @@index([enabled], map: "idx_enabled")
  @@index([sync_status], map: "idx_sync_status")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model email_queue {
  id              Int                @id @default(autoincrement())
  recipient_email String             @db.VarChar(255)
  recipient_name  String?            @db.VarChar(255)
  subject         String             @db.VarChar(500)
  body_html       String             @db.Text
  body_text       String?            @db.Text
  from_email      String?            @default("noreply@proxmox-multi-tenant.local") @db.VarChar(255)
  from_name       String?            @default("Proxmox Multi-Tenant") @db.VarChar(255)
  reply_to        String?            @db.VarChar(255)
  cc              String?            @db.VarChar(500)
  bcc             String?            @db.VarChar(500)
  status          email_queue_status @default(pending)
  priority        Int?               @default(5)
  scheduled_at    DateTime?          @db.Timestamp(0)
  sent_at         DateTime?          @db.Timestamp(0)
  error_message   String?            @db.Text
  retry_count     Int?               @default(0)
  max_retries     Int?               @default(3)
  last_retry_at   DateTime?          @db.Timestamp(0)
  next_retry_at   DateTime?          @db.Timestamp(0)
  context_type    String?            @db.VarChar(50)
  context_id      Int?
  company_id      Int?
  user_id         Int?
  attachments     Json?
  created_at      DateTime?          @default(now()) @db.Timestamp(0)
  updated_at      DateTime?          @default(now()) @db.Timestamp(0)
  companies       companies?         @relation(fields: [company_id], references: [id], onUpdate: NoAction, map: "email_queue_ibfk_1")
  users           users?             @relation(fields: [user_id], references: [id], onUpdate: NoAction, map: "email_queue_ibfk_2")

  @@index([company_id], map: "idx_company")
  @@index([context_type, context_id], map: "idx_context")
  @@index([created_at], map: "idx_created_at")
  @@index([next_retry_at], map: "idx_next_retry")
  @@index([priority], map: "idx_priority")
  @@index([status, scheduled_at, priority], map: "idx_processing")
  @@index([status, next_retry_at], map: "idx_retry_processing")
  @@index([scheduled_at], map: "idx_scheduled")
  @@index([status], map: "idx_status")
  @@index([user_id], map: "user_id")
}

model email_templates {
  id                    Int                           @id @default(autoincrement())
  company_id            Int?
  url_mapping_id        Int?
  template_type         email_templates_template_type
  template_slug         String                        @db.VarChar(255)
  subject               String                        @db.VarChar(255)
  html_body             String                        @db.LongText
  text_body             String?                       @db.Text
  available_variables   Json?
  is_active             Boolean?                      @default(true)
  is_default            Boolean?                      @default(false)
  parent_template_id    Int?
  created_at            DateTime?                     @default(now()) @db.Timestamp(0)
  updated_at            DateTime?                     @default(now()) @db.Timestamp(0)
  companies             companies?                    @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "email_templates_ibfk_1")
  company_url_mappings  company_url_mappings?         @relation(fields: [url_mapping_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "email_templates_ibfk_2")
  email_templates       email_templates?              @relation("email_templatesToemail_templates", fields: [parent_template_id], references: [id], onUpdate: NoAction, map: "email_templates_ibfk_3")
  other_email_templates email_templates[]             @relation("email_templatesToemail_templates")

  @@unique([company_id, url_mapping_id, template_slug], map: "unique_template")
  @@index([is_active], map: "idx_active")
  @@index([company_id], map: "idx_company")
  @@index([template_type], map: "idx_type")
  @@index([url_mapping_id], map: "idx_url_mapping")
  @@index([parent_template_id], map: "parent_template_id")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model email_templates_old {
  id                Int       @id @default(autoincrement())
  name              String    @unique(map: "name") @db.VarChar(100)
  notification_type String    @db.VarChar(50)
  subject           String    @db.VarChar(500)
  body_html         String    @db.Text
  body_text         String?   @db.Text
  variables         String?   @db.LongText
  is_active         Boolean?  @default(true)
  created_at        DateTime? @default(now()) @db.Timestamp(0)
  updated_at        DateTime? @default(now()) @db.Timestamp(0)
}

model email_verification_tokens {
  id                       Int                      @id @default(autoincrement())
  registration_id          Int
  email                    String                   @db.VarChar(255)
  token                    String                   @unique(map: "token") @db.VarChar(255)
  verified_at              DateTime?                @db.Timestamp(0)
  expires_at               DateTime                 @db.Timestamp(0)
  ip_address               String?                  @db.VarChar(45)
  created_at               DateTime?                @default(now()) @db.Timestamp(0)
  onboarding_registrations onboarding_registrations @relation(fields: [registration_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "email_verification_tokens_ibfk_1")

  @@index([email], map: "idx_email")
  @@index([registration_id], map: "idx_registration")
  @@index([token], map: "idx_token")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model esxi_discovered_vms {
  id               Int        @id @default(autoincrement())
  esxi_host_id     Int
  vm_name          String     @db.VarChar(255)
  vm_path          String?    @db.VarChar(500)
  power_state      String?    @db.VarChar(50)
  cpu_cores        Int?
  memory_mb        Int?
  disk_gb          Decimal?   @db.Decimal(10, 2)
  guest_os         String?    @db.VarChar(255)
  network_adapters String?    @db.LongText
  disk_info        String?    @db.LongText
  metadata         String?    @db.LongText
  discovered_at    DateTime?  @default(now()) @db.Timestamp(0)
  esxi_hosts       esxi_hosts @relation(fields: [esxi_host_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "esxi_discovered_vms_ibfk_1")

  @@unique([esxi_host_id, vm_name], map: "unique_vm")
  @@index([discovered_at], map: "idx_discovered_at")
  @@index([esxi_host_id], map: "idx_esxi_host")
}

model esxi_hosts {
  id                  Int                   @id @default(autoincrement())
  name                String                @db.VarChar(255)
  host                String                @db.VarChar(255)
  port                Int?                  @default(443)
  username            String                @db.VarChar(255)
  password_encrypted  String                @db.Text
  company_id          Int?
  status              esxi_hosts_status?    @default(active)
  last_tested         DateTime?             @db.Timestamp(0)
  last_test_message   String?               @db.Text
  notes               String?               @db.Text
  created_at          DateTime?             @default(now()) @db.Timestamp(0)
  updated_at          DateTime?             @default(now()) @db.Timestamp(0)
  created_by          Int
  esxi_discovered_vms esxi_discovered_vms[]
  companies           companies?            @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "esxi_hosts_ibfk_1")
  users               users                 @relation(fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "esxi_hosts_ibfk_2")
  vm_import_jobs      vm_import_jobs[]

  @@index([created_by], map: "created_by")
  @@index([company_id], map: "idx_company")
  @@index([status], map: "idx_status")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model export_history {
  id               Int                         @id @default(autoincrement())
  export_type      export_history_export_type
  file_format      export_history_file_format? @default(csv)
  filters_applied  String?                     @db.LongText
  columns_exported String                      @db.LongText
  row_count        Int?                        @default(0)
  file_size_kb     Int?                        @default(0)
  file_path        String?                     @db.VarChar(255)
  download_count   Int?                        @default(0)
  exported_by      Int?
  company_id       Int?
  created_at       DateTime?                   @default(now()) @db.Timestamp(0)
  expires_at       DateTime?                   @db.Timestamp(0)
  users            users?                      @relation(fields: [exported_by], references: [id], onUpdate: NoAction, map: "export_history_ibfk_1")
  companies        companies?                  @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "export_history_ibfk_2")

  @@index([company_id], map: "company_id")
  @@index([created_at], map: "idx_created_at")
  @@index([expires_at], map: "idx_expires_at")
  @@index([export_type], map: "idx_export_type")
  @@index([exported_by], map: "idx_exported_by")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model feedback_activity_log {
  id                   Int                  @id @default(autoincrement())
  feedback_id          Int
  user_id              Int
  action               String               @db.VarChar(100)
  old_value            String?              @db.VarChar(255)
  new_value            String?              @db.VarChar(255)
  details              String?              @db.Text
  created_at           DateTime?            @default(now()) @db.Timestamp(0)
  feedback_submissions feedback_submissions @relation(fields: [feedback_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "feedback_activity_log_ibfk_1")
  users                users                @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "feedback_activity_log_ibfk_2")

  @@index([action], map: "idx_action")
  @@index([feedback_id], map: "idx_feedback")
  @@index([user_id], map: "user_id")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model feedback_notifications {
  id                   Int                  @id @default(autoincrement())
  feedback_id          Int
  user_id              Int
  type                 String               @db.VarChar(50)
  is_read              Boolean?             @default(false)
  created_at           DateTime?            @default(now()) @db.Timestamp(0)
  read_at              DateTime?            @db.Timestamp(0)
  feedback_submissions feedback_submissions @relation(fields: [feedback_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "feedback_notifications_ibfk_1")
  users                users                @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "feedback_notifications_ibfk_2")

  @@index([feedback_id], map: "idx_feedback")
  @@index([user_id, is_read], map: "idx_user_unread")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model feedback_replies {
  id                   Int                  @id @default(autoincrement())
  feedback_id          Int
  user_id              Int
  message              String               @db.Text
  is_internal          Boolean?             @default(false)
  attachments          String?              @db.LongText
  created_at           DateTime?            @default(now()) @db.Timestamp(0)
  feedback_submissions feedback_submissions @relation(fields: [feedback_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "feedback_replies_ibfk_1")
  users                users                @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "feedback_replies_ibfk_2")

  @@index([created_at], map: "idx_created")
  @@index([feedback_id], map: "idx_feedback")
  @@index([user_id], map: "user_id")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model feedback_submissions {
  id                                            Int                            @id @default(autoincrement())
  company_id                                    Int
  user_id                                       Int
  type                                          feedback_submissions_type      @default(feedback)
  category                                      String?                        @db.VarChar(100)
  subject                                       String                         @db.VarChar(255)
  description                                   String                         @db.Text
  priority                                      feedback_submissions_priority? @default(medium)
  status                                        feedback_submissions_status?   @default(new)
  assigned_to                                   Int?
  attachments                                   String?                        @db.LongText
  metadata                                      String?                        @db.LongText
  created_at                                    DateTime?                      @default(now()) @db.Timestamp(0)
  updated_at                                    DateTime?                      @default(now()) @db.Timestamp(0)
  resolved_at                                   DateTime?                      @db.Timestamp(0)
  feedback_activity_log                         feedback_activity_log[]
  feedback_notifications                        feedback_notifications[]
  feedback_replies                              feedback_replies[]
  companies                                     companies                      @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "feedback_submissions_ibfk_1")
  users_feedback_submissions_user_idTousers     users                          @relation("feedback_submissions_user_idTousers", fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "feedback_submissions_ibfk_2")
  users_feedback_submissions_assigned_toTousers users?                         @relation("feedback_submissions_assigned_toTousers", fields: [assigned_to], references: [id], onUpdate: NoAction, map: "feedback_submissions_ibfk_3")

  @@index([assigned_to], map: "idx_assigned")
  @@index([company_id, status], map: "idx_company_status")
  @@index([created_at], map: "idx_created")
  @@index([type, status], map: "idx_type_status")
  @@index([user_id], map: "user_id")
}

model global_settings {
  id                  Int                              @id @default(autoincrement())
  setting_key         String                           @unique(map: "setting_key") @db.VarChar(100)
  setting_category    global_settings_setting_category @default(custom)
  setting_value_text  String?                          @db.Text
  setting_value_int   Int?
  setting_value_float Decimal?                         @db.Decimal(10, 2)
  setting_value_bool  Boolean?
  setting_value_json  Json?
  setting_type        global_settings_setting_type     @default(string)
  description         String?                          @db.Text
  is_public           Boolean?                         @default(false)
  is_editable         Boolean?                         @default(true)
  created_at          DateTime?                        @default(now()) @db.Timestamp(0)
  updated_at          DateTime?                        @default(now()) @db.Timestamp(0)
  updated_by          Int?

  @@index([setting_category], map: "idx_category")
  @@index([setting_key, setting_category], map: "idx_key_category")
  @@index([is_public], map: "idx_public")
}

model help_article_changelog {
  id             Int                           @id @default(autoincrement())
  article_id     Int
  changed_by     Int
  company_id     Int?
  action         help_article_changelog_action
  old_values     Json?
  new_values     Json?
  change_summary String?                       @db.Text
  changed_at     DateTime?                     @default(now()) @db.Timestamp(0)
  help_articles  help_articles                 @relation(fields: [article_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "help_article_changelog_ibfk_1")
  users          users                         @relation(fields: [changed_by], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "help_article_changelog_ibfk_2")
  companies      companies?                    @relation(fields: [company_id], references: [id], onUpdate: NoAction, map: "help_article_changelog_ibfk_3")

  @@index([changed_by], map: "changed_by")
  @@index([company_id], map: "company_id")
  @@index([article_id], map: "idx_article")
  @@index([changed_at], map: "idx_changed_at")
}

model help_article_drafts {
  id                   Int                               @id @default(autoincrement())
  article_id           Int?
  company_id           Int?
  title                String                            @db.VarChar(255)
  slug                 String                            @db.VarChar(255)
  category_id          Int
  summary              String?                           @db.Text
  content              String                            @db.MediumText
  content_type         help_article_drafts_content_type? @default(markdown)
  visibility           help_article_drafts_visibility?   @default(global)
  target_company_ids   Json?
  target_company_types Json?
  target_roles         Json?
  difficulty           help_article_drafts_difficulty?   @default(beginner)
  estimated_read_time  Int?                              @default(5)
  is_featured          Boolean?                          @default(false)
  created_by           Int
  created_at           DateTime?                         @default(now()) @db.Timestamp(0)
  updated_at           DateTime?                         @default(now()) @db.Timestamp(0)
  help_articles        help_articles?                    @relation(fields: [article_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "help_article_drafts_ibfk_1")
  companies            companies?                        @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "help_article_drafts_ibfk_2")
  help_categories      help_categories                   @relation(fields: [category_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "help_article_drafts_ibfk_3")
  users                users                             @relation(fields: [created_by], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "help_article_drafts_ibfk_4")

  @@index([category_id], map: "category_id")
  @@index([created_by], map: "created_by")
  @@index([article_id], map: "idx_article")
  @@index([company_id], map: "idx_company")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model help_articles {
  id                     Int                         @id @default(autoincrement())
  category_id            Int
  title                  String                      @db.VarChar(255)
  slug                   String                      @unique(map: "slug") @db.VarChar(255)
  summary                String?                     @db.Text
  content                String                      @db.MediumText
  content_type           help_articles_content_type? @default(markdown)
  page_context           String?                     @db.VarChar(100)
  feature_tag            String?                     @db.VarChar(100)
  difficulty             help_articles_difficulty?   @default(beginner)
  estimated_read_time    Int?                        @default(5)
  view_count             Int?                        @default(0)
  helpful_count          Int?                        @default(0)
  not_helpful_count      Int?                        @default(0)
  is_published           Boolean?                    @default(true)
  visibility             help_articles_visibility?   @default(global)
  is_featured            Boolean?                    @default(false)
  meta_keywords          String?                     @db.Text
  meta_description       String?                     @db.Text
  author_id              Int?
  published_at           DateTime?                   @db.Timestamp(0)
  created_at             DateTime?                   @default(now()) @db.Timestamp(0)
  updated_at             DateTime?                   @default(now()) @db.Timestamp(0)
  target_company_ids     Json?
  target_company_types   Json?
  target_roles           Json?
  created_by_company_id  Int?
  help_article_changelog help_article_changelog[]
  help_article_drafts    help_article_drafts[]
  help_categories        help_categories             @relation(fields: [category_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "help_articles_ibfk_1")
  users                  users?                      @relation(fields: [author_id], references: [id], onUpdate: NoAction, map: "help_articles_ibfk_2")
  companies              companies?                  @relation(fields: [created_by_company_id], references: [id], onUpdate: NoAction, map: "help_articles_ibfk_3")

  @@index([author_id], map: "author_id")
  @@index([category_id], map: "idx_category")
  @@index([created_by_company_id], map: "idx_created_by_company")
  @@index([feature_tag], map: "idx_feature_tag")
  @@index([is_featured], map: "idx_featured")
  @@index([page_context], map: "idx_page_context")
  @@index([is_published], map: "idx_published")
  @@index([slug], map: "idx_slug")
  @@index([visibility], map: "idx_visibility")
  @@fulltext([title, summary, content], map: "idx_search")
}

model help_categories {
  id                    Int                   @id @default(autoincrement())
  name                  String                @db.VarChar(100)
  slug                  String                @unique(map: "slug") @db.VarChar(100)
  description           String?               @db.Text
  icon                  String?               @default("HelpOutline") @db.VarChar(50)
  parent_id             Int?
  display_order         Int?                  @default(0)
  is_active             Boolean?              @default(true)
  created_at            DateTime?             @default(now()) @db.Timestamp(0)
  updated_at            DateTime?             @default(now()) @db.Timestamp(0)
  help_article_drafts   help_article_drafts[]
  help_articles         help_articles[]
  help_categories       help_categories?      @relation("help_categoriesTohelp_categories", fields: [parent_id], references: [id], onUpdate: NoAction, map: "help_categories_ibfk_1")
  other_help_categories help_categories[]     @relation("help_categoriesTohelp_categories")
  help_faqs             help_faqs[]

  @@index([is_active], map: "idx_active")
  @@index([parent_id], map: "idx_parent")
  @@index([slug], map: "idx_slug")
}

model help_faqs {
  id                    Int                    @id @default(autoincrement())
  category_id           Int
  question              String                 @db.Text
  answer                String                 @db.MediumText
  answer_type           help_faqs_answer_type? @default(markdown)
  page_context          String?                @db.VarChar(100)
  feature_tag           String?                @db.VarChar(100)
  display_order         Int?                   @default(0)
  view_count            Int?                   @default(0)
  helpful_count         Int?                   @default(0)
  not_helpful_count     Int?                   @default(0)
  is_published          Boolean?               @default(true)
  visibility            help_faqs_visibility?  @default(global)
  created_at            DateTime?              @default(now()) @db.Timestamp(0)
  updated_at            DateTime?              @default(now()) @db.Timestamp(0)
  target_company_ids    Json?
  target_company_types  Json?
  target_roles          Json?
  created_by_company_id Int?
  help_categories       help_categories        @relation(fields: [category_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "help_faqs_ibfk_1")
  companies             companies?             @relation(fields: [created_by_company_id], references: [id], onUpdate: NoAction, map: "help_faqs_ibfk_2")

  @@index([category_id], map: "idx_category")
  @@index([created_by_company_id], map: "idx_created_by_company")
  @@index([feature_tag], map: "idx_feature_tag")
  @@index([page_context], map: "idx_page_context")
  @@index([is_published], map: "idx_published")
  @@index([visibility], map: "idx_visibility")
  @@fulltext([question, answer], map: "idx_search")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model invoice_line_items {
  id               Int                          @id @default(autoincrement())
  invoice_id       Int
  line_type        invoice_line_items_line_type
  description      String                       @db.VarChar(255)
  quantity         Decimal                      @db.Decimal(10, 2)
  unit_price       Decimal                      @db.Decimal(10, 4)
  amount           Decimal                      @db.Decimal(12, 2)
  tax_rate         Decimal?                     @default(0.00) @db.Decimal(5, 2)
  tax_amount       Decimal?                     @default(0.00) @db.Decimal(12, 2)
  metadata         String?                      @db.LongText
  vm_id            Int?
  daily_usage_id   BigInt?                      @db.UnsignedBigInt
  daily_vm_usage   daily_vm_usage?              @relation(fields: [daily_usage_id], references: [id], onUpdate: NoAction, map: "fk_line_item_daily_usage")
  virtual_machines virtual_machines?            @relation(fields: [vm_id], references: [id], onUpdate: NoAction, map: "fk_line_item_vm")
  invoices         invoices                     @relation(fields: [invoice_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "invoice_line_items_ibfk_1")

  @@index([invoice_id], map: "idx_invoice")
  @@index([daily_usage_id], map: "idx_line_daily_usage")
  @@index([vm_id], map: "idx_line_vm")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model invoices {
  id                   Int                  @id @default(autoincrement())
  invoice_number       String               @unique(map: "invoice_number") @db.VarChar(50)
  company_id           Int
  billing_period_start DateTime             @db.Date
  billing_period_end   DateTime             @db.Date
  subtotal             Decimal              @db.Decimal(12, 2)
  tax_amount           Decimal?             @default(0.00) @db.Decimal(12, 2)
  discount_amount      Decimal?             @default(0.00) @db.Decimal(12, 2)
  total_amount         Decimal              @db.Decimal(12, 2)
  currency             String?              @default("USD") @db.VarChar(3)
  status               invoices_status?     @default(draft)
  due_date             DateTime             @db.Date
  issued_at            DateTime?            @default(now()) @db.Timestamp(0)
  paid_at              DateTime?            @db.Timestamp(0)
  payment_reference    String?              @db.VarChar(255)
  notes                String?              @db.Text
  pdf_generated        Boolean?             @default(false)
  pdf_file_path        String?              @db.VarChar(500)
  sent_to_email        String?              @db.VarChar(255)
  sent_at              DateTime?            @db.Timestamp(0)
  created_by           Int?
  usage_period_start   DateTime?            @db.Date
  usage_period_end     DateTime?            @db.Date
  auto_generated       Boolean?             @default(false)
  billing_audit_log    billing_audit_log[]
  invoice_line_items   invoice_line_items[]
  companies            companies            @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "invoices_ibfk_1")
  users                users?               @relation(fields: [created_by], references: [id], onUpdate: NoAction, map: "invoices_ibfk_2")
  payments             payments[]

  @@index([created_by], map: "created_by")
  @@index([billing_period_start, billing_period_end], map: "idx_billing_period")
  @@index([company_id, status], map: "idx_company_status")
  @@index([due_date], map: "idx_due_date")
  @@index([usage_period_start, usage_period_end], map: "idx_usage_period")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model ip_addresses {
  id          Int                  @id @default(autoincrement())
  range_id    Int
  ip_address  String               @db.VarChar(50)
  status      ip_addresses_status? @default(available)
  vm_id       Int?
  assigned_at DateTime?            @db.Timestamp(0)
  released_at DateTime?            @db.Timestamp(0)
  notes       String?              @db.Text
  created_at  DateTime?            @default(now()) @db.Timestamp(0)
  updated_at  DateTime?            @default(now()) @db.Timestamp(0)
  ip_ranges   ip_ranges            @relation(fields: [range_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "ip_addresses_ibfk_1")

  @@unique([range_id, ip_address], map: "unique_range_ip")
  @@index([ip_address], map: "idx_ip_address")
  @@index([range_id], map: "idx_range_id")
  @@index([status], map: "idx_status")
  @@index([vm_id], map: "idx_vm_id")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model ip_ranges {
  id                                                               Int                  @id @default(autoincrement())
  company_id                                                       Int?
  cluster_id                                                       Int
  subnet                                                           String               @db.VarChar(50)
  gateway                                                          String?              @db.VarChar(45)
  netmask                                                          String?              @db.VarChar(45)
  vlan_id                                                          Int?
  sdn_zone                                                         String?              @db.VarChar(100)
  sdn_vnet                                                         String?              @db.VarChar(100)
  description                                                      String?              @db.Text
  ip_type                                                          ip_ranges_ip_type?   @default(internal)
  is_shared                                                        Boolean?             @default(false)
  created_at                                                       DateTime?            @default(now()) @db.Timestamp(0)
  updated_at                                                       DateTime?            @default(now()) @db.Timestamp(0)
  ip_addresses                                                     ip_addresses[]
  companies                                                        companies?           @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "ip_ranges_ibfk_1")
  proxmox_clusters                                                 proxmox_clusters     @relation(fields: [cluster_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "ip_ranges_ibfk_2")
  ip_reservations                                                  ip_reservations[]
  opnsense_instances_opnsense_instances_wan_ip_range_idToip_ranges opnsense_instances[] @relation("opnsense_instances_wan_ip_range_idToip_ranges")
  opnsense_instances_opnsense_instances_lan_ip_range_idToip_ranges opnsense_instances[] @relation("opnsense_instances_lan_ip_range_idToip_ranges")
  vm_ip_assignments                                                vm_ip_assignments[]

  @@index([cluster_id], map: "idx_cluster")
  @@index([company_id], map: "idx_company")
  @@index([cluster_id], map: "idx_ip_ranges_cluster")
  @@index([company_id], map: "idx_ip_ranges_company")
  @@index([ip_type], map: "idx_ip_ranges_type")
  @@index([ip_type], map: "idx_ip_type")
  @@index([sdn_vnet], map: "idx_sdn_vnet")
  @@index([sdn_zone], map: "idx_sdn_zone")
  @@index([sdn_zone, sdn_vnet], map: "idx_sdn_zone_vnet")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model ip_reservations {
  id                                       Int                               @id @default(autoincrement())
  ip_range_id                              Int
  ip_address                               String                            @db.VarChar(45)
  reserved_by                              Int
  reserved_for                             String?                           @db.VarChar(255)
  reservation_type                         ip_reservations_reservation_type? @default(vm)
  notes                                    String?                           @db.Text
  reserved_at                              DateTime?                         @default(now()) @db.Timestamp(0)
  expires_at                               DateTime?                         @db.Timestamp(0)
  status                                   ip_reservations_status?           @default(active)
  fulfilled_at                             DateTime?                         @db.Timestamp(0)
  vm_id                                    Int?
  company_id                               Int
  created_by                               Int
  updated_at                               DateTime?                         @default(now()) @db.Timestamp(0)
  ip_ranges                                ip_ranges                         @relation(fields: [ip_range_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "ip_reservations_ibfk_1")
  users_ip_reservations_reserved_byTousers users                             @relation("ip_reservations_reserved_byTousers", fields: [reserved_by], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "ip_reservations_ibfk_2")
  companies                                companies                         @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "ip_reservations_ibfk_3")
  users_ip_reservations_created_byTousers  users                             @relation("ip_reservations_created_byTousers", fields: [created_by], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "ip_reservations_ibfk_4")
  virtual_machines                         virtual_machines?                 @relation(fields: [vm_id], references: [id], onUpdate: NoAction, map: "ip_reservations_ibfk_5")

  @@unique([ip_address, ip_range_id, status], map: "unique_active_reservation")
  @@index([created_by], map: "created_by")
  @@index([status, expires_at], map: "idx_active_expiring")
  @@index([company_id], map: "idx_company")
  @@index([expires_at], map: "idx_expires_at")
  @@index([ip_address], map: "idx_ip_address")
  @@index([reserved_by], map: "idx_reserved_by")
  @@index([status], map: "idx_status")
  @@index([ip_range_id], map: "ip_range_id")
  @@index([vm_id], map: "vm_id")
}

model iso_company_assignments {
  id          Int       @id @default(autoincrement())
  iso_id      Int
  company_id  Int
  assigned_at DateTime? @default(now()) @db.Timestamp(0)
  assigned_by Int?
  isos        isos      @relation(fields: [iso_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "iso_company_assignments_ibfk_1")
  companies   companies @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "iso_company_assignments_ibfk_2")
  users       users?    @relation(fields: [assigned_by], references: [id], onUpdate: NoAction, map: "iso_company_assignments_ibfk_3")

  @@unique([iso_id, company_id], map: "unique_iso_company")
  @@index([assigned_by], map: "assigned_by")
  @@index([company_id], map: "idx_company_id")
  @@index([iso_id], map: "idx_iso_id")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model isos {
  id                      Int                       @id @default(autoincrement())
  name                    String                    @db.VarChar(255)
  filename                String                    @db.VarChar(255)
  size_bytes              BigInt?
  company_id              Int?
  cluster_id              Int
  storage                 String                    @db.VarChar(100)
  node                    String?                   @db.VarChar(50)
  is_default              Boolean?                  @default(false)
  description             String?                   @db.Text
  uploaded_by             Int?
  created_at              DateTime?                 @default(now()) @db.Timestamp(0)
  updated_at              DateTime?                 @default(now()) @db.Timestamp(0)
  iso_company_assignments iso_company_assignments[]
  iso_sync_jobs           iso_sync_jobs[]

  @@index([cluster_id], map: "idx_cluster_id")
  @@index([company_id, is_default], map: "idx_company_default")
  @@index([company_id], map: "idx_company_id")
  @@index([is_default], map: "idx_is_default")
  @@index([uploaded_by], map: "idx_uploaded_by")
}

model monitoring_metrics {
  id               BigInt                         @id @default(autoincrement())
  vm_id            Int?
  cluster_id       Int?
  node_name        String?                        @db.VarChar(100)
  metric_type      monitoring_metrics_metric_type
  metric_name      String                         @db.VarChar(100)
  metric_value     Decimal                        @db.Decimal(15, 4)
  metric_unit      String                         @db.VarChar(20)
  collected_at     DateTime?                      @default(now()) @db.Timestamp(0)
  company_id       Int?
  virtual_machines virtual_machines?              @relation(fields: [vm_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "monitoring_metrics_ibfk_1")
  proxmox_clusters proxmox_clusters?              @relation(fields: [cluster_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "monitoring_metrics_ibfk_2")
  companies        companies?                     @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "monitoring_metrics_ibfk_3")

  @@index([cluster_id, metric_type, collected_at], map: "idx_cluster_metric_time")
  @@index([collected_at], map: "idx_collected_at")
  @@index([company_id, collected_at], map: "idx_company_time")
  @@index([vm_id, metric_type, collected_at], map: "idx_vm_metric_time")
}

model nat_deployment_log {
  id                Int                       @id @default(autoincrement())
  nat_rule_id       Int
  action            nat_deployment_log_action
  status            nat_deployment_log_status
  node_name         String?                   @db.VarChar(100)
  command_executed  String?                   @db.Text
  output            String?                   @db.Text
  error_message     String?                   @db.Text
  execution_time_ms Int?
  deployed_by       Int?
  deployed_at       DateTime?                 @default(now()) @db.Timestamp(0)
  nat_rules         nat_rules                 @relation(fields: [nat_rule_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "nat_deployment_log_ibfk_1")
  users             users?                    @relation(fields: [deployed_by], references: [id], onUpdate: NoAction, map: "nat_deployment_log_ibfk_2")

  @@index([deployed_by], map: "deployed_by")
  @@index([deployed_at], map: "idx_deployed_at")
  @@index([nat_rule_id], map: "idx_rule")
  @@index([status], map: "idx_status")
}

model nat_deployment_metrics {
  id                     Int                                    @id @default(autoincrement())
  nat_rule_id            Int?
  cluster_id             Int
  deployment_type        nat_deployment_metrics_deployment_type
  auth_method            nat_deployment_metrics_auth_method
  deployment_duration_ms Int
  success                Boolean
  error_message          String?                                @db.Text
  commands_executed      Int?                                   @default(1)
  deployed_at            DateTime?                              @default(now()) @db.Timestamp(0)
  deployed_by            Int?
  proxmox_clusters       proxmox_clusters                       @relation(fields: [cluster_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "nat_deployment_metrics_ibfk_1")

  @@index([auth_method], map: "idx_auth_method")
  @@index([cluster_id], map: "idx_cluster")
  @@index([deployed_at], map: "idx_deployed_at")
}

model nat_firewall_rules {
  id                                               Int                           @id @default(autoincrement())
  nat_rule_id                                      Int
  rule_name                                        String                        @db.VarChar(255)
  action                                           nat_firewall_rules_action?    @default(accept)
  source_ip                                        String?                       @db.VarChar(45)
  source_port                                      Int?
  destination_ip                                   String?                       @db.VarChar(45)
  destination_port                                 Int?
  protocol                                         nat_firewall_rules_protocol?  @default(any)
  direction                                        nat_firewall_rules_direction? @default(inbound)
  rule_order                                       Int?                          @default(100)
  enabled                                          Boolean?                      @default(true)
  description                                      String?                       @db.Text
  created_at                                       DateTime?                     @default(now()) @db.Timestamp(0)
  updated_at                                       DateTime?                     @default(now()) @db.Timestamp(0)
  created_by                                       Int?
  last_modified_by                                 Int?
  nat_rules                                        nat_rules                     @relation(fields: [nat_rule_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "nat_firewall_rules_ibfk_1")
  users_nat_firewall_rules_created_byTousers       users?                        @relation("nat_firewall_rules_created_byTousers", fields: [created_by], references: [id], onUpdate: NoAction, map: "nat_firewall_rules_ibfk_2")
  users_nat_firewall_rules_last_modified_byTousers users?                        @relation("nat_firewall_rules_last_modified_byTousers", fields: [last_modified_by], references: [id], onUpdate: NoAction, map: "nat_firewall_rules_ibfk_3")

  @@index([created_by], map: "created_by")
  @@index([enabled], map: "idx_enabled")
  @@index([nat_rule_id], map: "idx_nat_rule")
  @@index([rule_order], map: "idx_order")
  @@index([last_modified_by], map: "last_modified_by")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model nat_rules {
  id                                      Int                  @id @default(autoincrement())
  company_id                              Int
  cluster_id                              Int
  vm_id                                   Int?
  nat_type                                nat_rules_nat_type   @default(port_forward)
  rule_name                               String               @db.VarChar(255)
  external_ip                             String               @db.VarChar(45)
  external_port                           Int?
  internal_ip                             String               @db.VarChar(45)
  internal_port                           Int?
  protocol                                nat_rules_protocol?  @default(tcp)
  node_name                               String?              @db.VarChar(100)
  interface                               String?              @default("vmbr0") @db.VarChar(50)
  nat_mode                                nat_rules_nat_mode?  @default(dnat)
  opnsense_instance_id                    Int?
  opnsense_rule_uuid                      String?              @db.VarChar(100)
  status                                  nat_rules_status?    @default(pending)
  enabled                                 Boolean?             @default(true)
  auto_apply                              Boolean?             @default(true)
  description                             String?              @db.Text
  error_message                           String?              @db.Text
  last_applied_at                         DateTime?            @db.Timestamp(0)
  last_error_at                           DateTime?            @db.Timestamp(0)
  apply_count                             Int?                 @default(0)
  created_at                              DateTime?            @default(now()) @db.Timestamp(0)
  updated_at                              DateTime?            @default(now()) @db.Timestamp(0)
  created_by                              Int?
  last_modified_by                        Int?
  nat_deployment_log                      nat_deployment_log[]
  nat_firewall_rules                      nat_firewall_rules[]
  companies                               companies            @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "nat_rules_ibfk_1")
  proxmox_clusters                        proxmox_clusters     @relation(fields: [cluster_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "nat_rules_ibfk_2")
  virtual_machines                        virtual_machines?    @relation(fields: [vm_id], references: [id], onUpdate: NoAction, map: "nat_rules_ibfk_3")
  opnsense_instances                      opnsense_instances?  @relation(fields: [opnsense_instance_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "nat_rules_ibfk_4")
  users_nat_rules_created_byTousers       users?               @relation("nat_rules_created_byTousers", fields: [created_by], references: [id], onUpdate: NoAction, map: "nat_rules_ibfk_5")
  users_nat_rules_last_modified_byTousers users?               @relation("nat_rules_last_modified_byTousers", fields: [last_modified_by], references: [id], onUpdate: NoAction, map: "nat_rules_ibfk_6")
  nat_sessions                            nat_sessions[]
  nat_statistics                          nat_statistics[]

  @@unique([cluster_id, external_ip, external_port, protocol, status], map: "unique_external_rule")
  @@index([created_by], map: "created_by")
  @@index([company_id, cluster_id], map: "idx_company_cluster")
  @@index([enabled, status], map: "idx_enabled")
  @@index([external_ip, external_port], map: "idx_external")
  @@index([internal_ip, internal_port], map: "idx_internal")
  @@index([nat_type], map: "idx_nat_type")
  @@index([node_name], map: "idx_node")
  @@index([status], map: "idx_status")
  @@index([vm_id], map: "idx_vm")
  @@index([last_modified_by], map: "last_modified_by")
  @@index([opnsense_instance_id], map: "opnsense_instance_id")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model nat_sessions {
  id                     Int       @id @default(autoincrement())
  nat_rule_id            Int
  source_ip              String    @db.VarChar(45)
  source_port            Int
  dest_ip                String    @db.VarChar(45)
  dest_port              Int
  protocol               String    @db.VarChar(10)
  translated_source_ip   String?   @db.VarChar(45)
  translated_source_port Int?
  translated_dest_ip     String?   @db.VarChar(45)
  translated_dest_port   Int?
  state                  String?   @db.VarChar(50)
  bytes_sent             BigInt?   @default(0)
  bytes_received         BigInt?   @default(0)
  packets_sent           BigInt?   @default(0)
  packets_received       BigInt?   @default(0)
  established_at         DateTime? @default(now()) @db.Timestamp(0)
  last_seen_at           DateTime? @default(now()) @db.Timestamp(0)
  closed_at              DateTime? @db.Timestamp(0)
  nat_rules              nat_rules @relation(fields: [nat_rule_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "nat_sessions_ibfk_1")

  @@index([closed_at], map: "idx_active")
  @@index([established_at], map: "idx_established")
  @@index([nat_rule_id], map: "idx_nat_rule")
  @@index([source_ip, source_port], map: "idx_source")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model nat_statistics {
  id                   Int       @id @default(autoincrement())
  nat_rule_id          Int
  stat_date            DateTime  @db.Date
  stat_hour            Int?
  total_connections    Int?      @default(0)
  active_connections   Int?      @default(0)
  failed_connections   Int?      @default(0)
  total_bytes          BigInt?   @default(0)
  total_packets        BigInt?   @default(0)
  avg_duration_seconds Int?      @default(0)
  created_at           DateTime? @default(now()) @db.Timestamp(0)
  nat_rules            nat_rules @relation(fields: [nat_rule_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "nat_statistics_ibfk_1")

  @@unique([nat_rule_id, stat_date, stat_hour], map: "unique_stat")
  @@index([stat_date], map: "idx_date")
  @@index([nat_rule_id, stat_date], map: "idx_rule_date")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model network_edges {
  id               Int                      @id @default(autoincrement())
  company_id       Int
  cluster_id       Int
  edge_type        network_edges_edge_type? @default(firewall)
  edge_vmid        Int?
  edge_name        String?                  @db.VarChar(255)
  config           String?                  @db.LongText
  status           network_edges_status?    @default(active)
  created_at       DateTime?                @default(now()) @db.Timestamp(0)
  updated_at       DateTime?                @default(now()) @db.Timestamp(0)
  companies        companies                @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "network_edges_ibfk_1")
  proxmox_clusters proxmox_clusters         @relation(fields: [cluster_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "network_edges_ibfk_2")

  @@index([cluster_id], map: "cluster_id")
  @@index([company_id], map: "idx_company")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model notification_queue {
  id                Int                          @id @default(autoincrement())
  user_id           Int
  notification_type String                       @db.VarChar(50)
  recipient_email   String                       @db.VarChar(255)
  subject           String                       @db.VarChar(500)
  body_html         String                       @db.Text
  body_text         String?                      @db.Text
  priority          notification_queue_priority? @default(normal)
  status            notification_queue_status?   @default(pending)
  attempts          Int?                         @default(0)
  max_attempts      Int?                         @default(3)
  last_attempt      DateTime?                    @db.Timestamp(0)
  sent_at           DateTime?                    @db.Timestamp(0)
  error_message     String?                      @db.Text
  metadata          String?                      @db.LongText
  scheduled_for     DateTime?                    @db.Timestamp(0)
  created_at        DateTime?                    @default(now()) @db.Timestamp(0)
  users             users                        @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "notification_queue_ibfk_1")

  @@index([status, priority, scheduled_for], map: "idx_status_priority")
  @@index([user_id, notification_type], map: "idx_user_type")
}

model notification_settings {
  id                Int       @id @default(autoincrement())
  user_id           Int
  notification_type String    @db.VarChar(50)
  email_enabled     Boolean?  @default(true)
  webhook_url       String?   @db.VarChar(500)
  webhook_enabled   Boolean?  @default(false)
  created_at        DateTime? @default(now()) @db.Timestamp(0)
  updated_at        DateTime? @default(now()) @db.Timestamp(0)
  users             users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "notification_settings_ibfk_1")

  @@unique([user_id, notification_type], map: "unique_user_type")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model onboarding_registrations {
  id                        Int                                    @id @default(autoincrement())
  tracking_code             String                                 @unique(map: "tracking_code") @db.VarChar(50)
  company_name              String                                 @db.VarChar(255)
  contact_email             String                                 @db.VarChar(255)
  contact_name              String?                                @db.VarChar(255)
  contact_phone             String?                                @db.VarChar(50)
  industry                  String?                                @db.VarChar(100)
  company_size              onboarding_registrations_company_size?
  country                   String?                                @db.VarChar(100)
  timezone                  String?                                @default("UTC") @db.VarChar(100)
  utm_source                String?                                @db.VarChar(255)
  utm_medium                String?                                @db.VarChar(255)
  utm_campaign              String?                                @db.VarChar(255)
  registration_data         Json?
  status                    onboarding_registrations_status?       @default(pending)
  rejection_reason          String?                                @db.Text
  approved_by               Int?
  approved_at               DateTime?                              @db.Timestamp(0)
  completed_at              DateTime?                              @db.Timestamp(0)
  created_via               onboarding_registrations_created_via?  @default(api)
  api_token_id              Int?
  company_id                Int?
  created_at                DateTime?                              @default(now()) @db.Timestamp(0)
  updated_at                DateTime?                              @default(now()) @db.Timestamp(0)
  email_verification_tokens email_verification_tokens[]
  api_tokens                api_tokens?                            @relation(fields: [api_token_id], references: [id], onUpdate: NoAction, map: "onboarding_registrations_ibfk_1")
  users                     users?                                 @relation(fields: [approved_by], references: [id], onUpdate: NoAction, map: "onboarding_registrations_ibfk_2")
  companies                 companies?                             @relation(fields: [company_id], references: [id], onUpdate: NoAction, map: "onboarding_registrations_ibfk_3")
  onboarding_steps          onboarding_steps[]

  @@index([api_token_id], map: "api_token_id")
  @@index([approved_by], map: "approved_by")
  @@index([company_id], map: "company_id")
  @@index([created_at], map: "idx_created_at")
  @@index([contact_email], map: "idx_email")
  @@index([status], map: "idx_status")
  @@index([tracking_code], map: "idx_tracking_code")
}

model onboarding_steps {
  id                       Int                      @id @default(autoincrement())
  registration_id          Int
  step_name                String                   @db.VarChar(100)
  step_order               Int
  status                   onboarding_steps_status? @default(pending)
  step_data                Json?
  completed_at             DateTime?                @db.Timestamp(0)
  error_message            String?                  @db.Text
  created_at               DateTime?                @default(now()) @db.Timestamp(0)
  updated_at               DateTime?                @default(now()) @db.Timestamp(0)
  onboarding_registrations onboarding_registrations @relation(fields: [registration_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "onboarding_steps_ibfk_1")

  @@unique([registration_id, step_name], map: "unique_registration_step")
  @@index([registration_id], map: "idx_registration")
  @@index([status], map: "idx_status")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model onboarding_templates {
  id           Int       @id @default(autoincrement())
  name         String    @db.VarChar(255)
  description  String?   @db.Text
  steps_config Json
  is_default   Boolean?  @default(false)
  is_active    Boolean?  @default(true)
  created_at   DateTime? @default(now()) @db.Timestamp(0)
  updated_at   DateTime? @default(now()) @db.Timestamp(0)

  @@index([is_active], map: "idx_is_active")
  @@index([is_default], map: "idx_is_default")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model opnsense_firewall_rules {
  id                  Int                                       @id @default(autoincrement())
  opnsense_id         Int
  rule_name           String                                    @db.VarChar(255)
  rule_description    String?                                   @db.Text
  interface           String                                    @db.VarChar(50)
  direction           opnsense_firewall_rules_direction?        @default(in)
  action              opnsense_firewall_rules_action?           @default(pass)
  protocol            String?                                   @default("any") @db.VarChar(20)
  source_type         opnsense_firewall_rules_source_type?      @default(any)
  source_address      String?                                   @db.VarChar(100)
  source_port         String?                                   @db.VarChar(20)
  destination_type    opnsense_firewall_rules_destination_type? @default(any)
  destination_address String?                                   @db.VarChar(100)
  destination_port    String?                                   @db.VarChar(20)
  enabled             Boolean?                                  @default(true)
  priority            Int?                                      @default(1000)
  created_at          DateTime?                                 @default(now()) @db.Timestamp(0)
  updated_at          DateTime?                                 @default(now()) @db.Timestamp(0)
  opnsense_instances  opnsense_instances                        @relation(fields: [opnsense_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "opnsense_firewall_rules_ibfk_1")

  @@index([enabled], map: "idx_enabled")
  @@index([opnsense_id], map: "idx_opnsense")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model opnsense_instances {
  id                                                      Int                                   @id @default(autoincrement())
  company_id                                              Int
  project_id                                              Int?
  cluster_id                                              Int
  vm_id                                                   Int?                                  @unique(map: "vm_id")
  template_id                                             Int?
  name                                                    String                                @db.VarChar(255)
  hostname                                                String                                @unique(map: "unique_hostname") @db.VarChar(255)
  node                                                    String                                @db.VarChar(100)
  vmid                                                    Int
  wan_interface                                           String                                @default("vtnet0") @db.VarChar(50)
  wan_bridge                                              String                                @db.VarChar(50)
  wan_vlan_id                                             Int?
  wan_ip_range_id                                         Int?
  wan_ip                                                  String?                               @db.VarChar(45)
  wan_subnet_mask                                         String?                               @db.VarChar(45)
  wan_gateway                                             String?                               @db.VarChar(45)
  wan_dhcp                                                Boolean?                              @default(false)
  lan_interface                                           String                                @default("vtnet1") @db.VarChar(50)
  lan_bridge                                              String                                @db.VarChar(50)
  lan_vlan_id                                             Int?
  lan_ip_range_id                                         Int?
  lan_subnet                                              String                                @db.VarChar(50)
  lan_gateway                                             String                                @db.VarChar(45)
  dns_primary                                             String?                               @db.VarChar(45)
  dns_secondary                                           String?                               @db.VarChar(45)
  dns_forwarder_enabled                                   Boolean?                              @default(true)
  nat_enabled                                             Boolean?                              @default(true)
  dhcp_server_enabled                                     Boolean?                              @default(true)
  dhcp_range_start                                        String?                               @db.VarChar(45)
  dhcp_range_end                                          String?                               @db.VarChar(45)
  default_lan_allow                                       Boolean?                              @default(true)
  config_backup                                           String?                               @db.Text
  webgui_port                                             Int?                                  @default(443)
  webgui_protocol                                         String?                               @default("https") @db.VarChar(10)
  admin_username                                          String?                               @default("root") @db.VarChar(100)
  admin_password_encrypted                                String?                               @db.Text
  deployment_status                                       opnsense_instances_deployment_status? @default(pending)
  deployment_error                                        String?                               @db.Text
  last_config_sync                                        DateTime?                             @db.Timestamp(0)
  created_at                                              DateTime?                             @default(now()) @db.Timestamp(0)
  updated_at                                              DateTime?                             @default(now()) @db.Timestamp(0)
  deployed_at                                             DateTime?                             @db.Timestamp(0)
  admin_password                                          String?                               @db.VarChar(255)
  config_xml                                              String?                               @db.MediumText
  config_generated_at                                     DateTime?                             @db.DateTime(0)
  config_applied_at                                       DateTime?                             @db.Timestamp(0)
  nat_rules                                               nat_rules[]
  opnsense_firewall_rules                                 opnsense_firewall_rules[]
  companies                                               companies                             @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "opnsense_instances_ibfk_1")
  vm_projects_opnsense_instances_project_idTovm_projects  vm_projects?                          @relation("opnsense_instances_project_idTovm_projects", fields: [project_id], references: [id], onUpdate: NoAction, map: "opnsense_instances_ibfk_2")
  proxmox_clusters                                        proxmox_clusters                      @relation(fields: [cluster_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "opnsense_instances_ibfk_3")
  virtual_machines                                        virtual_machines?                     @relation(fields: [vm_id], references: [id], onUpdate: NoAction, map: "opnsense_instances_ibfk_4")
  opnsense_templates                                      opnsense_templates?                   @relation(fields: [template_id], references: [id], onUpdate: NoAction, map: "opnsense_instances_ibfk_5")
  ip_ranges_opnsense_instances_wan_ip_range_idToip_ranges ip_ranges?                            @relation("opnsense_instances_wan_ip_range_idToip_ranges", fields: [wan_ip_range_id], references: [id], onUpdate: NoAction, map: "opnsense_instances_ibfk_6")
  ip_ranges_opnsense_instances_lan_ip_range_idToip_ranges ip_ranges?                            @relation("opnsense_instances_lan_ip_range_idToip_ranges", fields: [lan_ip_range_id], references: [id], onUpdate: NoAction, map: "opnsense_instances_ibfk_7")
  vm_projects_vm_projects_opnsense_idToopnsense_instances vm_projects[]                         @relation("vm_projects_opnsense_idToopnsense_instances")

  @@index([cluster_id], map: "idx_cluster")
  @@index([company_id], map: "idx_company")
  @@index([deployment_status], map: "idx_deployment_status")
  @@index([company_id], map: "idx_opnsense_company")
  @@index([project_id], map: "idx_opnsense_project")
  @@index([project_id], map: "idx_project")
  @@index([deployment_status], map: "idx_status")
  @@index([lan_ip_range_id], map: "lan_ip_range_id")
  @@index([template_id], map: "template_id")
  @@index([wan_ip_range_id], map: "wan_ip_range_id")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model opnsense_templates {
  id                    Int                  @id @default(autoincrement())
  name                  String               @db.VarChar(255)
  description           String?              @db.Text
  cpu_cores             Int                  @default(2)
  memory_mb             Int                  @default(2048)
  storage_gb            Int                  @default(20)
  iso_storage           String               @default("local") @db.VarChar(100)
  iso_filename          String               @default("OPNsense-25.7-dvd-amd64.iso") @db.VarChar(255)
  wan_bridge            String               @default("vmbr0") @db.VarChar(50)
  lan_vlan_enabled      Boolean?             @default(true)
  lan_bridge_prefix     String?              @default("vmbr") @db.VarChar(50)
  wan_dhcp              Boolean?             @default(false)
  default_wan_gateway   String?              @db.VarChar(45)
  default_dns_primary   String?              @default("8.8.8.8") @db.VarChar(45)
  default_dns_secondary String?              @default("8.8.4.4") @db.VarChar(45)
  default_lan_subnet    String?              @default("192.168.1.0/24") @db.VarChar(50)
  default_lan_gateway   String?              @default("192.168.1.1") @db.VarChar(45)
  enable_nat            Boolean?             @default(true)
  enable_dhcp_server    Boolean?             @default(true)
  is_default            Boolean?             @default(false)
  created_by            Int?
  created_at            DateTime?            @default(now()) @db.Timestamp(0)
  updated_at            DateTime?            @default(now()) @db.Timestamp(0)
  template_vmid         Int?
  is_template           Boolean?             @default(true)
  opnsense_instances    opnsense_instances[]
  users                 users?               @relation(fields: [created_by], references: [id], onUpdate: NoAction, map: "opnsense_templates_ibfk_1")

  @@index([created_by], map: "created_by")
  @@index([is_default], map: "idx_is_default")
  @@index([template_vmid], map: "idx_template_vmid")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model payment_method_audit {
  id                      Int                         @id @default(autoincrement())
  company_id              Int
  payment_method_id       Int?
  action                  payment_method_audit_action
  old_values              Json?
  new_values              Json?
  description             String                      @db.Text
  amount                  Decimal?                    @db.Decimal(10, 2)
  performed_by            Int?
  ip_address              String?                     @db.VarChar(45)
  created_at              DateTime?                   @default(now()) @db.Timestamp(0)
  companies               companies                   @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "payment_method_audit_ibfk_1")
  company_payment_methods company_payment_methods?    @relation(fields: [payment_method_id], references: [id], onUpdate: NoAction, map: "payment_method_audit_ibfk_2")
  users                   users?                      @relation(fields: [performed_by], references: [id], onUpdate: NoAction, map: "payment_method_audit_ibfk_3")

  @@index([action], map: "idx_action")
  @@index([company_id], map: "idx_company")
  @@index([payment_method_id], map: "payment_method_id")
  @@index([performed_by], map: "performed_by")
}

model payments {
  id                             Int                     @id @default(autoincrement())
  invoice_id                     Int
  company_id                     Int
  amount                         Decimal                 @db.Decimal(12, 2)
  currency                       String?                 @default("USD") @db.VarChar(3)
  payment_method                 payments_payment_method
  payment_reference              String?                 @db.VarChar(255)
  payment_gateway_transaction_id String?                 @db.VarChar(255)
  status                         payments_status?        @default(pending)
  paid_at                        DateTime?               @db.Timestamp(0)
  notes                          String?                 @db.Text
  created_by                     Int?
  created_at                     DateTime?               @default(now()) @db.Timestamp(0)
  invoices                       invoices                @relation(fields: [invoice_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "payments_ibfk_1")
  companies                      companies               @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "payments_ibfk_2")
  users                          users?                  @relation(fields: [created_by], references: [id], onUpdate: NoAction, map: "payments_ibfk_3")

  @@index([created_by], map: "created_by")
  @@index([company_id, status], map: "idx_company_status")
  @@index([invoice_id], map: "idx_invoice")
}

model permissions {
  id                  Int                   @id @default(autoincrement())
  code                String                @unique(map: "code") @db.VarChar(100)
  name                String                @db.VarChar(100)
  description         String?               @db.Text
  category            String?               @db.VarChar(50)
  created_at          DateTime?             @default(now()) @db.Timestamp(0)
  profile_permissions profile_permissions[]
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model pricing_assignments {
  id              Int                               @id @default(autoincrement())
  pricing_tier_id Int
  resource_type   pricing_assignments_resource_type
  resource_id     Int
  effective_from  DateTime                          @db.Date
  effective_to    DateTime?                         @db.Date
  notes           String?                           @db.Text
  created_at      DateTime?                         @default(now()) @db.Timestamp(0)
  created_by      Int?
  pricing_tiers   pricing_tiers                     @relation(fields: [pricing_tier_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "pricing_assignments_ibfk_1")
  users           users?                            @relation(fields: [created_by], references: [id], onUpdate: NoAction, map: "pricing_assignments_ibfk_2")

  @@index([created_by], map: "created_by")
  @@index([resource_type, resource_id, effective_from, effective_to], map: "idx_resource_lookup")
  @@index([pricing_tier_id], map: "pricing_tier_id")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model pricing_plans {
  id                       Int                          @id @default(autoincrement())
  name                     String                       @db.VarChar(100)
  description              String?                      @db.Text
  company_id               Int?
  base_price               Decimal                      @db.Decimal(10, 2)
  included_cpu_cores       Int?                         @default(2)
  included_memory_gb       Int?                         @default(4)
  included_storage_gb      Int?                         @default(50)
  overage_cpu_core_price   Decimal                      @db.Decimal(10, 4)
  overage_memory_gb_price  Decimal                      @db.Decimal(10, 4)
  overage_storage_gb_price Decimal                      @db.Decimal(10, 4)
  billing_cycle            pricing_plans_billing_cycle? @default(monthly)
  is_active                Boolean?                     @default(true)
  is_default               Boolean?                     @default(false)
  display_order            Int?                         @default(0)
  created_at               DateTime?                    @default(now()) @db.Timestamp(0)
  updated_at               DateTime?                    @default(now()) @db.Timestamp(0)
  company_billing          company_billing[]
  company_pricing_plans    company_pricing_plans[]
  companies                companies?                   @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "pricing_plans_ibfk_1")

  @@index([is_active], map: "idx_active")
  @@index([company_id], map: "idx_company")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model pricing_tiers {
  id                                                                    Int                          @id @default(autoincrement())
  name                                                                  String                       @db.VarChar(100)
  description                                                           String?                      @db.Text
  tier_type                                                             pricing_tiers_tier_type
  company_id                                                            Int?
  project_id                                                            Int?
  unit_price                                                            Decimal                      @db.Decimal(10, 4)
  currency                                                              String?                      @default("USD") @db.VarChar(3)
  billing_cycle                                                         pricing_tiers_billing_cycle? @default(monthly)
  min_units                                                             Int?                         @default(0)
  max_units                                                             Int?
  overage_price                                                         Decimal?                     @db.Decimal(10, 4)
  active                                                                Boolean?                     @default(true)
  created_at                                                            DateTime?                    @default(now()) @db.Timestamp(0)
  updated_at                                                            DateTime?                    @default(now()) @db.Timestamp(0)
  is_default                                                            Boolean?                     @default(false)
  priority                                                              Int?                         @default(0)
  company_billing_company_billing_pricing_tier_vmTopricing_tiers        company_billing[]            @relation("company_billing_pricing_tier_vmTopricing_tiers")
  company_billing_company_billing_pricing_tier_storageTopricing_tiers   company_billing[]            @relation("company_billing_pricing_tier_storageTopricing_tiers")
  company_billing_company_billing_pricing_tier_bandwidthTopricing_tiers company_billing[]            @relation("company_billing_pricing_tier_bandwidthTopricing_tiers")
  daily_vm_usage                                                        daily_vm_usage[]
  pricing_assignments                                                   pricing_assignments[]
  vm_projects                                                           vm_projects?                 @relation(fields: [project_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_pricing_project")
  companies                                                             companies?                   @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "pricing_tiers_ibfk_1")
  usage_tracking                                                        usage_tracking[]

  @@index([project_id], map: "fk_pricing_project")
  @@index([company_id, active], map: "idx_company_active")
  @@index([tier_type, company_id, project_id, active], map: "idx_pricing_lookup")
  @@index([tier_type, priority(sort: Desc), active], map: "idx_pricing_priority")
}

model profile_permissions {
  id            Int           @id @default(autoincrement())
  profile_id    Int
  permission_id Int
  created_at    DateTime?     @default(now()) @db.Timestamp(0)
  user_profiles user_profiles @relation(fields: [profile_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "profile_permissions_ibfk_1")
  permissions   permissions   @relation(fields: [permission_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "profile_permissions_ibfk_2")

  @@unique([profile_id, permission_id], map: "unique_profile_permission")
  @@index([permission_id], map: "permission_id")
}

model profiles {
  id          Int        @id @default(autoincrement())
  name        String     @db.VarChar(100)
  description String?    @db.Text
  company_id  Int?
  is_system   Boolean?   @default(false)
  created_at  DateTime?  @default(now()) @db.Timestamp(0)
  updated_at  DateTime?  @default(now()) @db.Timestamp(0)
  companies   companies? @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "profiles_ibfk_1")

  @@index([company_id], map: "idx_company")
  @@index([is_system], map: "idx_system")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model proxmox_clusters {
  id                                                                     Int                            @id @default(autoincrement())
  name                                                                   String                         @db.VarChar(255)
  location                                                               String?                        @db.VarChar(255)
  host                                                                   String                         @db.VarChar(255)
  port                                                                   Int?                           @default(8006)
  username                                                               String                         @db.VarChar(100)
  password_encrypted                                                     String                         @db.Text
  realm                                                                  String?                        @default("pam") @db.VarChar(50)
  ssl_verify                                                             Boolean?                       @default(true)
  status                                                                 proxmox_clusters_status?       @default(active)
  created_at                                                             DateTime?                      @default(now()) @db.Timestamp(0)
  updated_at                                                             DateTime?                      @default(now()) @db.Timestamp(0)
  company_id                                                             Int?
  cluster_type                                                           proxmox_clusters_cluster_type? @default(shared)
  nat_ready                                                              Boolean?                       @default(false)
  nat_last_checked                                                       DateTime?                      @db.Timestamp(0)
  proxmox_version                                                        String?                        @db.VarChar(50)
  proxmox_release                                                        String?                        @db.VarChar(100)
  proxmox_repoid                                                         String?                        @db.VarChar(100)
  version_last_checked                                                   DateTime?                      @db.Timestamp(0)
  articles                                                               articles[]
  backup_history                                                         backup_history[]
  backup_policies                                                        backup_policies[]
  backup_restore_jobs                                                    backup_restore_jobs[]
  backup_schedules                                                       backup_schedules[]
  cluster_backup_servers                                                 cluster_backup_servers[]
  company_clusters                                                       company_clusters[]
  company_quotas                                                         company_quotas[]
  daily_vm_usage                                                         daily_vm_usage[]
  dr_cluster_pairs_dr_cluster_pairs_primary_cluster_idToproxmox_clusters dr_cluster_pairs[]             @relation("dr_cluster_pairs_primary_cluster_idToproxmox_clusters")
  dr_cluster_pairs_dr_cluster_pairs_dr_cluster_idToproxmox_clusters      dr_cluster_pairs[]             @relation("dr_cluster_pairs_dr_cluster_idToproxmox_clusters")
  ip_ranges                                                              ip_ranges[]
  iso_sync_jobs                                                          iso_sync_jobs[]
  monitoring_metrics                                                     monitoring_metrics[]
  nat_deployment_metrics                                                 nat_deployment_metrics[]
  nat_rules                                                              nat_rules[]
  network_edges                                                          network_edges[]
  opnsense_instances                                                     opnsense_instances[]
  companies                                                              companies?                     @relation(fields: [company_id], references: [id], onUpdate: NoAction, map: "proxmox_clusters_ibfk_1")
  replication_jobs_replication_jobs_source_cluster_idToproxmox_clusters  replication_jobs[]             @relation("replication_jobs_source_cluster_idToproxmox_clusters")
  replication_jobs_replication_jobs_target_cluster_idToproxmox_clusters  replication_jobs[]             @relation("replication_jobs_target_cluster_idToproxmox_clusters")
  resource_quotas                                                        resource_quotas[]
  ssh_key_cluster_status                                                 ssh_key_cluster_status[]
  storage_pools                                                          storage_pools[]
  usage_metrics                                                          usage_metrics[]
  virtual_machines                                                       virtual_machines[]
  vm_billing_snapshots                                                   vm_billing_snapshots[]
  vm_daily_summaries                                                     vm_daily_summaries[]
  vm_import_jobs                                                         vm_import_jobs[]
  vm_resource_metrics                                                    vm_resource_metrics[]
  vm_templates                                                           vm_templates[]

  @@unique([host, port], map: "unique_cluster")
  @@index([cluster_type], map: "idx_cluster_type")
  @@index([status], map: "idx_clusters_status")
  @@index([company_id], map: "idx_company")
  @@index([status], map: "idx_status")
  @@index([version_last_checked], map: "idx_version_checked")
}

model quota_approval_requests {
  id                                                Int                             @id @default(autoincrement())
  company_id                                        Int
  quota_id                                          Int
  requested_by                                      Int
  current_limit                                     Decimal                         @db.Decimal(15, 2)
  requested_limit                                   Decimal                         @db.Decimal(15, 2)
  justification                                     String                          @db.Text
  status                                            quota_approval_requests_status? @default(pending)
  reviewed_by                                       Int?
  reviewed_at                                       DateTime?                       @db.Timestamp(0)
  review_notes                                      String?                         @db.Text
  created_at                                        DateTime?                       @default(now()) @db.Timestamp(0)
  companies                                         companies                       @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "quota_approval_requests_ibfk_1")
  company_quotas                                    company_quotas                  @relation(fields: [quota_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "quota_approval_requests_ibfk_2")
  users_quota_approval_requests_requested_byTousers users                           @relation("quota_approval_requests_requested_byTousers", fields: [requested_by], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "quota_approval_requests_ibfk_3")
  users_quota_approval_requests_reviewed_byTousers  users?                          @relation("quota_approval_requests_reviewed_byTousers", fields: [reviewed_by], references: [id], onUpdate: NoAction, map: "quota_approval_requests_ibfk_4")

  @@index([company_id, status], map: "idx_company_status")
  @@index([status, created_at], map: "idx_status_created")
  @@index([quota_id], map: "quota_id")
  @@index([requested_by], map: "requested_by")
  @@index([reviewed_by], map: "reviewed_by")
}

model quota_usage_history {
  id             BigInt         @id @default(autoincrement())
  quota_id       Int
  company_id     Int
  quota_type     String         @db.VarChar(50)
  usage_value    Decimal        @db.Decimal(15, 2)
  quota_limit    Decimal        @db.Decimal(15, 2)
  usage_percent  Decimal        @db.Decimal(5, 2)
  recorded_at    DateTime?      @default(now()) @db.Timestamp(0)
  company_quotas company_quotas @relation(fields: [quota_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "quota_usage_history_ibfk_1")
  companies      companies      @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "quota_usage_history_ibfk_2")

  @@index([company_id, recorded_at], map: "idx_company_time")
  @@index([quota_id, recorded_at], map: "idx_quota_time")
}

model quota_violations {
  id               BigInt            @id @default(autoincrement())
  quota_id         Int
  company_id       Int
  quota_type       String            @db.VarChar(50)
  attempted_action String            @db.VarChar(100)
  attempted_value  Decimal           @db.Decimal(15, 2)
  quota_limit      Decimal           @db.Decimal(15, 2)
  current_usage    Decimal           @db.Decimal(15, 2)
  would_be_usage   Decimal           @db.Decimal(15, 2)
  blocked          Boolean?          @default(true)
  user_id          Int?
  vm_id            Int?
  created_at       DateTime?         @default(now()) @db.Timestamp(0)
  company_quotas   company_quotas    @relation(fields: [quota_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "quota_violations_ibfk_1")
  companies        companies         @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "quota_violations_ibfk_2")
  users            users?            @relation(fields: [user_id], references: [id], onUpdate: NoAction, map: "quota_violations_ibfk_3")
  virtual_machines virtual_machines? @relation(fields: [vm_id], references: [id], onUpdate: NoAction, map: "quota_violations_ibfk_4")

  @@index([company_id, created_at], map: "idx_company_time")
  @@index([quota_id, created_at], map: "idx_quota_time")
  @@index([user_id], map: "user_id")
  @@index([vm_id], map: "vm_id")
}

model rate_limit_configs {
  id                     Int       @id @default(autoincrement())
  endpoint               String    @db.VarChar(255)
  method                 String    @default("ALL") @db.VarChar(10)
  max_requests           Int       @default(100)
  window_seconds         Int       @default(60)
  block_duration_seconds Int?      @default(300)
  is_enabled             Boolean?  @default(true)
  description            String?   @db.Text
  created_at             DateTime? @default(now()) @db.Timestamp(0)
  updated_at             DateTime? @default(now()) @db.Timestamp(0)
  created_by             Int?

  @@unique([endpoint, method], map: "unique_endpoint_method")
  @@index([is_enabled], map: "idx_enabled")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model rate_limits {
  id              Int                         @id @default(autoincrement())
  identifier      String                      @db.VarChar(100)
  identifier_type rate_limits_identifier_type
  endpoint        String                      @db.VarChar(255)
  request_count   Int?                        @default(1)
  window_start    DateTime?                   @default(now()) @db.Timestamp(0)
  last_request_at DateTime?                   @default(now()) @db.Timestamp(0)
  blocked_until   DateTime?                   @db.Timestamp(0)

  @@unique([identifier, identifier_type, endpoint, window_start], map: "unique_rate_limit")
  @@index([identifier, identifier_type], map: "idx_identifier")
  @@index([window_start], map: "idx_window_start")
}

model refresh_tokens {
  id         Int       @id @default(autoincrement())
  user_id    Int
  token_hash String    @unique(map: "token_hash") @db.VarChar(255)
  expires_at DateTime  @db.Timestamp(0)
  revoked    Boolean?  @default(false)
  created_at DateTime? @default(now()) @db.Timestamp(0)
  users      users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "refresh_tokens_ibfk_1")

  @@index([expires_at], map: "idx_expires")
  @@index([token_hash], map: "idx_token")
  @@index([user_id], map: "idx_user")
}

model replication_jobs {
  id                                                                    Int                      @id @default(autoincrement())
  vm_id                                                                 Int
  source_cluster_id                                                     Int
  target_cluster_id                                                     Int
  schedule_cron                                                         String?                  @db.VarChar(100)
  rate_limit_mbps                                                       Int?                     @default(0)
  enabled                                                               Boolean?                 @default(true)
  last_sync                                                             DateTime?                @db.Timestamp(0)
  status                                                                replication_jobs_status? @default(active)
  created_at                                                            DateTime?                @default(now()) @db.Timestamp(0)
  updated_at                                                            DateTime?                @default(now()) @db.Timestamp(0)
  virtual_machines                                                      virtual_machines         @relation(fields: [vm_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "replication_jobs_ibfk_1")
  proxmox_clusters_replication_jobs_source_cluster_idToproxmox_clusters proxmox_clusters         @relation("replication_jobs_source_cluster_idToproxmox_clusters", fields: [source_cluster_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "replication_jobs_ibfk_2")
  proxmox_clusters_replication_jobs_target_cluster_idToproxmox_clusters proxmox_clusters         @relation("replication_jobs_target_cluster_idToproxmox_clusters", fields: [target_cluster_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "replication_jobs_ibfk_3")

  @@index([status], map: "idx_status")
  @@index([vm_id], map: "idx_vm")
  @@index([source_cluster_id], map: "source_cluster_id")
  @@index([target_cluster_id], map: "target_cluster_id")
}

model resource_alert_history {
  id                BigInt                            @id @default(autoincrement())
  alert_id          Int
  vm_id             Int
  company_id        Int
  alert_type        resource_alert_history_alert_type
  threshold_value   Decimal                           @db.Decimal(10, 2)
  actual_value      Decimal                           @db.Decimal(10, 2)
  triggered_at      DateTime?                         @default(now()) @db.Timestamp(0)
  resolved_at       DateTime?                         @db.Timestamp(0)
  acknowledged_by   Int?
  acknowledged_at   DateTime?                         @db.Timestamp(0)
  notification_sent Boolean?                          @default(false)
  resource_alerts   resource_alerts                   @relation(fields: [alert_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "resource_alert_history_ibfk_1")
  virtual_machines  virtual_machines                  @relation(fields: [vm_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "resource_alert_history_ibfk_2")
  companies         companies                         @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "resource_alert_history_ibfk_3")
  users             users?                            @relation(fields: [acknowledged_by], references: [id], onUpdate: NoAction, map: "resource_alert_history_ibfk_4")

  @@index([acknowledged_by], map: "acknowledged_by")
  @@index([alert_id], map: "alert_id")
  @@index([company_id, triggered_at], map: "idx_company_history")
  @@index([vm_id, triggered_at], map: "idx_vm_history")
}

model resource_alerts {
  id                     Int                                 @id @default(autoincrement())
  company_id             Int
  vm_id                  Int?
  alert_type             resource_alerts_alert_type
  threshold_value        Decimal                             @db.Decimal(10, 2)
  threshold_operator     resource_alerts_threshold_operator? @default(GTE)
  duration_minutes       Int?                                @default(5)
  enabled                Boolean?                            @default(true)
  notification_email     String?                             @db.VarChar(255)
  notification_webhook   String?                             @db.VarChar(500)
  created_at             DateTime?                           @default(now()) @db.Timestamp(0)
  updated_at             DateTime?                           @default(now()) @db.Timestamp(0)
  resource_alert_history resource_alert_history[]
  companies              companies                           @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "resource_alerts_ibfk_1")
  virtual_machines       virtual_machines?                   @relation(fields: [vm_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "resource_alerts_ibfk_2")

  @@index([company_id, enabled], map: "idx_company_alerts")
  @@index([vm_id], map: "vm_id")
}

model resource_quotas {
  id               Int              @id @default(autoincrement())
  company_id       Int
  cluster_id       Int
  max_cpu_cores    Int?             @default(0)
  max_memory_mb    BigInt?          @default(0)
  max_storage_gb   BigInt?          @default(0)
  max_vms          Int?             @default(0)
  max_networks     Int?             @default(10)
  created_at       DateTime?        @default(now()) @db.Timestamp(0)
  updated_at       DateTime?        @default(now()) @db.Timestamp(0)
  companies        companies        @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "resource_quotas_ibfk_1")
  proxmox_clusters proxmox_clusters @relation(fields: [cluster_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "resource_quotas_ibfk_2")

  @@unique([company_id, cluster_id], map: "unique_quota")
  @@index([cluster_id], map: "cluster_id")
  @@index([company_id], map: "idx_company")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model saved_filters {
  id              Int                        @id @default(autoincrement())
  name            String                     @db.VarChar(100)
  description     String?                    @db.Text
  filter_type     saved_filters_filter_type? @default(vm)
  filter_criteria String                     @db.LongText
  is_shared       Boolean?                   @default(false)
  is_favorite     Boolean?                   @default(false)
  user_id         Int
  company_id      Int?
  use_count       Int?                       @default(0)
  last_used_at    DateTime?                  @db.Timestamp(0)
  created_at      DateTime?                  @default(now()) @db.Timestamp(0)
  updated_at      DateTime?                  @default(now()) @db.Timestamp(0)
  users           users                      @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "saved_filters_ibfk_1")
  companies       companies?                 @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "saved_filters_ibfk_2")

  @@index([company_id], map: "idx_company_id")
  @@index([filter_type], map: "idx_filter_type")
  @@index([is_favorite], map: "idx_is_favorite")
  @@index([user_id], map: "idx_user_id")
}

model search_history {
  id                  Int                         @id @default(autoincrement())
  user_id             Int
  search_query        String                      @db.VarChar(255)
  search_type         search_history_search_type? @default(global)
  results_count       Int?                        @default(0)
  clicked_result_type String?                     @db.VarChar(50)
  clicked_result_id   Int?
  search_date         DateTime?                   @default(now()) @db.Timestamp(0)
  users               users                       @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "search_history_ibfk_1")

  @@index([search_date], map: "idx_search_date")
  @@index([search_query], map: "idx_search_query")
  @@index([user_id], map: "idx_user_id")
}

model search_suggestions {
  id               Int       @id @default(autoincrement())
  suggestion_text  String    @unique(map: "unique_suggestion") @db.VarChar(255)
  category         String?   @db.VarChar(50)
  popularity_score Int?      @default(1)
  last_used_at     DateTime? @default(now()) @db.Timestamp(0)

  @@index([category], map: "idx_category")
  @@index([popularity_score(sort: Desc)], map: "idx_popularity")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model security_audit_log {
  id             Int                               @id @default(autoincrement())
  user_id        Int?
  event_type     String                            @db.VarChar(50)
  event_category security_audit_log_event_category
  severity       security_audit_log_severity?      @default(low)
  description    String                            @db.Text
  ip_address     String?                           @db.VarChar(45)
  user_agent     String?                           @db.Text
  endpoint       String?                           @db.VarChar(255)
  request_method String?                           @db.VarChar(10)
  success        Boolean?                          @default(true)
  failure_reason String?                           @db.Text
  metadata       String?                           @db.LongText
  created_at     DateTime?                         @default(now()) @db.Timestamp(0)

  @@index([created_at], map: "idx_created_at")
  @@index([event_category], map: "idx_event_category")
  @@index([event_type], map: "idx_event_type")
  @@index([ip_address], map: "idx_ip_address")
  @@index([severity], map: "idx_severity")
  @@index([user_id], map: "idx_user_id")
}

model sessions {
  id            String    @id @db.VarChar(255)
  user_id       Int
  ip_address    String?   @db.VarChar(45)
  user_agent    String?   @db.Text
  payload       String    @db.Text
  last_activity DateTime? @default(now()) @db.Timestamp(0)
  users         users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "sessions_ibfk_1")

  @@index([last_activity], map: "idx_last_activity")
  @@index([user_id], map: "idx_user")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model snapshot_schedules {
  id               Int                              @id @default(autoincrement())
  vm_id            Int
  schedule_type    snapshot_schedules_schedule_type
  schedule_value   String                           @db.VarChar(50)
  retention_count  Int?                             @default(7)
  enabled          Boolean?                         @default(true)
  last_run         DateTime?                        @db.Timestamp(0)
  created_at       DateTime?                        @default(now()) @db.Timestamp(0)
  virtual_machines virtual_machines                 @relation(fields: [vm_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "snapshot_schedules_ibfk_1")

  @@index([enabled], map: "idx_enabled")
  @@index([vm_id], map: "vm_id")
}

model ssh_key_cluster_status {
  id                    Int                                           @id @default(autoincrement())
  ssh_key_id            Int
  cluster_id            Int
  is_configured         Boolean?                                      @default(false)
  last_tested_at        DateTime?                                     @db.Timestamp(0)
  last_test_success     Boolean?
  last_push_at          DateTime?                                     @db.Timestamp(0)
  push_count            Int?                                          @default(0)
  auth_method_last_used ssh_key_cluster_status_auth_method_last_used? @default(unknown)
  last_auth_at          DateTime?                                     @db.Timestamp(0)
  created_at            DateTime?                                     @default(now()) @db.Timestamp(0)
  updated_at            DateTime?                                     @default(now()) @db.Timestamp(0)
  proxmox_clusters      proxmox_clusters                              @relation(fields: [cluster_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "ssh_key_cluster_status_ibfk_1")

  @@unique([ssh_key_id, cluster_id], map: "unique_key_cluster")
  @@index([cluster_id], map: "idx_cluster")
}

model ssh_keys {
  id              Int                @id @default(autoincrement())
  key_type        ssh_keys_key_type? @default(rsa)
  key_size        Int?               @default(4096)
  public_key      String             @db.Text
  fingerprint     String             @unique(map: "fingerprint") @db.VarChar(255)
  generated_at    DateTime?          @default(now()) @db.Timestamp(0)
  expires_at      DateTime?          @db.Timestamp(0)
  last_rotated_at DateTime?          @db.Timestamp(0)
  last_used_at    DateTime?          @db.Timestamp(0)
  rotation_count  Int?               @default(0)
  status          ssh_keys_status?   @default(active)
  created_by      Int?
  notes           String?            @db.Text

  @@index([expires_at], map: "idx_expires_at")
  @@index([fingerprint], map: "idx_fingerprint")
  @@index([status], map: "idx_status")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model sso_login_audit {
  id                 Int                      @id @default(autoincrement())
  company_id         Int
  sso_config_id      Int
  user_id            Int?
  email              String                   @db.VarChar(255)
  provider           sso_login_audit_provider
  status             sso_login_audit_status
  failure_reason     String?                  @db.Text
  user_provisioned   Boolean?                 @default(false)
  ip_address         String?                  @db.VarChar(45)
  user_agent         String?                  @db.Text
  oauth_subject      String?                  @db.VarChar(255)
  oauth_claims       String?                  @db.LongText
  created_at         DateTime?                @default(now()) @db.Timestamp(0)
  companies          companies                @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "sso_login_audit_ibfk_1")
  company_sso_config company_sso_config       @relation(fields: [sso_config_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "sso_login_audit_ibfk_2")
  users              users?                   @relation(fields: [user_id], references: [id], onUpdate: NoAction, map: "sso_login_audit_ibfk_3")

  @@index([company_id, created_at], map: "idx_company_created")
  @@index([email], map: "idx_email")
  @@index([oauth_subject], map: "idx_oauth_subject")
  @@index([user_id, created_at], map: "idx_user_created")
  @@index([sso_config_id], map: "sso_config_id")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model storage_pools {
  id                     Int                        @id @default(autoincrement())
  cluster_id             Int
  name                   String                     @db.VarChar(100)
  storage_type           storage_pools_storage_type
  path                   String?                    @db.VarChar(255)
  total_size_gb          Decimal?                   @db.Decimal(12, 2)
  used_size_gb           Decimal?                   @db.Decimal(12, 2)
  available_size_gb      Decimal?                   @db.Decimal(12, 2)
  content_types          String?                    @db.VarChar(255)
  shared                 Boolean?                   @default(false)
  enabled                Boolean?                   @default(true)
  last_updated           DateTime?                  @default(now()) @db.Timestamp(0)
  created_at             DateTime?                  @default(now()) @db.Timestamp(0)
  company_storage_quotas company_storage_quotas[]
  proxmox_clusters       proxmox_clusters           @relation(fields: [cluster_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "storage_pools_ibfk_1")

  @@unique([cluster_id, name], map: "unique_cluster_storage")
  @@index([enabled], map: "idx_enabled")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model subscription_plans {
  id                    Int                                @id @default(autoincrement())
  name                  String                             @db.VarChar(100)
  description           String?                            @db.Text
  price                 Decimal                            @db.Decimal(10, 2)
  currency              String?                            @default("USD") @db.VarChar(10)
  billing_period        subscription_plans_billing_period? @default(monthly)
  trial_days            Int?                               @default(0)
  is_active             Boolean?                           @default(true)
  features              Json?
  display_order         Int?                               @default(0)
  created_at            DateTime?                          @default(now()) @db.Timestamp(0)
  updated_at            DateTime?                          @default(now()) @db.Timestamp(0)
  vm_limit              Int?
  storage_gb_limit      Int?
  cpu_cores_limit       Int?
  memory_gb_limit       Int?
  user_limit            Int?
  cluster_limit         Int?
  support_level         subscription_plans_support_level?  @default(email)
  backup_enabled        Boolean?                           @default(false)
  snapshot_enabled      Boolean?                           @default(false)
  api_access_enabled    Boolean?                           @default(false)
  company_subscriptions company_subscriptions[]

  @@index([display_order], map: "idx_display_order")
  @@index([is_active], map: "idx_is_active")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model support_ticket_messages {
  id              Int             @id @default(autoincrement())
  ticket_id       Int
  user_id         Int
  message         String          @db.Text
  is_internal     Boolean?        @default(false)
  attachments     String?         @db.LongText
  created_at      DateTime?       @default(now()) @db.Timestamp(0)
  support_tickets support_tickets @relation(fields: [ticket_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "support_ticket_messages_ibfk_1")
  users           users           @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "support_ticket_messages_ibfk_2")

  @@index([created_at], map: "idx_created")
  @@index([ticket_id], map: "idx_ticket")
  @@index([user_id], map: "user_id")
}

model support_tickets {
  id                                       Int                       @id @default(autoincrement())
  ticket_number                            String                    @unique(map: "ticket_number") @db.VarChar(50)
  company_id                               Int
  created_by                               Int
  assigned_to                              Int?
  subject                                  String                    @db.VarChar(255)
  description                              String                    @db.Text
  priority                                 support_tickets_priority? @default(medium)
  status                                   support_tickets_status?   @default(open)
  category                                 String?                   @db.VarChar(50)
  vm_id                                    Int?
  opened_at                                DateTime?                 @default(now()) @db.Timestamp(0)
  closed_at                                DateTime?                 @db.Timestamp(0)
  resolution                               String?                   @db.Text
  support_ticket_messages                  support_ticket_messages[]
  companies                                companies                 @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "support_tickets_ibfk_1")
  users_support_tickets_created_byTousers  users                     @relation("support_tickets_created_byTousers", fields: [created_by], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "support_tickets_ibfk_2")
  users_support_tickets_assigned_toTousers users?                    @relation("support_tickets_assigned_toTousers", fields: [assigned_to], references: [id], onUpdate: NoAction, map: "support_tickets_ibfk_3")
  virtual_machines                         virtual_machines?         @relation(fields: [vm_id], references: [id], onUpdate: NoAction, map: "support_tickets_ibfk_4")

  @@index([created_by], map: "created_by")
  @@index([assigned_to, status], map: "idx_assigned")
  @@index([company_id, status], map: "idx_company_status")
  @@index([vm_id], map: "vm_id")
}

model system_settings {
  id            Int       @id @default(autoincrement())
  setting_key   String    @unique(map: "setting_key") @db.VarChar(100)
  setting_value String?   @db.Text
  description   String?   @db.VarChar(255)
  updated_at    DateTime? @default(now()) @db.Timestamp(0)

  @@index([setting_key], map: "idx_setting_key")
}

model ui_customizations {
  id                   Int                   @id @default(autoincrement())
  company_id           Int?
  url_mapping_id       Int?
  page_identifier      String                @db.VarChar(100)
  section_identifier   String?               @db.VarChar(100)
  custom_text          Json?
  hidden_components    Json?
  custom_components    Json?
  layout_settings      Json?
  is_active            Boolean?              @default(true)
  priority             Int?                  @default(0)
  created_at           DateTime?             @default(now()) @db.Timestamp(0)
  updated_at           DateTime?             @default(now()) @db.Timestamp(0)
  companies            companies?            @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "ui_customizations_ibfk_1")
  company_url_mappings company_url_mappings? @relation(fields: [url_mapping_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "ui_customizations_ibfk_2")

  @@unique([company_id, url_mapping_id, page_identifier, section_identifier], map: "unique_customization")
  @@index([is_active], map: "idx_active")
  @@index([page_identifier], map: "idx_page")
  @@index([priority], map: "idx_priority")
  @@index([url_mapping_id], map: "url_mapping_id")
}

model usage_metrics {
  id               BigInt                    @id @default(autoincrement())
  company_id       Int
  cluster_id       Int
  vm_id            Int?
  metric_type      usage_metrics_metric_type
  value            Decimal                   @db.Decimal(15, 2)
  unit             String                    @db.VarChar(20)
  recorded_at      DateTime?                 @default(now()) @db.Timestamp(0)
  companies        companies                 @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "usage_metrics_ibfk_1")
  proxmox_clusters proxmox_clusters          @relation(fields: [cluster_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "usage_metrics_ibfk_2")
  virtual_machines virtual_machines?         @relation(fields: [vm_id], references: [id], onUpdate: NoAction, map: "usage_metrics_ibfk_3")

  @@index([cluster_id, recorded_at], map: "idx_cluster_date")
  @@index([company_id, recorded_at], map: "idx_company_date")
  @@index([metric_type], map: "idx_metric_type")
  @@index([recorded_at], map: "idx_recorded")
  @@index([vm_id], map: "vm_id")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model usage_tracking {
  id                   BigInt                    @id @default(autoincrement())
  company_id           Int
  project_id           Int?
  vm_id                Int?
  usage_type           usage_tracking_usage_type
  usage_value          Decimal                   @db.Decimal(15, 4)
  usage_unit           String                    @db.VarChar(20)
  unit_price           Decimal                   @db.Decimal(10, 4)
  total_cost           Decimal                   @db.Decimal(12, 4)
  billing_period_start DateTime                  @db.Date
  billing_period_end   DateTime                  @db.Date
  recorded_at          DateTime?                 @default(now()) @db.Timestamp(0)
  pricing_tier_id      Int?
  metadata             Json?
  pricing_tiers        pricing_tiers?            @relation(fields: [pricing_tier_id], references: [id], onUpdate: NoAction, map: "fk_usage_pricing")
  vm_projects          vm_projects?              @relation(fields: [project_id], references: [id], onUpdate: NoAction, map: "fk_usage_project")
  companies            companies                 @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "usage_tracking_ibfk_1")
  virtual_machines     virtual_machines?         @relation(fields: [vm_id], references: [id], onUpdate: NoAction, map: "usage_tracking_ibfk_2")

  @@index([pricing_tier_id], map: "fk_usage_pricing")
  @@index([project_id], map: "fk_usage_project")
  @@index([billing_period_start, billing_period_end], map: "idx_billing_period")
  @@index([company_id, billing_period_start, billing_period_end], map: "idx_company_period")
  @@index([vm_id], map: "vm_id")
}

model user_2fa {
  id              Int       @id @default(autoincrement())
  user_id         Int       @unique(map: "user_id")
  secret_key      String    @db.VarChar(500)
  backup_codes    String?   @db.LongText
  enabled         Boolean?  @default(false)
  verified        Boolean?  @default(false)
  recovery_email  String?   @db.VarChar(255)
  last_used       DateTime? @db.Timestamp(0)
  failed_attempts Int?      @default(0)
  locked_until    DateTime? @db.Timestamp(0)
  created_at      DateTime? @default(now()) @db.Timestamp(0)
  updated_at      DateTime? @default(now()) @db.Timestamp(0)
  users           users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "user_2fa_ibfk_1")

  @@index([user_id], map: "idx_2fa_user")
}

model user_2fa_backup_codes {
  id         Int       @id @default(autoincrement())
  user_id    Int
  code_hash  String    @db.VarChar(255)
  used       Boolean?  @default(false)
  used_at    DateTime? @db.Timestamp(0)
  created_at DateTime? @default(now()) @db.Timestamp(0)
  users      users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "user_2fa_backup_codes_ibfk_1")

  @@index([user_id, used], map: "idx_user_codes")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model user_2fa_logs {
  id         Int                  @id @default(autoincrement())
  user_id    Int
  action     user_2fa_logs_action
  ip_address String?              @db.VarChar(45)
  user_agent String?              @db.Text
  details    String?              @db.LongText
  created_at DateTime?            @default(now()) @db.Timestamp(0)
  users      users                @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "user_2fa_logs_ibfk_1")

  @@index([user_id], map: "idx_2fa_logs_user")
  @@index([user_id, created_at], map: "idx_user_created")
}

model user_bookmarks {
  id            Int                          @id @default(autoincrement())
  user_id       Int
  bookmark_type user_bookmarks_bookmark_type
  entity_id     Int?
  page_url      String?                      @db.VarChar(255)
  custom_name   String?                      @db.VarChar(100)
  folder        String?                      @default("default") @db.VarChar(50)
  sort_order    Int?                         @default(0)
  created_at    DateTime?                    @default(now()) @db.Timestamp(0)
  users         users                        @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "user_bookmarks_ibfk_1")

  @@unique([user_id, bookmark_type, entity_id, page_url], map: "unique_user_bookmark")
  @@index([bookmark_type], map: "idx_bookmark_type")
  @@index([folder], map: "idx_folder")
  @@index([user_id], map: "idx_user_id")
}

model user_permissions {
  id             Int       @id @default(autoincrement())
  user_id        Int
  permission_key String    @db.VarChar(100)
  granted_at     DateTime? @default(now()) @db.Timestamp(0)
  granted_by     Int?
  users          users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "user_permissions_ibfk_1")

  @@unique([user_id, permission_key], map: "unique_user_permission")
  @@index([permission_key], map: "idx_permission")
  @@index([user_id], map: "idx_user")
}

model user_preferences {
  id               Int       @id @default(autoincrement())
  user_id          Int
  preference_key   String    @db.VarChar(50)
  preference_value String    @db.Text
  updated_at       DateTime? @default(now()) @db.Timestamp(0)
  users            users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "user_preferences_ibfk_1")

  @@unique([user_id, preference_key], map: "unique_user_pref")
  @@index([preference_key], map: "idx_preference_key")
  @@index([user_id], map: "idx_user_id")
}

model user_profiles {
  id                                    Int                   @id @default(autoincrement())
  name                                  String                @unique(map: "name") @db.VarChar(100)
  description                           String?               @db.Text
  company_id                            Int?
  is_system                             Boolean?              @default(false)
  created_by                            Int?
  created_at                            DateTime?             @default(now()) @db.Timestamp(0)
  updated_at                            DateTime?             @default(now()) @db.Timestamp(0)
  profile_permissions                   profile_permissions[]
  companies                             companies?            @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "user_profiles_ibfk_1")
  users_user_profiles_created_byTousers users?                @relation("user_profiles_created_byTousers", fields: [created_by], references: [id], onUpdate: NoAction, map: "user_profiles_ibfk_2")
  users_users_profile_idTouser_profiles users[]               @relation("users_profile_idTouser_profiles")

  @@index([created_by], map: "created_by")
  @@index([company_id], map: "idx_company")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model user_sessions {
  id                 Int       @id @default(autoincrement())
  user_id            Int
  session_token      String    @unique(map: "session_token") @db.VarChar(255)
  refresh_token      String?   @unique(map: "refresh_token") @db.VarChar(255)
  ip_address         String?   @db.VarChar(45)
  user_agent         String?   @db.Text
  device_info        String?   @db.LongText
  last_activity      DateTime? @default(now()) @db.Timestamp(0)
  expires_at         DateTime  @db.Timestamp(0)
  refresh_expires_at DateTime? @db.Timestamp(0)
  revoked            Boolean?  @default(false)
  revoked_at         DateTime? @db.Timestamp(0)
  revoked_reason     String?   @db.VarChar(255)
  created_at         DateTime? @default(now()) @db.Timestamp(0)
  users              users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "user_sessions_ibfk_1")

  @@index([refresh_token], map: "idx_refresh")
  @@index([expires_at], map: "idx_sessions_expires")
  @@index([user_id], map: "idx_sessions_user")
  @@index([user_id, revoked, expires_at], map: "idx_user_active")
}

model user_vm_permissions {
  id               Int                                   @id @default(autoincrement())
  user_id          Int
  vm_id            Int
  permission_level user_vm_permissions_permission_level? @default(read)
  granted_at       DateTime?                             @default(now()) @db.Timestamp(0)
  users            users                                 @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "user_vm_permissions_ibfk_1")
  virtual_machines virtual_machines                      @relation(fields: [vm_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "user_vm_permissions_ibfk_2")

  @@unique([user_id, vm_id], map: "unique_permission")
  @@index([user_id], map: "idx_user")
  @@index([vm_id], map: "idx_vm")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model users {
  id                                                                  Int                        @id @default(autoincrement())
  company_id                                                          Int
  username                                                            String                     @unique(map: "username") @db.VarChar(100)
  email                                                               String                     @unique(map: "email") @db.VarChar(255)
  password_hash                                                       String?                    @db.VarChar(255)
  sso_provider                                                        String?                    @db.VarChar(50)
  sso_subject                                                         String?                    @db.VarChar(255)
  sso_last_login                                                      DateTime?                  @db.Timestamp(0)
  first_name                                                          String?                    @db.VarChar(100)
  last_name                                                           String?                    @db.VarChar(100)
  phone                                                               String?                    @db.VarChar(50)
  role                                                                users_role?                @default(user)
  two_factor_required                                                 Boolean?                   @default(false)
  profile_id                                                          Int?
  status                                                              users_status?              @default(active)
  auth_type                                                           users_auth_type?           @default(local)
  two_factor_enabled                                                  Boolean?                   @default(false)
  two_factor_secret                                                   String?                    @db.VarChar(255)
  last_login                                                          DateTime?                  @db.Timestamp(0)
  created_at                                                          DateTime?                  @default(now()) @db.Timestamp(0)
  updated_at                                                          DateTime?                  @default(now()) @db.Timestamp(0)
  customer_portal_access                                              Boolean?                   @default(false)
  allowed_vm_ids                                                      String?                    @db.LongText
  last_login_at                                                       DateTime?                  @db.Timestamp(0)
  last_login_ip                                                       String?                    @db.VarChar(45)
  failed_login_attempts                                               Int?                       @default(0)
  locked_until                                                        DateTime?                  @db.Timestamp(0)
  password_changed_at                                                 DateTime?                  @db.Timestamp(0)
  require_password_change                                             Boolean?                   @default(false)
  activity_logs                                                       activity_logs[]
  alert_history_alert_history_acknowledged_byTousers                  alert_history[]            @relation("alert_history_acknowledged_byTousers")
  alert_history_alert_history_resolved_byTousers                      alert_history[]            @relation("alert_history_resolved_byTousers")
  alert_rules                                                         alert_rules[]
  api_tokens                                                          api_tokens[]
  articles                                                            articles[]
  audit_export_jobs                                                   audit_export_jobs[]
  audit_logs                                                          audit_logs[]
  backup_history                                                      backup_history[]
  backup_restore_jobs                                                 backup_restore_jobs[]
  backup_schedules                                                    backup_schedules[]
  billing_audit_log                                                   billing_audit_log[]
  bookmarks                                                           bookmarks[]
  bulk_operations_log                                                 bulk_operations_log[]
  company_payment_methods                                             company_payment_methods[]
  company_pricing_plans                                               company_pricing_plans[]
  company_quotas                                                      company_quotas[]
  company_sso_config                                                  company_sso_config[]
  customer_portal_sessions                                            customer_portal_sessions[]
  dr_cluster_pairs                                                    dr_cluster_pairs[]
  dr_config_templates                                                 dr_config_templates[]
  dr_failover_events                                                  dr_failover_events[]
  dr_test_results                                                     dr_test_results[]
  dr_test_schedules                                                   dr_test_schedules[]
  dr_vm_policies                                                      dr_vm_policies[]
  email_queue                                                         email_queue[]
  esxi_hosts                                                          esxi_hosts[]
  export_history                                                      export_history[]
  feedback_activity_log                                               feedback_activity_log[]
  feedback_notifications                                              feedback_notifications[]
  feedback_replies                                                    feedback_replies[]
  feedback_submissions_feedback_submissions_user_idTousers            feedback_submissions[]     @relation("feedback_submissions_user_idTousers")
  feedback_submissions_feedback_submissions_assigned_toTousers        feedback_submissions[]     @relation("feedback_submissions_assigned_toTousers")
  help_article_changelog                                              help_article_changelog[]
  help_article_drafts                                                 help_article_drafts[]
  help_articles                                                       help_articles[]
  invoices                                                            invoices[]
  ip_reservations_ip_reservations_reserved_byTousers                  ip_reservations[]          @relation("ip_reservations_reserved_byTousers")
  ip_reservations_ip_reservations_created_byTousers                   ip_reservations[]          @relation("ip_reservations_created_byTousers")
  iso_company_assignments                                             iso_company_assignments[]
  nat_deployment_log                                                  nat_deployment_log[]
  nat_firewall_rules_nat_firewall_rules_created_byTousers             nat_firewall_rules[]       @relation("nat_firewall_rules_created_byTousers")
  nat_firewall_rules_nat_firewall_rules_last_modified_byTousers       nat_firewall_rules[]       @relation("nat_firewall_rules_last_modified_byTousers")
  nat_rules_nat_rules_created_byTousers                               nat_rules[]                @relation("nat_rules_created_byTousers")
  nat_rules_nat_rules_last_modified_byTousers                         nat_rules[]                @relation("nat_rules_last_modified_byTousers")
  notification_queue                                                  notification_queue[]
  notification_settings                                               notification_settings[]
  onboarding_registrations                                            onboarding_registrations[]
  opnsense_templates                                                  opnsense_templates[]
  payment_method_audit                                                payment_method_audit[]
  payments                                                            payments[]
  pricing_assignments                                                 pricing_assignments[]
  quota_approval_requests_quota_approval_requests_requested_byTousers quota_approval_requests[]  @relation("quota_approval_requests_requested_byTousers")
  quota_approval_requests_quota_approval_requests_reviewed_byTousers  quota_approval_requests[]  @relation("quota_approval_requests_reviewed_byTousers")
  quota_violations                                                    quota_violations[]
  refresh_tokens                                                      refresh_tokens[]
  resource_alert_history                                              resource_alert_history[]
  saved_filters                                                       saved_filters[]
  search_history                                                      search_history[]
  sessions                                                            sessions[]
  sso_login_audit                                                     sso_login_audit[]
  support_ticket_messages                                             support_ticket_messages[]
  support_tickets_support_tickets_created_byTousers                   support_tickets[]          @relation("support_tickets_created_byTousers")
  support_tickets_support_tickets_assigned_toTousers                  support_tickets[]          @relation("support_tickets_assigned_toTousers")
  user_2fa                                                            user_2fa?
  user_2fa_backup_codes                                               user_2fa_backup_codes[]
  user_2fa_logs                                                       user_2fa_logs[]
  user_bookmarks                                                      user_bookmarks[]
  user_permissions                                                    user_permissions[]
  user_preferences                                                    user_preferences[]
  user_profiles_user_profiles_created_byTousers                       user_profiles[]            @relation("user_profiles_created_byTousers")
  user_sessions                                                       user_sessions[]
  user_vm_permissions                                                 user_vm_permissions[]
  companies                                                           companies                  @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "users_ibfk_1")
  user_profiles_users_profile_idTouser_profiles                       user_profiles?             @relation("users_profile_idTouser_profiles", fields: [profile_id], references: [id], onUpdate: NoAction, map: "users_ibfk_2")
  virtual_machines                                                    virtual_machines[]
  vm_import_jobs                                                      vm_import_jobs[]
  vm_notes                                                            vm_notes[]
  vm_notes_history                                                    vm_notes_history[]
  vm_snapshots                                                        vm_snapshots[]
  vm_tag_assignments                                                  vm_tag_assignments[]
  vm_tags                                                             vm_tags[]
  vm_template_usage                                                   vm_template_usage[]
  vm_templates                                                        vm_templates[]
  webhook_deliveries_old                                              webhook_deliveries_old[]
  webhooks                                                            webhooks[]

  @@index([company_id], map: "idx_company")
  @@index([email], map: "idx_email")
  @@index([profile_id], map: "idx_profile")
  @@index([status], map: "idx_status")
  @@index([username], map: "idx_username")
  @@index([company_id], map: "idx_users_company")
  @@index([email], map: "idx_users_email")
  @@index([role], map: "idx_users_role")
}

model virtual_machines {
  id                       Int                      @id @default(autoincrement())
  company_id               Int
  cluster_id               Int
  vmid                     Int
  name                     String                   @db.VarChar(255)
  description              String?                  @db.Text
  project_id               Int?
  node                     String                   @db.VarChar(100)
  cpu_cores                Int?                     @default(1)
  memory_mb                Int?                     @default(1024)
  storage_gb               Int?                     @default(20)
  primary_ip_internal      String?                  @db.VarChar(50)
  primary_ip_external      String?                  @db.VarChar(50)
  status                   virtual_machines_status? @default(unknown)
  last_activity_at         DateTime?                @db.Timestamp(0)
  template_id              Int?
  ip_address               String?                  @db.VarChar(45)
  created_from_template    Boolean?                 @default(false)
  created_at               DateTime?                @default(now()) @db.Timestamp(0)
  updated_at               DateTime?                @default(now()) @db.Timestamp(0)
  deleted_at               DateTime?                @db.Timestamp(0)
  marked_for_deletion_at   DateTime?                @db.Timestamp(0)
  marked_for_deletion_by   Int?
  imported_from_esxi       Boolean?                 @default(false)
  esxi_import_job_id       Int?
  esxi_source_host         String?                  @db.VarChar(255)
  esxi_original_name       String?                  @db.VarChar(255)
  auto_shutdown_enabled    Boolean?                 @default(false)
  auto_shutdown_idle_hours Int?                     @default(24)
  backup_history           backup_history[]
  backup_restore_jobs      backup_restore_jobs[]
  backup_schedules         backup_schedules[]
  daily_vm_usage           daily_vm_usage[]
  invoice_line_items       invoice_line_items[]
  ip_reservations          ip_reservations[]
  monitoring_metrics       monitoring_metrics[]
  nat_rules                nat_rules[]
  opnsense_instances       opnsense_instances?
  quota_violations         quota_violations[]
  replication_jobs         replication_jobs[]
  resource_alert_history   resource_alert_history[]
  resource_alerts          resource_alerts[]
  snapshot_schedules       snapshot_schedules[]
  support_tickets          support_tickets[]
  usage_metrics            usage_metrics[]
  usage_tracking           usage_tracking[]
  user_vm_permissions      user_vm_permissions[]
  users                    users?                   @relation(fields: [marked_for_deletion_by], references: [id], onUpdate: NoAction, map: "fk_marked_deletion_by")
  vm_import_jobs           vm_import_jobs?          @relation(fields: [esxi_import_job_id], references: [id], onUpdate: NoAction, map: "fk_vm_import_job")
  vm_projects              vm_projects?             @relation(fields: [project_id], references: [id], onUpdate: NoAction, map: "fk_vm_project")
  companies                companies                @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "virtual_machines_ibfk_1")
  proxmox_clusters         proxmox_clusters         @relation(fields: [cluster_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "virtual_machines_ibfk_2")
  vm_activity_tracking     vm_activity_tracking?
  vm_auto_shutdown_log     vm_auto_shutdown_log[]
  vm_backup_assignments    vm_backup_assignments[]
  vm_billing_snapshots     vm_billing_snapshots[]
  vm_daily_summaries       vm_daily_summaries[]
  vm_ip_assignments        vm_ip_assignments[]
  vm_notes                 vm_notes[]
  vm_resource_metrics      vm_resource_metrics[]
  vm_schedule_logs         vm_schedule_logs[]
  vm_schedules             vm_schedules[]
  vm_snapshots             vm_snapshots[]
  vm_tag_assignments       vm_tag_assignments[]

  @@unique([cluster_id, vmid], map: "unique_vm")
  @@index([marked_for_deletion_by], map: "fk_marked_deletion_by")
  @@index([esxi_import_job_id], map: "fk_vm_import_job")
  @@index([auto_shutdown_enabled, status, last_activity_at], map: "idx_auto_shutdown_active")
  @@index([cluster_id], map: "idx_cluster")
  @@index([company_id], map: "idx_company")
  @@index([company_id, project_id], map: "idx_company_project")
  @@index([imported_from_esxi, esxi_import_job_id], map: "idx_esxi_import")
  @@index([primary_ip_internal, primary_ip_external], map: "idx_primary_ips")
  @@index([project_id], map: "idx_project")
  @@index([status], map: "idx_status")
  @@index([status, marked_for_deletion_at], map: "idx_status_deletion")
  @@index([vmid], map: "idx_vmid")
  @@index([cluster_id, company_id], map: "idx_vms_cluster_company")
  @@index([company_id, status], map: "idx_vms_company_status")
  @@index([deleted_at], map: "idx_vms_deleted")
  @@index([name], map: "idx_vms_name")
  @@index([project_id], map: "idx_vms_project_id")
  @@index([status], map: "idx_vms_status")
  @@fulltext([name, description], map: "ft_vm_search")
}

model vm_activity_tracking {
  id               BigInt           @id @default(autoincrement())
  vm_id            Int              @unique(map: "vm_id")
  last_activity    DateTime?        @default(now()) @db.Timestamp(0)
  cpu_usage_avg    Decimal?         @db.Decimal(5, 2)
  network_in_avg   BigInt?
  network_out_avg  BigInt?
  updated_at       DateTime?        @default(now()) @db.Timestamp(0)
  virtual_machines virtual_machines @relation(fields: [vm_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "vm_activity_tracking_ibfk_1")

  @@index([last_activity], map: "idx_last_activity")
}

model vm_auto_shutdown_log {
  id               BigInt           @id @default(autoincrement())
  vm_id            Int
  reason           String           @db.VarChar(100)
  idle_hours       Int?
  shutdown_at      DateTime?        @default(now()) @db.Timestamp(0)
  virtual_machines virtual_machines @relation(fields: [vm_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "vm_auto_shutdown_log_ibfk_1")

  @@index([shutdown_at], map: "idx_shutdown_at")
  @@index([vm_id], map: "vm_id")
}

model vm_backup_assignments {
  id               Int              @id @default(autoincrement())
  vm_id            Int
  policy_id        Int
  assigned_at      DateTime?        @default(now()) @db.Timestamp(0)
  virtual_machines virtual_machines @relation(fields: [vm_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "vm_backup_assignments_ibfk_1")
  backup_policies  backup_policies  @relation(fields: [policy_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "vm_backup_assignments_ibfk_2")

  @@unique([vm_id, policy_id], map: "unique_backup")
  @@index([policy_id], map: "policy_id")
}

model vm_billing_snapshots {
  id               Int              @id @default(autoincrement())
  company_id       Int
  vm_id            Int
  vm_name          String           @db.VarChar(255)
  vmid             Int
  cluster_id       Int
  snapshot_date    DateTime         @db.Date
  cpu_cores        Int
  memory_mb        Int
  storage_gb       Decimal          @db.Decimal(10, 2)
  uptime_hours     Decimal          @default(0.00) @db.Decimal(10, 2)
  status           String           @db.VarChar(20)
  created_at       DateTime?        @default(now()) @db.Timestamp(0)
  companies        companies        @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "vm_billing_snapshots_ibfk_1")
  virtual_machines virtual_machines @relation(fields: [vm_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "vm_billing_snapshots_ibfk_2")
  proxmox_clusters proxmox_clusters @relation(fields: [cluster_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "vm_billing_snapshots_ibfk_3")

  @@unique([vm_id, snapshot_date], map: "unique_vm_date")
  @@index([cluster_id], map: "cluster_id")
  @@index([company_id, snapshot_date], map: "idx_company_date")
}

model vm_daily_summaries {
  id                 BigInt           @id @default(autoincrement())
  vm_id              Int
  company_id         Int
  cluster_id         Int
  summary_date       DateTime         @db.Date
  avg_cpu_usage      Decimal?         @db.Decimal(5, 2)
  avg_memory_usage   BigInt?
  avg_memory_percent Decimal?         @db.Decimal(5, 2)
  max_cpu_usage      Decimal?         @db.Decimal(5, 2)
  max_memory_usage   BigInt?
  total_disk_read    BigInt?          @default(0)
  total_disk_write   BigInt?          @default(0)
  total_network_in   BigInt?          @default(0)
  total_network_out  BigInt?          @default(0)
  uptime_minutes     Int?             @default(0)
  total_minutes      Int?             @default(1440)
  created_at         DateTime?        @default(now()) @db.Timestamp(0)
  virtual_machines   virtual_machines @relation(fields: [vm_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "vm_daily_summaries_ibfk_1")
  companies          companies        @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "vm_daily_summaries_ibfk_2")
  proxmox_clusters   proxmox_clusters @relation(fields: [cluster_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "vm_daily_summaries_ibfk_3")

  @@unique([vm_id, summary_date], map: "unique_vm_date")
  @@index([cluster_id], map: "cluster_id")
  @@index([company_id, summary_date], map: "idx_company_date")
}

model vm_deletion_audit {
  id                   Int                               @id @default(autoincrement())
  vm_id                Int
  vm_name              String                            @db.VarChar(255)
  vmid                 Int
  company_id           Int
  cluster_id           Int
  deleted_by           Int
  deletion_method      vm_deletion_audit_deletion_method
  deleted_from_proxmox Boolean?                          @default(false)
  metrics_deleted      Int?                              @default(0)
  ips_deleted          Int?                              @default(0)
  nat_rules_deleted    Int?                              @default(0)
  alerts_deleted       Int?                              @default(0)
  deletion_notes       String?                           @db.Text
  deleted_at           DateTime?                         @default(now()) @db.Timestamp(0)

  @@index([cluster_id], map: "idx_cluster")
  @@index([company_id], map: "idx_company")
  @@index([deleted_at], map: "idx_deleted_at")
  @@index([deleted_by], map: "idx_deleted_by")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model vm_import_jobs {
  id                Int                    @id @default(autoincrement())
  esxi_host_id      Int
  esxi_vm_name      String                 @db.VarChar(255)
  esxi_vm_path      String?                @db.VarChar(500)
  target_cluster_id Int
  target_node       String                 @db.VarChar(100)
  target_storage    String                 @db.VarChar(100)
  target_vmid       Int?
  target_vm_name    String?                @db.VarChar(255)
  company_id        Int
  project_id        Int?
  status            vm_import_jobs_status? @default(queued)
  progress          Int?                   @default(0)
  current_step      String?                @db.VarChar(255)
  error_message     String?                @db.Text
  import_metadata   String?                @db.LongText
  started_at        DateTime?              @db.Timestamp(0)
  completed_at      DateTime?              @db.Timestamp(0)
  created_by        Int
  created_at        DateTime?              @default(now()) @db.Timestamp(0)
  updated_at        DateTime?              @default(now()) @db.Timestamp(0)
  virtual_machines  virtual_machines[]
  esxi_hosts        esxi_hosts             @relation(fields: [esxi_host_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "vm_import_jobs_ibfk_1")
  proxmox_clusters  proxmox_clusters       @relation(fields: [target_cluster_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "vm_import_jobs_ibfk_2")
  companies         companies              @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "vm_import_jobs_ibfk_3")
  vm_projects       vm_projects?           @relation(fields: [project_id], references: [id], onUpdate: NoAction, map: "vm_import_jobs_ibfk_4")
  users             users                  @relation(fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "vm_import_jobs_ibfk_5")

  @@index([created_by], map: "created_by")
  @@index([company_id], map: "idx_company")
  @@index([created_at], map: "idx_created_at")
  @@index([esxi_host_id], map: "idx_esxi_host")
  @@index([status], map: "idx_status")
  @@index([project_id], map: "project_id")
  @@index([target_cluster_id], map: "target_cluster_id")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model vm_ip_assignments {
  id               Int                       @id @default(autoincrement())
  vm_id            Int
  ip_range_id      Int
  ip_address       String                    @db.VarChar(50)
  ip_type          vm_ip_assignments_ip_type
  is_primary       Boolean?                  @default(false)
  mac_address      String?                   @db.VarChar(17)
  interface_name   String?                   @db.VarChar(50)
  assigned_at      DateTime?                 @default(now()) @db.Timestamp(0)
  notes            String?                   @db.Text
  virtual_machines virtual_machines          @relation(fields: [vm_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "vm_ip_assignments_ibfk_1")
  ip_ranges        ip_ranges                 @relation(fields: [ip_range_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "vm_ip_assignments_ibfk_2")

  @@unique([vm_id, ip_address], map: "unique_ip_vm")
  @@index([ip_address], map: "idx_ip_address")
  @@index([ip_range_id], map: "idx_ip_range")
  @@index([vm_id], map: "idx_vm")
  @@index([ip_range_id], map: "idx_vm_ip_range")
  @@index([vm_id], map: "idx_vm_ip_vm")
}

model vm_notes {
  id               Int                 @id @default(autoincrement())
  vm_id            Int
  note             String              @db.Text
  note_type        vm_notes_note_type? @default(general)
  is_markdown      Boolean?            @default(false)
  created_by       Int?
  created_at       DateTime?           @default(now()) @db.Timestamp(0)
  updated_at       DateTime?           @default(now()) @db.Timestamp(0)
  virtual_machines virtual_machines    @relation(fields: [vm_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "vm_notes_ibfk_1")
  users            users?              @relation(fields: [created_by], references: [id], onUpdate: NoAction, map: "vm_notes_ibfk_2")
  vm_notes_history vm_notes_history[]

  @@index([created_by], map: "created_by")
  @@index([created_at], map: "idx_created_at")
  @@index([vm_id], map: "idx_vm_id")
  @@fulltext([note], map: "ft_note")
}

model vm_notes_history {
  id          Int                           @id @default(autoincrement())
  note_id     Int
  old_content String?                       @db.Text
  new_content String?                       @db.Text
  changed_by  Int?
  changed_at  DateTime?                     @default(now()) @db.Timestamp(0)
  change_type vm_notes_history_change_type? @default(updated)
  vm_notes    vm_notes                      @relation(fields: [note_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "vm_notes_history_ibfk_1")
  users       users?                        @relation(fields: [changed_by], references: [id], onUpdate: NoAction, map: "vm_notes_history_ibfk_2")

  @@index([changed_by], map: "changed_by")
  @@index([changed_at], map: "idx_changed_at")
  @@index([note_id], map: "idx_note_id")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model vm_projects {
  id                                                             Int                  @id @default(autoincrement())
  company_id                                                     Int
  name                                                           String               @db.VarChar(255)
  description                                                    String?              @db.Text
  created_at                                                     DateTime?            @default(now()) @db.Timestamp(0)
  updated_at                                                     DateTime?            @default(now()) @db.Timestamp(0)
  opnsense_id                                                    Int?
  billing_records                                                billing_records[]
  daily_vm_usage                                                 daily_vm_usage[]
  dr_vm_policies                                                 dr_vm_policies[]
  opnsense_instances_opnsense_instances_project_idTovm_projects  opnsense_instances[] @relation("opnsense_instances_project_idTovm_projects")
  pricing_tiers                                                  pricing_tiers[]
  usage_tracking                                                 usage_tracking[]
  virtual_machines                                               virtual_machines[]
  vm_import_jobs                                                 vm_import_jobs[]
  companies                                                      companies            @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "vm_projects_ibfk_1")
  opnsense_instances_vm_projects_opnsense_idToopnsense_instances opnsense_instances?  @relation("vm_projects_opnsense_idToopnsense_instances", fields: [opnsense_id], references: [id], onUpdate: NoAction, map: "vm_projects_ibfk_2")

  @@index([company_id], map: "idx_company")
  @@index([name], map: "idx_name")
  @@index([opnsense_id], map: "opnsense_id")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model vm_resource_metrics {
  id                BigInt                         @id @default(autoincrement()) @db.UnsignedBigInt
  vm_id             Int
  company_id        Int
  cluster_id        Int
  cpu_cores         Int
  cpu_usage_percent Decimal?                       @default(0.00) @db.Decimal(5, 2)
  memory_mb         Int
  memory_used_mb    Int?                           @default(0)
  memory_percent    Decimal?                       @default(0.00) @db.Decimal(5, 2)
  disk_total_gb     Decimal                        @db.Decimal(10, 2)
  disk_used_gb      Decimal?                       @default(0.00) @db.Decimal(10, 2)
  disk_read_iops    Int?                           @default(0)
  disk_write_iops   Int?                           @default(0)
  network_in_bytes  BigInt?                        @default(0)
  network_out_bytes BigInt?                        @default(0)
  vm_status         vm_resource_metrics_vm_status? @default(unknown)
  uptime_seconds    BigInt?                        @default(0)
  collected_at      DateTime                       @default(now()) @db.Timestamp(0)
  created_at        DateTime?                      @default(now()) @db.Timestamp(0)
  proxmox_clusters  proxmox_clusters               @relation(fields: [cluster_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_vm_metrics_cluster")
  companies         companies                      @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_vm_metrics_company")
  virtual_machines  virtual_machines               @relation(fields: [vm_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_vm_metrics_vm")

  @@index([cluster_id, collected_at], map: "idx_cluster_collected")
  @@index([collected_at], map: "idx_collected_at")
  @@index([company_id, collected_at], map: "idx_company_collected")
  @@index([vm_id, collected_at], map: "idx_vm_collected")
  @@index([vm_id, vm_status], map: "idx_vm_status")
}

model vm_schedule_logs {
  id               BigInt                  @id @default(autoincrement())
  schedule_id      Int
  vm_id            Int
  action           String                  @db.VarChar(50)
  status           vm_schedule_logs_status
  message          String?                 @db.Text
  executed_at      DateTime?               @default(now()) @db.Timestamp(0)
  vm_schedules     vm_schedules            @relation(fields: [schedule_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "vm_schedule_logs_ibfk_1")
  virtual_machines virtual_machines        @relation(fields: [vm_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "vm_schedule_logs_ibfk_2")

  @@index([executed_at], map: "idx_executed_at")
  @@index([status], map: "idx_status")
  @@index([schedule_id], map: "schedule_id")
  @@index([vm_id], map: "vm_id")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model vm_schedules {
  id               Int                        @id @default(autoincrement())
  vm_id            Int
  action           vm_schedules_action
  schedule_type    vm_schedules_schedule_type
  schedule_value   String                     @db.VarChar(50)
  enabled          Boolean?                   @default(true)
  last_run         DateTime?                  @db.Timestamp(0)
  created_at       DateTime?                  @default(now()) @db.Timestamp(0)
  updated_at       DateTime?                  @default(now()) @db.Timestamp(0)
  vm_schedule_logs vm_schedule_logs[]
  virtual_machines virtual_machines           @relation(fields: [vm_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "vm_schedules_ibfk_1")

  @@index([enabled], map: "idx_enabled")
  @@index([last_run], map: "idx_last_run")
  @@index([vm_id], map: "vm_id")
}

model vm_snapshots {
  id               BigInt                      @id @default(autoincrement())
  vm_id            Int
  snapshot_name    String                      @db.VarChar(100)
  description      String?                     @db.Text
  snapshot_type    vm_snapshots_snapshot_type? @default(manual)
  size_gb          Decimal?                    @db.Decimal(10, 2)
  created_at       DateTime?                   @default(now()) @db.Timestamp(0)
  created_by       Int?
  virtual_machines virtual_machines            @relation(fields: [vm_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "vm_snapshots_ibfk_1")
  users            users?                      @relation(fields: [created_by], references: [id], onUpdate: NoAction, map: "vm_snapshots_ibfk_2")

  @@unique([vm_id, snapshot_name], map: "unique_vm_snapshot")
  @@index([created_by], map: "created_by")
  @@index([created_at], map: "idx_created_at")
}

model vm_tag_assignments {
  id               Int              @id @default(autoincrement())
  vm_id            Int
  tag_id           Int
  assigned_by      Int?
  assigned_at      DateTime?        @default(now()) @db.Timestamp(0)
  virtual_machines virtual_machines @relation(fields: [vm_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "vm_tag_assignments_ibfk_1")
  vm_tags          vm_tags          @relation(fields: [tag_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "vm_tag_assignments_ibfk_2")
  users            users?           @relation(fields: [assigned_by], references: [id], onUpdate: NoAction, map: "vm_tag_assignments_ibfk_3")

  @@unique([vm_id, tag_id], map: "unique_vm_tag")
  @@index([assigned_by], map: "assigned_by")
  @@index([tag_id], map: "idx_tag_id")
  @@index([vm_id], map: "idx_vm_id")
}

model vm_tags {
  id                 Int                  @id @default(autoincrement())
  name               String               @db.VarChar(50)
  color              String?              @default("#2196F3") @db.VarChar(7)
  description        String?              @db.Text
  company_id         Int?
  created_by         Int?
  created_at         DateTime?            @default(now()) @db.Timestamp(0)
  vm_tag_assignments vm_tag_assignments[]
  companies          companies?           @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "vm_tags_ibfk_1")
  users              users?               @relation(fields: [created_by], references: [id], onUpdate: NoAction, map: "vm_tags_ibfk_2")

  @@unique([name, company_id], map: "unique_tag_per_company")
  @@index([created_by], map: "created_by")
  @@index([company_id], map: "idx_company_id")
  @@index([name], map: "idx_name")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model vm_template_usage {
  id           Int          @id @default(autoincrement())
  template_id  Int
  vm_id        Int
  created_by   Int
  created_at   DateTime?    @default(now()) @db.Timestamp(0)
  vm_templates vm_templates @relation(fields: [template_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "vm_template_usage_ibfk_1")
  users        users        @relation(fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "vm_template_usage_ibfk_2")

  @@index([created_by], map: "created_by")
  @@index([template_id], map: "idx_template")
  @@index([vm_id], map: "idx_vm")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model vm_templates {
  id                  Int                   @id @default(autoincrement())
  name                String                @db.VarChar(255)
  description         String?               @db.Text
  vmid                Int
  node_name           String                @db.VarChar(100)
  cluster_id          Int
  company_id          Int?
  os_type             vm_templates_os_type? @default(linux)
  os_version          String?               @db.VarChar(100)
  cpu_cores           Int?                  @default(2)
  memory_mb           Int?                  @default(2048)
  disk_size_gb        Int?                  @default(20)
  has_cloud_init      Boolean?              @default(false)
  cloud_init_user     String?               @default("ubuntu") @db.VarChar(100)
  cloud_init_packages String?               @db.Text
  cloud_init_script   String?               @db.Text
  network_bridge      String?               @default("vmbr0") @db.VarChar(50)
  network_model       String?               @default("virtio") @db.VarChar(20)
  is_public           Boolean?              @default(false)
  created_by          Int
  created_at          DateTime?             @default(now()) @db.Timestamp(0)
  updated_at          DateTime?             @default(now()) @db.Timestamp(0)
  vm_template_usage   vm_template_usage[]
  proxmox_clusters    proxmox_clusters      @relation(fields: [cluster_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "vm_templates_ibfk_1")
  companies           companies?            @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "vm_templates_ibfk_2")
  users               users                 @relation(fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "vm_templates_ibfk_3")

  @@index([created_by], map: "created_by")
  @@index([cluster_id], map: "idx_cluster")
  @@index([company_id], map: "idx_company")
  @@index([os_type], map: "idx_os_type")
  @@index([is_public], map: "idx_public")
}

model webhook_deliveries {
  id                   Int                                 @id @default(autoincrement())
  webhook_id           Int
  event_type           String                              @db.VarChar(100)
  payload              String                              @db.LongText
  response_status_code Int?
  response_body        String?                             @db.Text
  delivery_status      webhook_deliveries_delivery_status? @default(pending)
  attempts             Int?                                @default(0)
  error_message        String?                             @db.Text
  delivered_at         DateTime?                           @db.Timestamp(0)
  webhooks             webhooks                            @relation(fields: [webhook_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "webhook_deliveries_ibfk_1")

  @@index([delivered_at], map: "idx_delivered_at")
  @@index([delivery_status], map: "idx_status")
  @@index([webhook_id], map: "idx_webhook")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model webhook_deliveries_old {
  id                Int                            @id @default(autoincrement())
  user_id           Int
  notification_type String                         @db.VarChar(50)
  webhook_url       String                         @db.VarChar(500)
  payload           String                         @db.LongText
  status_code       Int?
  response_body     String?                        @db.Text
  status            webhook_deliveries_old_status? @default(pending)
  attempts          Int?                           @default(0)
  delivered_at      DateTime?                      @db.Timestamp(0)
  error_message     String?                        @db.Text
  created_at        DateTime?                      @default(now()) @db.Timestamp(0)
  users             users                          @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "webhook_deliveries_old_ibfk_1")

  @@index([status, created_at], map: "idx_status")
  @@index([user_id], map: "user_id")
}

model webhooks {
  id                 Int                  @id @default(autoincrement())
  name               String               @db.VarChar(255)
  url                String               @db.VarChar(500)
  events             Json
  secret             String?              @db.VarChar(500)
  custom_headers     Json?
  timeout_seconds    Int?                 @default(30)
  is_active          Boolean?             @default(true)
  company_id         Int?
  created_by         Int
  created_at         DateTime?            @default(now()) @db.Timestamp(0)
  updated_at         DateTime?            @default(now()) @db.Timestamp(0)
  webhook_deliveries webhook_deliveries[]
  companies          companies?           @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "webhooks_ibfk_1")
  users              users                @relation(fields: [created_by], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "webhooks_ibfk_2")

  @@index([created_by], map: "created_by")
  @@index([is_active], map: "idx_active")
  @@index([company_id], map: "idx_company")
}

model whitelabel_assets {
  id                   Int                          @id @default(autoincrement())
  company_id           Int?
  url_mapping_id       Int?
  asset_type           whitelabel_assets_asset_type
  asset_name           String                       @db.VarChar(255)
  asset_slug           String                       @db.VarChar(255)
  file_path            String?                      @db.VarChar(500)
  file_url             String?                      @db.VarChar(500)
  file_size            Int?
  mime_type            String?                      @db.VarChar(100)
  file_hash            String?                      @db.VarChar(64)
  width                Int?
  height               Int?
  alt_text             String?                      @db.VarChar(255)
  description          String?                      @db.Text
  is_active            Boolean?                     @default(true)
  usage_count          Int?                         @default(0)
  last_used_at         DateTime?                    @db.Timestamp(0)
  created_at           DateTime?                    @default(now()) @db.Timestamp(0)
  updated_at           DateTime?                    @default(now()) @db.Timestamp(0)
  uploaded_by          Int?
  companies            companies?                   @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "whitelabel_assets_ibfk_1")
  company_url_mappings company_url_mappings?        @relation(fields: [url_mapping_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "whitelabel_assets_ibfk_2")

  @@unique([company_id, url_mapping_id, asset_slug], map: "unique_asset")
  @@index([is_active], map: "idx_active")
  @@index([asset_type], map: "idx_asset_type")
  @@index([company_id], map: "idx_company")
  @@index([url_mapping_id], map: "idx_url_mapping")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model whitelabel_settings {
  id                          Int                                  @id @default(autoincrement())
  company_id                  Int                                  @unique(map: "unique_company")
  feature_flags               Json?
  smtp_host                   String?                              @db.VarChar(255)
  smtp_port                   Int?
  smtp_username               String?                              @db.VarChar(255)
  smtp_password_encrypted     String?                              @db.Text
  smtp_from_email             String?                              @db.VarChar(255)
  smtp_from_name              String?                              @default("Support") @db.VarChar(255)
  smtp_encryption             whitelabel_settings_smtp_encryption? @default(tls)
  twilio_account_sid          String?                              @db.VarChar(255)
  twilio_auth_token_encrypted String?                              @db.Text
  twilio_phone_number         String?                              @db.VarChar(50)
  stripe_publishable_key      String?                              @db.VarChar(255)
  stripe_secret_key_encrypted String?                              @db.Text
  api_webhook_url             String?                              @db.VarChar(500)
  api_webhook_secret          String?                              @db.VarChar(255)
  widget_allowed_origins      String?                              @db.Text
  created_at                  DateTime?                            @default(now()) @db.Timestamp(0)
  updated_at                  DateTime?                            @default(now()) @db.Timestamp(0)
  companies                   companies                            @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "whitelabel_settings_ibfk_1")
}

model iso_sync_jobs {
  id                 String                @id @db.VarChar(100)
  iso_id             Int
  source_cluster_id  Int
  target_cluster_ids Json
  status             iso_sync_jobs_status? @default(pending)
  progress           Int?                  @default(0)
  results            Json?
  error              String?               @db.Text
  created_at         DateTime?             @default(now()) @db.Timestamp(0)
  updated_at         DateTime?             @default(now()) @db.Timestamp(0)
  completed_at       DateTime?             @db.Timestamp(0)
  isos               isos                  @relation(fields: [iso_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "iso_sync_jobs_ibfk_1")
  proxmox_clusters   proxmox_clusters      @relation(fields: [source_cluster_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "iso_sync_jobs_ibfk_2")

  @@index([created_at], map: "idx_created_at")
  @@index([status], map: "idx_status")
  @@index([iso_id], map: "iso_id")
  @@index([source_cluster_id], map: "source_cluster_id")
}

model billing_transactions {
  id                       Int                                   @id @default(autoincrement())
  company_id               Int
  amount                   Decimal                               @db.Decimal(10, 2)
  currency                 String?                               @default("USD") @db.VarChar(3)
  payment_method           String                                @db.VarChar(50)
  status                   billing_transactions_status
  transaction_type         billing_transactions_transaction_type
  description              String?                               @db.Text
  stripe_payment_intent_id String?                               @db.VarChar(255)
  stripe_invoice_id        String?                               @db.VarChar(255)
  stripe_charge_id         String?                               @db.VarChar(255)
  metadata                 Json?
  created_at               DateTime?                             @default(now()) @db.Timestamp(0)
  updated_at               DateTime?                             @default(now()) @db.Timestamp(0)
  companies                companies                             @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "billing_transactions_ibfk_1")

  @@index([company_id], map: "idx_company_id")
  @@index([created_at], map: "idx_created_at")
  @@index([status], map: "idx_status")
  @@index([stripe_invoice_id], map: "idx_stripe_invoice")
  @@index([stripe_payment_intent_id], map: "idx_stripe_payment_intent")
  @@index([transaction_type], map: "idx_transaction_type")
}

enum bulk_cluster_operations_operation_type {
  test_connection
  restart_service
  update_config
  push_ssh_keys
  deploy_agent
}

enum bulk_operations_log_operation_type {
  start
  stop
  restart
  delete
  tag
  move
  snapshot
}

enum export_history_export_type {
  vms
  users
  companies
  billing
  reports
  custom
}

enum ssh_keys_key_type {
  rsa
  ed25519
  ecdsa
}

enum bulk_operations_log_entity_type {
  vm
  container
  cluster
}

enum company_payment_methods_payment_type {
  stripe
  paypal
  bank_transfer
  credit_card
  wire_transfer
  check
  cash
  crypto
  manual
}

enum company_sso_config_provider {
  microsoft
  google
  okta
  generic
}

enum dr_automation_logs_job_type {
  sync
  failover
  failback
  test
  zfs_setup
  health_check
}

enum dr_failover_events_event_type {
  failover
  failback
  test
  partial_failover
}

enum dr_health_checks_check_type {
  cluster_connectivity
  storage_availability
  network_reachability
  replication_status
  vm_integrity
}

enum export_history_file_format {
  csv
  xlsx
  pdf
  json
}

enum global_settings_setting_category {
  branding
  email
  ui
  features
  security
  integrations
  limits
  custom
}

enum invoice_line_items_line_type {
  usage
  subscription
  one_time
  discount
  tax
}

enum nat_deployment_log_action {
  create
  update
  delete
  enable
  disable
}

enum pricing_assignments_resource_type {
  vm
  company
  project
  cluster
}

enum rate_limits_identifier_type {
  ip
  user
  api_key
}

enum snapshot_schedules_schedule_type {
  daily
  weekly
  monthly
}

enum user_2fa_logs_action {
  setup_started
  setup_completed
  verified
  failed
  disabled
  backup_used
  locked
  unlocked
}

enum user_bookmarks_bookmark_type {
  vm
  company
  cluster
  page
}

enum vm_schedules_action {
  start
  stop
  restart
  snapshot
}

enum alert_history_target_type {
  vm
  cluster
  node
  company
}

enum audit_export_jobs_export_format {
  csv
  json
  pdf
}

enum billing_audit_log_action {
  invoice_created
  invoice_sent
  invoice_paid
  invoice_overdue
  invoice_cancelled
  payment_received
  payment_failed
  pricing_changed
  billing_suspended
  billing_resumed
}

enum companies_billing_model {
  fixed_per_vm
  resource_based
  hybrid
}

enum company_quotas_quota_type {
  vm_count
  cpu_cores
  memory_gb
  storage_gb
  network_bandwidth_mbps
}

enum company_subscriptions_status {
  active
  trial
  expired
  cancelled
  suspended
}

enum dr_config_templates_template_type {
  basic
  high_availability
  geo_distributed
  custom
}

enum dr_failover_events_trigger_type {
  manual
  automatic
  scheduled_test
}

enum email_templates_template_type {
  verification
  welcome
  password_reset
  vm_created
  vm_deleted
  invoice
  payment_received
  payment_failed
  subscription_created
  subscription_cancelled
  support_ticket
  custom
}

enum feedback_submissions_type {
  bug
  feature_request
  feedback
  question
}

enum ip_addresses_status {
  available
  used
  reserved
}

enum nat_deployment_log_status {
  started
  success
  failed
}

enum nat_deployment_metrics_deployment_type {
  create
  update
  delete
  test
}

enum nat_firewall_rules_action {
  accept
  drop
  reject
}

enum network_edges_edge_type {
  firewall
  router
  vpn
}

enum payment_method_audit_action {
  added
  updated
  removed
  set_primary
  verified
  failed_verification
  charged
  charge_failed
}

enum pricing_tiers_tier_type {
  vm_base
  cpu_core
  memory_gb
  storage_gb
  ip_range
  opnsense_instance
  backup_gb
  bandwidth_gb
  snapshot
  support_hours
}

enum resource_alerts_alert_type {
  cpu
  memory
  disk
  network
}

enum saved_filters_filter_type {
  vm
  company
  user
  cluster
  network
}

enum search_history_search_type {
  global
  vm
  company
  user
}

enum security_audit_log_event_category {
  authentication
  authorization
  rate_limiting
  csrf
  suspicious
  system
}

enum storage_pools_storage_type {
  dir
  lvm
  lvmthin
  zfs
  ceph
  nfs
  iscsi
  glusterfs
}

enum user_vm_permissions_permission_level {
  read
  write
  admin
}

enum vm_notes_note_type {
  general
  maintenance
  configuration
  troubleshooting
  security
}

enum vm_schedules_schedule_type {
  daily
  weekly
  monthly
  cron
}

enum whitelabel_assets_asset_type {
  logo
  favicon
  login_background
  email_header
  email_footer
  banner
  icon
  custom_file
  css
  javascript
}

enum alert_rules_rule_type {
  threshold
  anomaly
  availability
  performance
}

enum api_scopes_min_role {
  user
  company_admin
  super_admin
}

enum help_article_changelog_action {
  created
  updated
  published
  unpublished
  deleted
}

enum help_faqs_answer_type {
  markdown
  html
}

enum monitoring_metrics_metric_type {
  cpu
  memory
  disk
  network
  load
  uptime
}

enum nat_deployment_metrics_auth_method {
  ssh_key
  password
}

enum nat_rules_nat_type {
  port_forward
  proxmox_nat
  opnsense
}

enum onboarding_steps_status {
  pending
  in_progress
  completed
  skipped
  failed
}

enum resource_alert_history_alert_type {
  cpu
  memory
  disk
  network
}

enum security_audit_log_severity {
  low
  medium
  high
  critical
}

enum usage_metrics_metric_type {
  cpu
  memory
  storage
  network_in
  network_out
}

enum usage_tracking_usage_type {
  compute
  storage
  bandwidth
  backup
  support_hours
}

enum vm_ip_assignments_ip_type {
  internal
  external
}

enum vm_schedule_logs_status {
  success
  failed
}

enum vm_snapshots_snapshot_type {
  manual
  scheduled
  pre_update
  backup
}

enum alert_rules_metric_type {
  cpu
  memory
  disk
  network
  load
  uptime
}

enum dr_health_checks_status {
  healthy
  warning
  critical
  unknown
}

enum ip_reservations_reservation_type {
  vm
  device
  service
  other
}

enum opnsense_firewall_rules_direction {
  in
  out
}

enum payments_payment_method {
  manual
  stripe
  paypal
  bank_transfer
  credit_card
}

enum resource_alerts_threshold_operator {
  GT
  LT
  GTE
  LTE
  EQ
}

enum sso_login_audit_provider {
  microsoft
  google
  okta
  generic
}

enum subscription_plans_billing_period {
  monthly
  quarterly
  yearly
}

enum alert_history_severity {
  info
  warning
  critical
  emergency
}

enum alert_rules_condition_operator {
  GT
  LT
  GTE
  LTE
  EQ
  NEQ
}

enum articles_target_audience {
  everyone
  cluster
  company
  company_role
}

enum backup_policies_compression {
  none
  lzo
  gzip
  zstd
}

enum backup_schedules_schedule_type {
  once
  hourly
  daily
  weekly
  monthly
}

enum dr_automation_logs_status {
  running
  success
  warning
  failed
}

enum dr_cluster_pairs_replication_method {
  zfs
  storage_replication
  backup_restore
}

enum dr_test_schedules_test_type {
  boot_test
  network_test
  full_failover_test
  custom
}

enum dr_vm_policies_replication_priority {
  critical
  high
  medium
  low
}

enum help_articles_content_type {
  markdown
  html
}

enum opnsense_firewall_rules_action {
  pass
  block
  reject
}

enum sso_login_audit_status {
  success
  failed
  blocked
}

enum vm_notes_history_change_type {
  created
  updated
  deleted
}

enum webhook_deliveries_delivery_status {
  success
  failed
  pending
}

enum articles_target_role {
  super_admin
  company_admin
  user
}

enum backup_history_backup_type {
  scheduled
  manual
  pre_migration
  disaster_recovery
}

enum backup_policies_mode {
  snapshot
  suspend
  stop
}

enum bulk_operations_log_status {
  pending
  in_progress
  completed
  failed
  partially_completed
}

enum esxi_hosts_status {
  active
  inactive
  error
}

enum feedback_submissions_priority {
  low
  medium
  high
  urgent
}

enum network_edges_status {
  active
  inactive
}

enum notification_queue_priority {
  low
  normal
  high
  critical
}

enum onboarding_registrations_company_size {
  small      @map("1-10")
  medium     @map("11-50")
  large      @map("51-200")
  xlarge     @map("201-500")
  enterprise @map("500+")
}

enum quota_approval_requests_status {
  pending
  approved
  rejected
  cancelled
}

enum support_tickets_priority {
  low
  medium
  high
  urgent
}

enum vm_deletion_audit_deletion_method {
  single
  bulk
}

enum vm_templates_os_type {
  linux
  windows
  other
}

enum webhook_deliveries_old_status {
  pending
  delivered
  failed
}

enum activity_logs_status {
  success
  failed
  in_progress
  warning
}

enum audit_export_jobs_status {
  pending
  processing
  completed
  failed
}

enum backup_history_backup_mode {
  snapshot
  suspend
  stop
}

enum backup_restore_jobs_status {
  pending
  restoring
  completed
  failed
}

enum dr_test_results_status {
  running
  passed
  failed
  partial
  cancelled
}

enum dr_zfs_replication_jobs_replication_type {
  full
  incremental
}

enum feedback_submissions_status {
  new
  acknowledged
  in_progress
  resolved
  closed
  wont_fix
}

enum global_settings_setting_type {
  string
  integer
  float
  boolean
  json
  text
}

enum help_article_drafts_content_type {
  markdown
  html
}

enum nat_firewall_rules_protocol {
  tcp
  udp
  icmp
  both
  any
}

enum notification_queue_status {
  pending
  sending
  sent
  failed
  cancelled
}

enum opnsense_firewall_rules_source_type {
  any
  network
  address
}

enum payments_status {
  pending
  completed
  failed
  refunded
}

enum pricing_tiers_billing_cycle {
  hourly
  daily
  monthly
  annual
}

enum replication_jobs_status {
  active
  failed
  syncing
}

enum ssh_key_cluster_status_auth_method_last_used {
  ssh_key
  password
  unknown
}

enum support_tickets_status {
  open
  in_progress
  waiting_customer
  waiting_support
  resolved
  closed
}

enum alert_rules_severity {
  info
  warning
  critical
  emergency
}

enum backup_servers_status {
  active
  inactive
  error
}

enum dr_zfs_replication_jobs_compression {
  none
  lz4
  gzip
  zstd
}

enum help_article_drafts_visibility {
  global
  company_specific
  company_type
  role_specific
}

enum help_articles_difficulty {
  beginner
  intermediate
  advanced
}

enum ip_reservations_status {
  active
  expired
  fulfilled
  cancelled
}

enum nat_firewall_rules_direction {
  inbound
  outbound
  both
}

enum proxmox_clusters_status {
  active
  maintenance
  offline
}

enum whitelabel_settings_smtp_encryption {
  none
  ssl
  tls
}

enum alert_rules_target_type {
  vm
  cluster
  node
  company
}

enum billing_records_status {
  pending
  invoiced
  paid
}

enum companies_status {
  active
  suspended
  deleted
}

enum company_backup_assignments_backup_type {
  full
  incremental
  differential
}

enum company_billing_payment_method {
  manual
  stripe
  paypal
  bank_transfer
  credit_card
  wire_transfer
  check
  cash
  crypto
  other
}

enum dr_automation_logs_triggered_by {
  cron
  manual
  api
  webhook
  health_monitor
}

enum invoices_status {
  draft
  sent
  paid
  overdue
  cancelled
  refunded
}

enum ip_ranges_ip_type {
  internal
  external
}

enum nat_rules_protocol {
  tcp
  udp
  both
  icmp
}

enum ssh_keys_status {
  active
  expired
  rotated
  revoked
}

enum alert_history_status {
  triggered
  acknowledged
  resolved
  auto_resolved
}

enum backup_history_compression {
  none
  lzo
  gzip
  zstd
}

enum bulk_cluster_operations_status {
  pending
  in_progress
  completed
  failed
}

enum company_sso_config_default_role {
  user
  company_admin
}

enum email_queue_status {
  pending
  sending
  sent
  failed
  cancelled
}

enum opnsense_firewall_rules_destination_type {
  any
  network
  address
}

enum pricing_plans_billing_cycle {
  monthly
  quarterly
  annual
}

enum users_role {
  company_admin
  user
  super_admin
}

enum vm_import_jobs_status {
  queued
  discovering
  importing
  configuring
  completed
  failed
  cancelled
}

enum backup_history_status {
  running
  completed
  failed
  verifying
  verified
  corrupted
  expired
  deleted
}

enum backup_schedules_compression {
  none
  lzo
  gzip
  zstd
}

enum dr_failover_events_status {
  pending
  in_progress
  completed
  failed
  rolled_back
}

enum help_faqs_visibility {
  global
  company_specific
  company_type
  role_specific
}

enum backup_schedules_mode {
  snapshot
  suspend
  stop
}

enum help_article_drafts_difficulty {
  beginner
  intermediate
  advanced
}

enum nat_rules_nat_mode {
  dnat
  snat
  masquerade
  one_to_one
}

enum proxmox_clusters_cluster_type {
  shared
  dedicated
  dr_only
}

enum virtual_machines_status {
  running
  stopped
  paused
  suspended
  deleted
  pending_deletion
  unknown
}

enum company_url_mappings_ssl_status {
  pending
  generating
  active
  failed
  expired
}

enum dr_replicated_vms_sync_status {
  idle
  syncing
  success
  failed
  paused
}

enum onboarding_registrations_status {
  pending
  approved
  rejected
  completed
}

enum users_status {
  active
  inactive
  suspended
}

enum dr_test_schedules_last_run_status {
  success
  failed
  partial
  cancelled
}

enum help_articles_visibility {
  global
  company_specific
  company_type
  role_specific
}

enum users_auth_type {
  local
  sso
  both
}

enum vm_resource_metrics_vm_status {
  running
  stopped
  paused
  unknown
}

enum dr_cluster_pairs_status {
  active
  inactive
  failover_active
  testing
  error
}

enum nat_rules_status {
  pending
  deploying
  active
  failed
  disabled
  deleting
}

enum backup_history_verification_status {
  pending
  passed
  failed
}

enum company_payment_methods_bank_account_type {
  checking
  savings
  business
}

enum subscription_plans_support_level {
  none
  email
  priority
  twentyfour_seven @map("24/7")
}

enum dr_zfs_replication_jobs_sync_status {
  idle
  syncing
  success
  failed
}

enum onboarding_registrations_created_via {
  api
  widget
  admin
  portal
}

enum company_sso_config_last_test_status {
  success
  failed
  pending
}

enum dr_vm_policies_replication_status {
  synced
  syncing
  outdated
  failed
  never_synced
}

enum backup_schedules_last_status {
  success
  failed
  running
  pending
}

enum dr_cluster_pairs_managed_by {
  super_admin
  company_admin
}

enum company_billing_billing_cycle_override {
  monthly
  quarterly
  annual
}

enum companies_sso_default_role {
  company_admin
  user
}

enum companies_default_nat_type {
  port_forward
  proxmox_nat
  opnsense
}

enum opnsense_instances_deployment_status {
  pending
  deploying
  configuring
  active
  failed
  stopped
}

enum company_payment_methods_verification_status {
  pending
  verified
  failed
}

enum company_url_mappings_white_label_level {
  basic
  standard
  premium
  enterprise
}

enum iso_sync_jobs_status {
  pending
  in_progress
  completed
  failed
}

enum billing_transactions_status {
  pending
  completed
  failed
  refunded
}

enum billing_transactions_transaction_type {
  payment
  subscription_payment
  refund
  adjustment
}
